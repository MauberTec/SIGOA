@{
    ViewBag.Title = "::.. Ordens de Serviço ..::";
}

@model List<WebApp.Models.Usuario>
@using WebApp.Models
@{
    //Verifica se o usuário esta logado
    if (Session["Usuario"] == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 540 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }

    Usuario gUsuario = (Usuario)Session["Usuario"];
    List<UsuarioPermissoes> lstPermissoes = gUsuario.lstUsuarioPermissoes;
    UsuarioPermissoes permissoesDesteModulo = lstPermissoes.Find(x => x.mod_id.Equals(540)); // id DO MODULO "O.S."
    if (permissoesDesteModulo == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 540 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }
}

<style>
    .rotate-135-left {
        -o-transform: rotate(-135deg);
        -webkit-transform: rotate(-135deg);
        transform: rotate(-135deg);
    }

    .titulosAbas {
        font-family: 'Source Sans Pro',sans-serif;
        font-size: 20px;
        font-weight: bold;
    }
</style>
<h2></h2>
<script>
    // variavel usada para identificar a view origem da ficha cadastral shared
    var paginaPai = "OrdemServico";
    var qualFicha;
    //  var selectedId_obj_id;

</script>


<div style="width:100%;" id="divFiltros">
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Localizar</h3>
        </div>
        <div class="box-body">
            <div id="divcontroles" class="row" style="margin:3px">
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">Código O.S.</label>
                        <input type="text" class="form-control" id="txtFiltroOrdemServico_codigo" onkeydown="if (event.keyCode == 13) { ExecutarFiltro(); }">
                    </div>
                    <div class="col-sm-3">
                        <label class="control-label">Código Objeto</label>
                        <input type="text" class="form-control" id="txtFiltroObj_codigo" onkeydown="if (event.keyCode == 13) { ExecutarFiltro(); }">
                    </div>

                    <div class="col-sm-3 ">
                        <label class="control-label">Tipo</label>
                        @Html.DropDownList("cmbFiltroTiposOS", null, "-- Selecione --", new { @class = "form-control " })
                    </div>

                    <div class="col-sm-3">
                        <label class="control-label">Status</label>
                        @Html.DropDownList("cmbFiltroStatusOS", null, "-- Selecione --", new { @class = "form-control " })
                    </div>
                </div>


                <div class="form-group" style="padding-top:20px; margin-top:20px">
                    <div class="col-sm-3">
                        <label class="control-label">Data</label>
                        <select name="cmbDatas" id="cmbDatas" class="form-control">
                            <option value="">--Selecione--</option>
                            <option value="Abertura">Data Abertura</option>
                            <option value="Inicio_Programada">Data Início Planejada</option>
                            <option value="Termino_Programada">Data Término Planejada</option>
                            <option value="Inicio_Execucao">Data Início Execução</option>
                            <option value="Termino_Execucao">Data Término Execução</option>
                            <option value="Suspensao">Data Suspensão</option>
                            <option value="Cancelamento">Data Cancelamento</option>
                            <option value="Reinicio">Data Reinício</option>
                        </select>
                    </div>

                    <div class="col-sm-3">
                        <label class="control-label">De</label>
                        <input id="filtroord_data_De" name="filtroord_data_De"
                               placeholder="De"
                               class="form-control" style="background-color:white" />
                    </div>

                    <div class="col-sm-3">
                        <label class="control-label">Até</label>
                        <input id="filtroord_data_Ate" name="filtroord_data_Ate"
                               placeholder="Até"
                               class="form-control" style="background-color:white" />
                    </div>

                    <div class="btn-box-tool pull-right" style="margin-top:20px">
                        <button type="reset" class="btn btn-info" onclick="LimparFiltro();"><i class="fa fa-eraser margin-r-5"></i> Limpar</button>
                        <button type="submit" class="btn btn-primary" onclick="ExecutarFiltro();" style="margin-right: 10px !important;"><i class="fa fa-search margin-r-5"></i> Pesquisar</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


<section class="content" style="min-height: 50px;">
    <div class="row">
        <div class="box box-primary">
            <div class="box-body">

                <table id="tblOrdemServicos">
                    <thead>
                        <tr>
                            <th>row_numero</th>
                            <th>temFilhos</th>
                            <th>row_expandida</th>
                            <th>ord_id</th>
                            <th>ocl_id</th>
                            <th>tos_id</th>
                            <th>obj_id</th>
                            <th>Código</th>
                            <th>Descrição</th>
                            <th>Objeto</th>
                            <th>Tipo</th>
                            <th>Status</th>
                            <th>nNivel</th>
                            <th>Opções</th>
                        </tr>
                    </thead>
                </table>

                @{
                    if ((permissoesDesteModulo != null) && (permissoesDesteModulo.mfl_inserir > 0))
                    {
                        <button type="button" class="btn btn-primary botaoInserir" onclick="btnOSInserir_onclick();">Nova Ordem de Serviço</button>
                    }
                }
                <input type="hidden" id="hddnSelectedord_id" name="hddnSelectedord_id" value="-1" />

            </div>
        </div>
    </div>
</section>

<style>
    .altura30 {
        height: 30px;
    }

    .backgrdTransparent {
        background-color: transparent !important;
    }

    .txtdoc_codigoHeader {
        color: red;
        font-weight: bold;
        font-size: 18pt;
        margin: 0px;
        border: none !important;
    }

    .chklst {
        /*font-family: 'Lucida Console';*/
        font-size: 14px;
        padding-top: 0px;
        margin-bottom: 0px;
        font-weight: normal;
    }
</style>

@***** SCRIPT FICHA todas as fichas ***********************@

<script>

    function abreFicha(qualFicha1)
    {
        // limpa todas as fichas
        $('#partialFicha1').empty();
        $('#partialFicha2').empty();
        $('#partialFicha3').empty();
        $('#partialFicha4').empty();
        $('#partialFicha5').empty();

        qualFicha = qualFicha1;

        $.ajax({
            type: 'GET',
            "data": { qualFicha: qualFicha},
            url: '@Url.Action("CarregaFicha", "OrdemServico")',
            success: function (result) {
                document.getElementById('partialFicha' + qualFicha).innerHTML = result;

                switch (qualFicha) {
                    case 1: preenchetblFicha(selectedId_obj_id, 3, -1); break;  // inspecao cadastral
                    case 2: preenchetblFicha2(selectedId_obj_id, 3, -1); break; // inspecao cadastral 2 = 1a rotineira
                    case 3: preenchetblFicha2(selectedId_obj_id, 3, -1); break; // inspecao rotineira
                    case 4: preenchetblFicha4(selectedId_obj_id, 3, -1); break; // inspecao especial
                    case 5: preenchetblFicha4_CAMPO(); break; // inspecao especial campo
                }

                colocaDatePickers();

            }
        });
    }

    function colocaDatePickers() {
        moment.locale('pt-br');         // pt-br
        $.fn.dataTable.moment('DD/MM/YYYY HH:mm:ss');

        jQuery(function ($) {
            $.datepicker.regional['pt-BR'] = datepicker_regional;
            $.datepicker.setDefaults($.datepicker.regional['pt-BR']);
        });

        $('#txtord_data_planejada_Novo').datepicker({
            minDate: 0,
            dateFormat: 'dd/mm/yy',
            onSelect: function () {
                $('#txtord_data_planejada_Novo').css('background-color', corBranca);
            }
        });


        $('#txtord_data_inicio_programada').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_inicio_execucao').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_suspensao').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_cancelamento').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_reinicio').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_termino_programada').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txtord_data_termino_execucao').datepicker({ dateFormat: 'dd/mm/yy' });

        $('#filtroord_data_De').datepicker({
            dateFormat: 'dd/mm/yy',
            onSelect: function () {
                var dt2 = $('#filtroord_data_Ate');

                // seta a data inicial do txtdataExecucaoAte
                var startDate = $(this).datepicker('getDate');
                startDate.setDate(startDate.getDate() + 1);
                var minDate = $(this).datepicker('getDate');
                var dt2Date = dt2.datepicker('getDate');

                dt2.datepicker("setDate", startDate);
                dt2.datepicker('option', 'minDate', startDate);
            }
        });

        $('#filtroord_data_Ate').datepicker({ dateFormat: 'dd/mm/yy' });

        // datepickers das fichas, aba DADOS GERAIS
        $('#txt_atr_id_103').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txt_atr_id_104').datepicker({ dateFormat: 'dd/mm/yy' });

        $('#txt_atr_id_1103').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txt_atr_id_1104').datepicker({ dateFormat: 'dd/mm/yy' });
    }


</script>

@***** SCRIPT FICHA 1 - CADASTRAL ***********************@
<script src="~/Scripts/Shared/_fichaInspecaoCadastral.js"></script>


@***** SCRIPT FICHAS 2 e 3 - CADASTRAL 2 E ROTINEIRA ***********************@
<script>

    var cabecalho1 = '<tr id="trFICHA2_OOBBJJIIDD_GGG_VVV_YYY"><td class="borderLeft borderBottomPt borderRight subdivisao1_fundo" colspan="9"><label class="lblsBold" >XXXXX</label></td></tr>';
    var cabecalho2 = '<tr id="trFICHA2_OOBBJJIIDD_GGG_VVV_YYY"><td class="borderLeft borderBottomPt borderRight subdivisao2_fundo" colspan="9"><label class="lblsBold" >XXXXX</label></td></tr>';
    var cabecalho3 = '<tr id="trFICHA2_OOBBJJIIDD_GGG_VVV_YYY"><td class="borderLeft borderBottomPt borderRight subdivisao3_fundo" colspan="9"><label class="lblsBold" >XXXXX</label></td></tr>';

    var MesclarGrupo =
        '   <td class="borderLeft borderTop borderRight borderBottomPt" rowspan=N_ROWSPAN > ' +
        '     <table style="width:100%"> ' +
        '      <tr> ' +
        '        <td style="width:26px"> ' +
        '          <button id="btn_ExcluirGrupo_INSPECAO_ROTINEIRA_GGG_VVV" ' +
        '            type="button" ' +
        '             onclick="return Ficha2_ExcluirGrupo(OOBBJJIIDD)" ' +
        '             title="Excluir Grupo" ' +
        '             style="border:none; box-shadow:none; background-color:transparent; visibility:displayZYZ"> ' +
        '             <span class="glyphicon glyphicon-trash text-success contornoBranco"></span> ' +
        '          </button> ' +
        '        </td> ' +
        '        <td> ' +
        '           <label id="lbl_Elemento_GGG_VVV" class="lblsNormal">lbl_Elemento_XXXXX</label> ' +
        '       </td> ' +
        '     </tr> ' +
        '   </table> ' +
        '  </td> ';

    var Mesclar_Condicao_Inspecao =
        '  <td class="borderTop borderRight borderBottomPt centroH" rowspan=N_ROWSPAN > ' +
        '    <select class="cmbs" id="cmb_condicao_GGG_VVV"> ' +
        '          OPCOES_cmb_condicao ' +
        '    </select> ' +
        '  </td> ';

    var linhaGrupos =
        ' <tr id="trFICHA2_OOBBJJIIDD_GGG_VVV_YYY"> ' +

        '  MesclarGrupo  ' +

        '  <td class="borderTop borderRight borderBottomPt"> ' +
        '    <label id="lbl_Variaveis_GGG_VVV" class="lblsNormal">lbl_Variaveis_XXXXX</label> ' +
        '  </td> ' +
        '  <td class="borderTop borderRight borderBottomPt centroH"> ' +
        '    <select class="cmbs" id="cmb_situacao_GGG_VVV" onchange="cmb_situacao_onchange(this)"> ' +
        '          OPCOES_cmb_situacao ' +
        '    </select> ' +
        '  </td> ' +

        ' Mesclar_Condicao_Inspecao ' +

        '  <td class="borderTop borderRight borderBottomPt" colspan="2" style="text-align:center;"> ' +
        '    <textarea id="txt_obs_GGG_VVV" class="txts" rows="2" cols="50"  maxlength="255" style="width:98%; overflow:auto">txt_obs_XXXXX</textarea> ' +
        '  </td> ' +
        '  <td class="borderTop borderRight borderBottomPt"> ' +
        '    <label id="lbl_servico_GGG_VVV" class="txts" style="border:none; width:100%; text-align:left" title="txt_servico_XXXXX">txt_servico_XXXXX</label> ' +
        '    <select class="cmbs" id="cmb_tpu_descricao_itens_GGG_VVV" style="display:none"> ' +
        '          OPCOES_cmb_tpu_descricao_itens ' +
        '    </select> ' +
        //   '    <input id="txt_servico_GGG_VVV" class="txts  centroH" value="txt_servico_XXXXX" maxlength="255" onkeyup="validaAlfaNumericoAcentosAfins(this, 0, 0)" /> ' +
        //'    <button id="btn_LocalizarGrupo_INSPECAO_ROTINEIRA_GGG_VVV" ' +
        //'            type="button" ' +
        //'            onclick="return Selecionar_TPU(this)" ' +
        //'            title="Selecionar Serviço" ' +
        //'            style="border:none; box-shadow:none; background-color:transparent; "> ' +
        //'        <span class="fa fa-search"></span> ' +
        //'    </button> ' +
        '  </td> ' +
        '  <td class="borderTop borderRight borderBottomPt  centroH"> ' +
        //    '    <label class="lblsBold" id="lbl_unidade_GGG_VVV">lbl_unidade_XXXXX</label> ' +
        '    <input id="txt_unidade_GGG_VVV" class="txts  centroH" value="txt_unidade_XXXXX" maxlength="15"  /> ' +
        '  </td> ' +
        '  <td class="borderTop borderRight borderBottomPt centroH"> ' +
        '    <input id="txt_quantidade_GGG_VVV" class="txts  centroH" value="txt_quantidade_XXXXX" /> ' +
        '  </td> ' +
        ' </tr> ';


</script>

<script>

    //  $(document).ready(function () {
    //$("#esquemaBrowse").change(function () {
    //    var File = this.files;
    //    if (File && File[0]) {
    //        UploadEsquema();
    //    }
    //});

    //})

    //  var controlesReadOnlyFicha2 = ["txt_atr_id_13", "txt_atr_id_102", "txt_atr_id_105", "txt_atr_id_106", "txt_atr_id_107", "cmb_atr_id_130", "cmb_atr_id_131",
        //"cmb_atr_id_1020", "cmb_atr_id_1084", "cmb_atr_id_1085", "cmb_atr_id_1087", "cmb_atr_id_1088", "cmb_atr_id_1089", "cmb_atr_id_1091", "cmb_atr_id_1092", "cmb_atr_id_1093", "cmb_atr_id_1094",
    var controlesReadOnlyFicha2 = ["txt_atr_id_13", "txt_atr_id_102", "txt_atr_id_106", "cmb_atr_id_130", "cmb_atr_id_131", "cmb_atr_id_135", "cmb_atr_id_136", "cmb_atr_id_137", "cmb_atr_id_138", "cmb_atr_id_139", "cmb_atr_id_140", "cmb_atr_id_141", "cmb_atr_id_142", "cmb_atr_id_143", "cmb_atr_id_144", "txt_atr_id_151", "txt_atr_id_152", "txt_atr_id_153"
        //,"txt_historico_Pontuacao_Geral_OAE_1", "txt_historico_documento_2", "txt_historico_data_2", "txt_historico_executantes_2", "txt_historico_Pontuacao_Geral_OAE_2", "txt_historico_documento_3", "txt_historico_data_3", "txt_historico_executantes_3", "txt_historico_Pontuacao_Geral_OAE_3"
    ];

    var controlesExcecoes_Salvar = ["cmb_atr_id_130", "cmb_atr_id_131", "cmb_atr_id_135", "cmb_atr_id_136", "cmb_atr_id_137", "cmb_atr_id_138", "cmb_atr_id_139", "cmb_atr_id_140", "cmb_atr_id_141", "cmb_atr_id_142", "cmb_atr_id_143", "cmb_atr_id_144", "cmb_atr_id_148", "cmb_atr_id_150", "txt_atr_id_151", "txt_atr_id_152", "txt_atr_id_153", "txt_atr_id_157"];

    function Ficha2_header_click(quem, expandir) {
        if (expandir == null)
            expandir = 0;

        if (selectedId_clo_id <= 2) {
            expandir = 0;
            accordion_encolher(2);
        }
        else
            switch (quem.id) {

                case "btn_Toggle_HISTORICO_INSPECOES":
                    {
                        // alterna os campos para leitura
                        Ficha2_setaReadWrite(tblFicha2_HISTORICO_INSPECOES, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'none';
                            document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'none';
                            document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'block';
                            //  document.getElementById("btn_SelecionarGrupo_HISTORICO_INSPECOES").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'none';
                            //document.getElementById("btn_SelecionarGrupo_HISTORICO_INSPECOES").style.display = 'none';

                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'none';
                                document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'block';
                                document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'block';
                            }

                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_HISTORICO_INSPECOES").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_INSPECAO_ROTINEIRA":
                    {
                        // alterna os campos para leitura
                        Ficha2_setaReadWrite(tblFicha2_INSPECAO_ROTINEIRA, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'none';
                            document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'none';
                            document.getElementById("btn_Editar_INSPECAO_ROTINEIRA").style.display = 'block';
                            //  document.getElementById("btn_SelecionarGrupo_INSPECAO_ROTINEIRA").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_INSPECAO_ROTINEIRA").style.display = 'none';
                            document.getElementById("btn_SelecionarGrupo_INSPECAO_ROTINEIRA").style.display = 'none';

                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'none';
                                document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'block';
                                document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'block';
                            }

                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_INSPECAO_ROTINEIRA").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_CRITERIO_DE_CLASSIFICACAO":
                    {
                        // alterna os campos para leitura
                        Ficha2_setaReadWrite(tblFicha2_CRITERIO_DE_CLASSIFICACAO, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                                document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                                document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                            }
                        }

                        //calcula as notas
                        Ficha2_Calcula_Notas_2_Requisito();

                        // roda o icone 90graus
                        document.getElementById("iconAngle_CRITERIO_DE_CLASSIFICACAO").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_NOTA_OAE_PARAMETRO_FUNCIONAL":
                    {
                        // alterna os campos para leitura
                        Ficha2_setaReadWrite(tblFicha2_NOTA_OAE_PARAMETRO_FUNCIONAL, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                                document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                                document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_NOTA_OAE_PARAMETRO_FUNCIONAL").classList.toggle('rotate');
                        break;
                    }


                case "btn_Toggle_POLITICA_ACOES_A_IMPLEMENTAR":
                    {
                        //// alterna os campos para leitura
                        //    Ficha2_setaReadWrite(tblFicha2_POLITICA_ACOES_A_IMPLEMENTAR, true);

                        //// mostra o botao editar
                        //if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                        //    document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //}
                        //else {
                        //    document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    if (quem.getAttribute('aria-expanded') == "true") {
                        //        document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //        document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    }
                        //    else {
                        //        document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //        document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //    }
                        //}

                        // roda o icone 90graus
                        document.getElementById("iconAngle_POLITICA_ACOES_A_IMPLEMENTAR").classList.toggle('rotate');
                        break;
                    }

            }
    }

    function nome_segundo_cabecalho2(controleId) {
        var prefix = controleId.substring(0, controleId.lastIndexOf("_") + 1);
        var num = parseInt(controleId.substring(controleId.lastIndexOf("_") + 1)) + 1000;
        return (prefix + num);

    }

    function Ficha2_ExportarXLS() {
        $.ajax({
            "url": "/Objeto/ObjFichaInspecaoRotineira_ExportarXLS",
            "type": "GET",
            "datatype": "json",
            "data": { "obj_id": selectedId_obj_id, "ord_id": selectedId_ord_id },
            "success": function (result) {
                // return result = caminho da planilha preenchida e salva para download

                window.open("../../Reports/frmDownloadFile.aspx?filename=" + result.data);
                //  window.open("../../temp/" + result.data);
                return false;
            }
        });

        return false;
    }

    function Ficha2_limpar() {

        var tabela = document.getElementById("divFicha2");

        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        var lstCombos = tabela.getElementsByTagName('select');
        var lstTextareas = tabela.getElementsByTagName('textarea');

        for (var i = 0; i < lstTxtBoxes.length; i++)
            lstTxtBoxes[i].value = "";

        for (var i = 0; i < lstTextareas.length; i++)
            lstTextareas[i].value = "";

        for (var i = 0; i < lstCombos.length; i++)
            lstCombos[i].innerText = null;

    }
    function preenchetblFicha2(obj_id, classe, tipo) {
        classe = parseInt(classe);
        tipo = parseInt(tipo);
        selectedId_clo_id = classe;
        selectedId_tip_id = tipo;


        // limpa antes de preencher
        Ficha2_limpar();

        $('#txt_historico_data_1').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txt_historico_data_2').datepicker({ dateFormat: 'dd/mm/yy' });
        $('#txt_historico_data_3').datepicker({ dateFormat: 'dd/mm/yy' });

        jQuery("#txt_historico_Pontuacao_Geral_OAE_2").mask("99.99");
        jQuery("#txt_historico_Pontuacao_Geral_OAE_3").mask("99.99");

        var ord_id = 0;
        if (paginaPai == "OrdemServico")
            ord_id = selectedId_ord_id;

        var url = "/Objeto/ObjAtributoValores_ListAll";
        var data = { "obj_id": obj_id, "ord_id": ord_id };

        if (moduloCorrente == 'OrdemServico') {
            var StatusOS = parseInt(filtroStatusOS);
           // if (StatusOS == 11) {

            if (StatusOS <= 11) {
                url = "/Inspecao/InspecaoAtributosValores_ListAll";
                data = { "ord_id": selectedId_ord_id };
            }
        }

        $.ajax({
            "url": url,
            "type": "GET",
            "datatype": "json",
            "data": data,
            "success": function (result) {
                for (var i = 0; i < result.data.length; i++) {

                    // preenche os LABELS
                    var label = document.getElementById(result.data[i].atv_controle.replace("chk_", "lbl").replace("cmb_", "lbl"));
                    if (label) {
                        // procura o label2
                        var label2 = document.getElementById((nome_segundo_cabecalho2(label.id)));

                        var texto = result.data[i].atr_atributo_nome;
                        if (texto.includes('|')) {
                            partes = texto.split("|");
                            texto = partes[partes.length - 1].trim();
                        }
                        label.innerText = texto;

                        if (label2)
                            label2.innerText = texto;
                    }

                    // preenche o valor se houver
                    if (parseInt(result.data[i].nItens) == 0) {
                        var textbox = document.getElementById(result.data[i].atv_controle.replace("lbl", "txt_"));
                        var textbox2 = document.getElementById((nome_segundo_cabecalho2(result.data[i].atv_controle.replace("lbl", "txt_"))).replace("lbl", "txt_"));
                        var mascara = result.data[i].atr_mascara_texto;

                        if (textbox) {
                            textbox.value = result.data[i].atv_valor;

                            // coloca mascara no textbox
                            if (mascara != "") {
                                jQuery(textbox).mask(mascara);
                                jQuery(textbox).attr('placeholder', mascara.replace(/9/g, '0'));
                            }

                        }
                        if (textbox2) {
                            textbox2.value = result.data[i].atv_valor;

                            if (mascara != "") {
                                jQuery(textbox2).mask(mascara);
                                jQuery(textbox).attr('placeholder', mascara.replace(/9/g, '0'));
                            }
                        }
                    }
                    else
                        if (result.data[i].atr_apresentacao_itens == 'combobox') {
                            var combo = document.getElementById(result.data[i].atv_controle);
                            var combo2 = document.getElementById((nome_segundo_cabecalho2(result.data[i].atv_controle)));

                            if (combo) {
                                combo.innerText = null; // limpa

                                // preenche combo
                                var lista = result.data[i].atr_itens_todos.split(";");
                                for (var m = 0; m < lista.length; m++) {
                                    var opt = document.createElement("option");
                                    opt.value = lista[m].substring(0, 3);
                                    opt.textContent = lista[m].substring(3);

                                    combo.appendChild(opt);
                                }

                                combo.value = result.data[i].atv_valor;
                            }

                            if (combo2) {
                                combo2.innerText = null; // limpa

                                // preenche combo
                                var lista = result.data[i].atr_itens_todos.split(";");
                                for (var m = 0; m < lista.length; m++) {
                                    var opt2 = document.createElement("option");
                                    opt2.value = lista[m].substring(0, 3);
                                    opt2.textContent = lista[m].substring(3);
                                    combo2.appendChild(opt2);
                                }
                                combo2.value = result.data[i].atv_valor;
                            }

                        }
                        else
                            if (result.data[i].atr_apresentacao_itens == 'checkbox') {
                                var checkbox_prefixo = result.data[i].atv_controle;

                                var lista = result.data[i].atr_itens_todos.split(";");
                                for (var m = 0; m < lista.length; m++) {
                                    var valor = lista[m].substring(0, 3);
                                    var texto = lista[m].substring(3);
                                    var checkbox = document.getElementById(checkbox_prefixo + "_" + parseInt(valor));
                                    if (checkbox) {
                                        var label = document.getElementById(checkbox_prefixo.replace("chk_", "lbl") + "_" + parseInt(valor));
                                        if (label)
                                            label.innerText = texto;

                                        checkbox.value = valor;

                                        // preenche os valores correspondentes
                                        if (parseInt(valor) == parseInt(result.data[i].ati_ids)) {
                                            var tick = result.data[i].atv_valor.substring(0, 1);
                                            checkbox.checked = tick == "1" ? true : false;

                                            // procura um textbox correspondente, do tipo checkbox+textbox
                                            var txt = document.getElementById(checkbox_prefixo.replace("chk", "txt") + "_" + parseInt(valor));
                                            if (txt) {
                                                var texto = result.data[i].atv_valor.substr(2);
                                                if (texto != "") {
                                                    txt.value = texto;
                                                    checkbox.checked = true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                }

                Ficha2_Calcula_Notas_Tudo();
            }
        });



        if (paginaPai == "OrdemServico") {
            if (qualFicha == 2) {
                preenchecmbTiposObjeto_FichaInspecaoRotineira();
            }

            if ((qualFicha == 2) || (qualFicha == 3)) {

                Ficha2_CriarTabelaGrupos();

               // document.getElementById("tblFicha2_HISTORICO_INSPECOES").style.display = "table";
                document.getElementById("btn_Toggle_INSPECAO_ROTINEIRA").innerText = "3 - INSPEÇÃO ROTINEIRA";
                document.getElementById("btn_Toggle_CRITERIO_DE_CLASSIFICACAO").innerText = "4 - NOTA GERAL DE AVALIAÇÃO E CLASSIFICAÇÃO DA OBRA DE ARTE (1º Requisito + 2º Requisito)";
                document.getElementById("btn_Toggle_NOTA_OAE_PARAMETRO_FUNCIONAL").innerText = "5 - NOTA DA OBRA DE ARTE PARA O PARÂMETRO FUNCIONAL (NBR 9452:2019) - Conforto e Segurança do Usuário";
                document.getElementById("btn_Toggle_POLITICA_ACOES_A_IMPLEMENTAR").innerText = "6 - POLÍTICA DE AÇÕES A SEREM IMPLEMENTADAS EM FUNÇÃO DAS NOTAS";

              //  if ((selectedId_tos_id == 2) && (qualFicha == 3))
                {
                    if (qualFicha == 3)  // flag para "Inspecao Cadastral 2 = 1" ou "Inspecao Rotineira (campo) =2"
                        {
                            document.getElementById("trFichaRotineiraHistorico_linha1").style.display = "default";
                            document.getElementById("trFichaRotineiraHistorico_linha2").style.display = "default";
                            document.getElementById("trFichaRotineiraHistorico_linha3").style.display = "default";
                        }
                    else
                        if (qualFicha == 2) 
                        {
                            document.getElementById("trFichaRotineiraHistorico_linha1").style.display = "default";
                            document.getElementById("trFichaRotineiraHistorico_linha2").style.display = "none";
                            document.getElementById("trFichaRotineiraHistorico_linha3").style.display = "none";
                        }
                    }

                ////document.getElementById("tblFicha2_HISTORICO_INSPECOES").style.display = "none";
                ////// if ((selectedId_tos_id == 2) && (qualFicha == 3))
                ////if ((qualFicha == 3)) { // flag para "Inspecao Cadastral 1a rotineira = 1" ou "Inspecao Rotineira (campo) =2"
                ////    document.getElementById("tblFicha2_HISTORICO_INSPECOES").style.display = "table";
                ////    document.getElementById("btn_Toggle_INSPECAO_ROTINEIRA").innerText = "3 - INSPEÇÃO ROTINEIRA";
                ////    document.getElementById("btn_Toggle_CRITERIO_DE_CLASSIFICACAO").innerText = "4 - NOTA GERAL DE AVALIAÇÃO E CLASSIFICAÇÃO DA OBRA DE ARTE (1º Requisito + 2º Requisito)";
                ////    document.getElementById("btn_Toggle_NOTA_OAE_PARAMETRO_FUNCIONAL").innerText = "5 - NOTA DA OBRA DE ARTE PARA O PARÂMETRO FUNCIONAL (NBR 9452:2019) - Conforto e Segurança do Usuário";
                ////    document.getElementById("btn_Toggle_POLITICA_ACOES_A_IMPLEMENTAR").innerText = "6 - POLÍTICA DE AÇÕES A SEREM IMPLEMENTADAS EM FUNÇÃO DAS NOTAS";
                ////}
                ////else
                ////    // if ((selectedId_tos_id == 1) && (qualFicha == 2))
                ////    if ((qualFicha == 2)) {
                ////        document.getElementById("btn_Toggle_INSPECAO_ROTINEIRA").innerText = "2 - INSPEÇÃO ROTINEIRA";
                ////        document.getElementById("btn_Toggle_CRITERIO_DE_CLASSIFICACAO").innerText = "3 - NOTA GERAL DE AVALIAÇÃO E CLASSIFICAÇÃO DA OBRA DE ARTE (1º Requisito + 2º Requisito)";
                ////        document.getElementById("btn_Toggle_NOTA_OAE_PARAMETRO_FUNCIONAL").innerText = "4 - NOTA DA OBRA DE ARTE PARA O PARÂMETRO FUNCIONAL (NBR 9452:2019) - Conforto e Segurança do Usuário";
                ////        document.getElementById("btn_Toggle_POLITICA_ACOES_A_IMPLEMENTAR").innerText = "5 - POLÍTICA DE AÇÕES A SEREM IMPLEMENTADAS EM FUNÇÃO DAS NOTAS";
                ////    }
            }
        }

    }

    function Ficha2_setaReadWrite(tabela, ehRead) {
        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        var lstCombos = tabela.getElementsByTagName('select');
        var lstTextareas = tabela.getElementsByTagName('textarea');

        var cmb_atr_id_98 = document.getElementById("cmb_atr_id_98");

        // trava o
        if ((moduloCorrente == 'Objetos') // se estiver em Cadastro de Objetos,
            || ((moduloCorrente == 'OrdemServico') && (cmb_atr_id_98.selectedIndex > 0)) // se estiver em OrdemServico e já houver tipo de OAE selecionada
        ) {
            controlesReadOnlyFicha2.push("cmb_atr_id_98"); // combo Tipo OAE
            controlesReadOnlyFicha2.push("txt_atr_id_105"); // descricao Tipo OAE
        }

        for (var i = 0; i < lstTxtBoxes.length; i++)
            if (!controlesReadOnlyFicha2.includes(lstTxtBoxes[i].id))
                lstTxtBoxes[i].disabled = ehRead;

        for (var i = 0; i < lstTextareas.length; i++)
            if (!controlesReadOnlyFicha2.includes(lstTextareas[i].id))
                lstTextareas[i].disabled = ehRead;

        for (var i = 0; i < lstCombos.length; i++)
            if (!controlesReadOnlyFicha2.includes(lstCombos[i].id))
                lstCombos[i].disabled = ehRead;
            else
                lstCombos[i].disabled = true;

        // botoes da lixeira da tabela GRUPOS criada dinamicamente
        if (tabela.id == "tblFicha2_INSPECAO_ROTINEIRA") // tabela de grupos da ficha 2
        {
            var tblFicha_2_GRUPOS = document.getElementById("tblFicha_2_GRUPOS");
            var lstButtons = tblFicha_2_GRUPOS.getElementsByTagName('button');

            for (var i = 0; i < lstButtons.length; i++)
                lstButtons[i].style.display = ehRead ? 'none' : 'block'; // aqui display block/none; na criacao da tabela visibility: visible/hidden (para nao misturar porque la existe validacao)

        }


        // =============== ALTERNA OS BOTOES SALVAR/CANCELAR/EDITAR =============================================================
        // alterna para os botoes de salvar/cancelar
        switch (tabela.id) {
            case "tblFicha2_DADOS_GERAIS2":
                {
                    document.getElementById("btn_Salvar_DADOS_GERAIS2").style.display = 'none';
                    document.getElementById("btn_Cancelar_DADOS_GERAIS2").style.display = 'none';
                    document.getElementById("btn_Editar_DADOS_GERAIS2").style.display = 'block';
                    break;
                }

            case "tblFicha2_HISTORICO_INSPECOES":
                {
                    var btn_Toggle_HISTORICO_INSPECOES = $("#btn_Toggle_HISTORICO_INSPECOES");
                    if (btn_Toggle_HISTORICO_INSPECOES.attr('aria-expanded') == "true")

                    document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'none';
                    document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'none';
                    document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'block';
                    break;
                }

            case "tblFicha2_INSPECAO_ROTINEIRA":
                {
                    var btn_Toggle_INSPECAO_ROTINEIRA = $("#btn_Toggle_INSPECAO_ROTINEIRA");
                    if (btn_Toggle_INSPECAO_ROTINEIRA.attr('aria-expanded') == "true")
                    {
                        document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'none';
                        document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'none';
                        document.getElementById("btn_Editar_INSPECAO_ROTINEIRA").style.display = 'block';
                    }
                    break;
                }
            case "tblFicha2_CRITERIO_DE_CLASSIFICACAO":
                {
                    document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                    document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                    document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                    break;
                }

            case "tblFicha2_POLITICA_ACOES_A_IMPLEMENTAR":
                {
                    //document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                    //document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                    //document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                    break;
                }

            case "tblFicha2_NOTA_OAE_PARAMETRO_FUNCIONAL":
                {
                    document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                    document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                    document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                    break;
                }
        }
    }

    function preenchecmbTiposObjeto_FichaInspecaoRotineira() {
        $("#cmbTiposObjeto_FichaInspecaoRotineira").html(""); // limpa os itens existentes

        $.ajax({
            url: '/Objeto/PreenchecmbTiposObjeto',
            type: "POST",
            dataType: "JSON",
            data: { clo_id: 0, tip_pai: 0, excluir_existentes: 0, obj_id: 0 },
            success: function (lstSubNiveis) {
                $("#cmbTiposObjeto_FichaInspecaoRotineira").append($('<option selected disabled></option>').val(-1).html("--Selecione--")); // 1o item vazio
                $.each(lstSubNiveis, function (i, subNivel) {
                    $("#cmbTiposObjeto_FichaInspecaoRotineira").append($('<option></option>').val(subNivel.Value).html(subNivel.Text));
                });

            }
        });
    }

    function getTipoId(aux) {
        return parseInt(aux.substring(0, aux.indexOf(":")));
    }
    function getTipoCodigo(aux) {
        return mascara = aux.substring(aux.indexOf(":") + 1, 150);
    }

    function cmb_situacao_onchange(quem) {
        var valor = quem.value;
        var lbl_id = quem.id.replace("cmb_situacao", "lbl_servico");
        var lbl = document.getElementById(lbl_id);
        lbl.innerText = "";

        var cmb2_id = quem.id.replace("cmb_situacao", "cmb_tpu_descricao_itens");
        var cmb2 = document.getElementById(cmb2_id);
        if (cmb2) {
            if ((parseInt(valor) <= 3) && (cmb2.options.length >= parseInt(valor))) {
                cmb2.value = valor;
                lbl.innerText = cmb2.options[cmb2.selectedIndex].text;
            }
        }
    }

    function Ficha2_CriarTabelaGrupos(ehRead) {

        if (ehRead == null)
            ehRead = true;

        // limpa as linhas se houver
        var table = document.getElementById("tblFicha_2_GRUPOS");
        var rowCount = table.rows.length;
        for (var i = rowCount - 1; i >= 0; i--) {
            if (table.rows[i].id.indexOf("trFICHA2_") >= 0)
                table.deleteRow(i);
        }


        var linhas = '';
        var celulaPai = document.getElementById("Ficha2_tr_Cabecalho");

        var ord_id = 0;
        if (paginaPai == "OrdemServico")
            ord_id = selectedId_ord_id;

        $.ajax({
            "url": "/Objeto/GruposVariaveisValores_ListAll",
            "type": "GET",
            "datatype": "json",
            "data": { "obj_id": selectedId_obj_id, "ord_id": ord_id },
            "success": function (result) {
                for (var i = 0; i < result.data.length; i++) {
                    if (parseInt(result.data[i].nCabecalhoGrupo) == 1)  // CABECALHO 1
                        linhas = linhas + cabecalho1.replace("XXXXX", result.data[i].nome_pai).replace("YYY", i);
                    else
                        if (parseInt(result.data[i].nCabecalhoGrupo) == 2) // CABECALHO 2
                            linhas = linhas + cabecalho2.replace("XXXXX", result.data[i].nome_pai).replace("YYY", i);
                        else
                            if (parseInt(result.data[i].nCabecalhoGrupo) == 3) // CABECALHO 3
                                linhas = linhas + cabecalho3.replace("XXXXX", result.data[i].nome_pai).replace("YYY", i);
                            else
                                if (parseInt(result.data[i].nCabecalhoGrupo) == 0) // LINHA NORMAL
                                {
                                    var linhaAux = linhaGrupos;
                                    linhaAux = linhaAux.replace("YYY", i);

                                    // MESCLA CELULAS SE NECESSARIO
                                    if ((result.data[i].nomeGrupo.trim() != "") && (parseInt(result.data[i].mesclarLinhas) > 0)) {
                                        linhaAux = linhaAux.replace(/MesclarGrupo/g, MesclarGrupo);
                                        linhaAux = linhaAux.replace(/Mesclar_Condicao_Inspecao/g, Mesclar_Condicao_Inspecao);
                                        linhaAux = linhaAux.replace(/N_ROWSPAN/g, result.data[i].mesclarLinhas);
                                    }
                                    else {
                                        linhaAux = linhaAux.replace(/MesclarGrupo/g, "");
                                        linhaAux = linhaAux.replace(/Mesclar_Condicao_Inspecao/g, "");
                                    }


                                    // cria os itens do combo tpu_descricao_itens_cmb ========================================
                                    var str = result.data[i].tpu_descricao_itens_cmb;
                                    var op = ' <option selectedXX value="valor">texto</option> ';
                                    var total = op;

                                    if (str != "") {
                                        var selectedValue = result.data[i].ogi_id_caracterizacao_situacao;
                                        total = total.replace("selectedXX", "");

                                        var pedacos = str.split(";");
                                        for (k = 0; k < pedacos.length; k++) {
                                            var aux = pedacos[k].split(":");
                                            var opt = op;
                                            opt = opt.replace("valor", aux[0]).replace("texto", aux[1]);

                                            // checa se é o item selecionado
                                            if (parseInt(selectedValue) == parseInt(aux[0]))
                                                opt = opt.replace("selectedXX", "selected");
                                            else
                                                opt = opt.replace("selectedXX", "");

                                            total = total + opt;
                                        }
                                        linhaAux = linhaAux.replace(/OPCOES_cmb_tpu_descricao_itens/g, total);
                                    }


                                    // cria os itens do combo cmb_situacao ========================================
                                    var op0 = ' <option selectedXX value="0" disabled></option> ';
                                    var op = ' <option selectedXX value="valor">texto</option> ';
                                    var total = op0;
                                    var str = result.data[i].caracterizacao_situacao_cmb;
                                    var selectedValue = result.data[i].ogi_id_caracterizacao_situacao;

                                    if (parseInt(selectedValue) == 0)
                                        total = total.replace("selectedXX", "selected");
                                    else
                                        total = total.replace("selectedXX", "");

                                    var pedacos = str.split(";");
                                    for (k = 0; k < pedacos.length; k++) {
                                        var aux = pedacos[k].split(":");
                                        var opt = op;
                                        opt = opt.replace("valor", aux[0]).replace("texto", aux[1]);

                                        // checa se é o item selecionado
                                        if (parseInt(selectedValue) == parseInt(aux[0]))
                                            opt = opt.replace("selectedXX", "selected");
                                        else
                                            opt = opt.replace("selectedXX", "");

                                        total = total + opt;
                                    }
                                    linhaAux = linhaAux.replace(/OPCOES_cmb_situacao/g, total);

                                    // cria os itens do combo OPCOES_cmb_condicao============================================
                                    var op0 = ' <option selectedXX value="0" disabled></option> ';
                                    var op = '  <option selectedXX value="valor">texto</option> ';
                                    total = op0;
                                    if (parseInt(selectedValue) == 0)
                                        total = total.replace("selectedXX", "selected");
                                    else
                                        total = total.replace("selectedXX", "");

                                    var selectedValue = result.data[i].ati_id_condicao_inspecao;
                                    var str = result.data[i].condicao_inspecao_cmb;
                                    var pedacos = str.split(";");
                                    for (k = 0; k < pedacos.length; k++) {
                                        var aux = pedacos[k].split(":");
                                        var opt = op;
                                        opt = opt.replace("valor", aux[0]).replace("texto", aux[1]);

                                        // checa se é o item selecionado
                                        if (parseInt(selectedValue) == parseInt(aux[0]))
                                            opt = opt.replace("selectedXX", "selected");
                                        else
                                            opt = opt.replace("selectedXX", "");

                                        total = total + opt;
                                    }
                                    linhaAux = linhaAux.replace(/OPCOES_cmb_condicao/g, total);


                                    if (result.data[i].nomeGrupo.trim() == "") // LIXEIRA
                                        linhaAux = linhaAux.replace(/displayZYZ/g, "hidden");
                                    else
                                        if ((parseInt(result.data[i].TemFilhos) == 0))
                                            linhaAux = linhaAux.replace(/displayZYZ/g, "visible");
                                        else
                                            linhaAux = linhaAux.replace(/displayZYZ/g, "hidden");

                                    // COLOCA OS DADOS
                                    linhaAux = linhaAux.replace(/OOBBJJIIDD/g, result.data[i].obj_id);
                                    linhaAux = linhaAux.replace(/GGG/g, result.data[i].obj_id);
                                    linhaAux = linhaAux.replace(/VVV/g, result.data[i].ogv_id);
                                    linhaAux = linhaAux.replace(/lbl_Elemento_XXXXX/g, result.data[i].nomeGrupo);
                                    linhaAux = linhaAux.replace(/lbl_Variaveis_XXXXX/g, result.data[i].variavel);
                                    linhaAux = linhaAux.replace(/txt_obs_XXXXX/g, result.data[i].ovv_observacoes_gerais);
                                    linhaAux = linhaAux.replace(/txt_servico_XXXXX/g, result.data[i].tpu_descricao);
                                    linhaAux = linhaAux.replace(/txt_unidade_XXXXX/g, result.data[i].uni_unidade);
                                    //  linhaAux = linhaAux.replace(/lbl_unidade_XXXXX/g, result.data[i].uni_unidade);
                                    linhaAux = linhaAux.replace(/txt_quantidade_XXXXX/g, result.data[i].ovv_tpu_quantidade);

                                    linhas = linhas + linhaAux;
                                }

                }

                // mescla na tabela existente
                celulaPai.insertAdjacentHTML('afterend', linhas);

                // coloca mascara no campo quantidade
                var qts = $('[id^="txt_quantidade_"]');
                for (var i = 0; i < qts.length; i++) {
                    jQuery(qts[i]).attr('placeholder', "000.00");
                    jQuery(qts[i]).mask("999.99");
                }

                ////// coloca mascara no campo observacao
                ////var qts = $('[id^="txt_obs_"]');

                ////var optionsObs = {
                ////    'translation': {
                ////        ';': { pattern: /;/, fallback: '.', optional: false }, // ";"para ponto por causa do "split"
                ////        '&': { pattern: /&/, fallback: 'e', optional: false } // "&"para  letra "e" por causa do "split"
                ////    }

                ////};

                ////for (var i = 0; i < qts.length; i++) {
                ////    jQuery(qts[i]).mask("999.99", optionsObs);
                ////}

                if (tblFicha2_INSPECAO_ROTINEIRA)
                    Ficha2_setaReadWrite(tblFicha2_INSPECAO_ROTINEIRA, ehRead);
            }
        });

    }
    function Ficha2_ExcluirGrupo(obj_id) {
        var form = this;

        swal({
            title: "Excluir. Tem certeza?",
            icon: "warning",
            buttons: [
                'Não',
                'Sim'
            ],
            dangerMode: true,
            focusCancel: true
        }).then(function (isConfirm) {
            if (isConfirm) {
                var response = POST("/Objeto/Objeto_Excluir", JSON.stringify({ id: obj_id }))
                if (response.erroId >= 1) {
                    swal({
                        type: 'success',
                        title: 'Sucesso',
                        text: 'Registro excluído com sucesso'
                    });

                    // atualiza tabela grupos
                    Ficha2_CriarTabelaGrupos();
                    return false;
                }
                else {
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: 'Erro ao excluir registro'
                    });
                }
                return false;
            } else {
                return false;
            }
        })
        return false;
    }
    function Selecionar_TPU(id) {
        alert("Selecionar TPU - a definir");
    }

    function EditarDados_Ficha2(tabela) {

        // alterna os campos para escrita
        Ficha2_setaReadWrite(tabela, false);

        // alterna para os botoes de salvar/cancelar
        switch (tabela.id) {
            case "tblFicha2_DADOS_GERAIS2":
                {
                    document.getElementById("btn_Salvar_DADOS_GERAIS2").style.display = 'block';
                    document.getElementById("btn_Cancelar_DADOS_GERAIS2").style.display = 'block';
                    document.getElementById("btn_Editar_DADOS_GERAIS2").style.display = 'none';
                    break;
                }

            case "tblFicha2_HISTORICO_INSPECOES":
                {
                    document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'block';
                    document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'block';
                    document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'none';
                    break;
                }

            case "tblFicha2_INSPECAO_ROTINEIRA":
                {
                    document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'block';
                    document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'block';
                    document.getElementById("btn_Editar_INSPECAO_ROTINEIRA").style.display = 'none';
                    break;
                }

            case "tblFicha2_CRITERIO_DE_CLASSIFICACAO":
                {
                    document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                    document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                    document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                    break;
                }

            case "tblFicha2_NOTA_OAE_PARAMETRO_FUNCIONAL":
                {
                    document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                    document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                    document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                    break;
                }

            case "tblFicha2_POLITICA_ACOES_A_IMPLEMENTAR":
                {
                    document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                    document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                    document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                    break;
                }
        }

        return false;
    }

    function SalvarDados_Ficha2_GRUPOS_VALORES() {
        // pega os valores de Ponto1, Ponto2, Ponto3
        var P1 = document.getElementById("txt_atr_id_132").value;
        var P2 = document.getElementById("txt_atr_id_133").value;
        var P3 = document.getElementById("txt_atr_id_134").value;
        var OutrasInformacoes = document.getElementById("txt_atr_id_170").value;

        // monta lista de valores das linhas
        var saida = '';
        var ati_id_condicao_inspecao = 0;

        var table = document.getElementById("tblFicha_2_GRUPOS");
        var grupoAtual = 0; var nomeGrupoAtual = ""; var nomeGrupoAnterior = "";
        var grupoAnterior = 0; var grupoNOK = 0;
        var linhaGrupo = "";
        var linhaOK = true;

        for (var i = 0; i < table.rows.length; i++) {
            if ((table.rows[i].id.includes("trFICHA2_")) && (!table.rows[i].id.includes("trFICHA2_OOBBJJIIDD_GGG_VVV"))) {
                var GGG_VVV = table.rows[i].id.replace("trFICHA2_", "");
                var aux = GGG_VVV.split("_");
                var obj_id = aux[1];
                var ogv_id = aux[2];

                grupoAtual = aux[1];

                if (parseInt(aux[aux.length - 1]) == 0)
                    grupoAnterior = aux[1];

                GGG_VVV = obj_id + "_" + ogv_id;
                var ogi_id_caracterizacao_situacao = document.getElementById("cmb_situacao_" + GGG_VVV).options[document.getElementById("cmb_situacao_" + GGG_VVV).selectedIndex].value;

                if (table.rows[i].cells.length > 6) {
                    ati_id_condicao_inspecao = document.getElementById("cmb_condicao_" + GGG_VVV).options[document.getElementById("cmb_condicao_" + GGG_VVV).selectedIndex].value;

                    // acha o nomeGrupoAtual
                    var elemento = table.rows[i].cells[0].getElementsByTagName("label");
                    if (elemento.length > 0) {
                        nomeGrupoAtual = elemento[0].innerText; // alert(nomeGrupoAtual);
                    }
                }

                var ovv_observacoes_gerais = document.getElementById("txt_obs_" + GGG_VVV).value;
                var tpu_id = " ";

                var ovv_tpu_quantidade = document.getElementById("txt_quantidade_" + GGG_VVV).value;
                var tpu_unidade = document.getElementById("txt_unidade_" + GGG_VVV).value;

                if (ovv_observacoes_gerais.trim() == "")
                    ovv_observacoes_gerais = " ";

                if (tpu_unidade.trim() == "")
                    tpu_unidade = " ";

                if (isNaN(ovv_tpu_quantidade))
                    ovv_tpu_quantidade = 0;

                var linhaMontada = '<tr_linha>' + obj_id + '<quebra>' + ogv_id + '<quebra>' + ogi_id_caracterizacao_situacao + '<quebra>' + ati_id_condicao_inspecao + '<quebra>' + ovv_observacoes_gerais + '<quebra>' + tpu_id + '<quebra>' + tpu_unidade + '<quebra>' + ovv_tpu_quantidade + '</tr_linha>';

                if (parseInt(ati_id_condicao_inspecao) == 0) {
                    linhaOK = false;
                    grupoNOK = grupoAtual;
                }

                if (grupoAnterior == grupoAtual) {
                    linhaGrupo = linhaGrupo + linhaMontada;
                }
                else {
                    saida = saida + linhaGrupo;
                    if ((!linhaOK) && (grupoNOK == grupoAnterior)) {
                        swal({
                            type: 'error',
                            title: 'Aviso',
                            text: 'O Grupo [' + nomeGrupoAnterior + '] possui dados incompletos ou inválidos'
                        }).then(
                            function () {
                                //  alert(linhaGrupo);
                                nomeGrupoAnterior = nomeGrupoAtual;
                                nomeGrupoAtual = "";
                                linhaGrupo = linhaMontada;
                                linhaOK = true; grupoNOK = 0;
                                return false;
                            });

                        return false;
                        //alert("Grupo incompleto [" + nomeGrupoAnterior + "] i=" + i);
                        //alert(linhaGrupo);
                    }

                    nomeGrupoAnterior = nomeGrupoAtual;
                    nomeGrupoAtual = "";
                    linhaGrupo = linhaMontada;
                    linhaOK = true; grupoNOK = 0;
                }
                grupoAnterior = grupoAtual;
            }
        }
        saida = saida + linhaGrupo;
        //alert(saida);

        // ********* ENVIA OS DADOS PARA O BANCO **********************************************************************
        //url: "/Objeto/GruposVariaveisValores_Salvar",

        var ord_id = 0;
        if (paginaPai == "OrdemServico")
            ord_id = selectedId_ord_id;

        $.ajax({
            url: "/Objeto/GruposVariaveisValores_Salvar",
            data: JSON.stringify({
                'obj_id_tipoOAE': selectedId_obj_id, 'Ponto1': P1, 'Ponto2': P2, 'Ponto3': P3, 'OutrasInformacoes': OutrasInformacoes, 'listaConcatenada': saida, 'ord_id': ord_id }),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                Ficha2_CriarTabelaGrupos(true);

                document.getElementById("btn_Salvar_INSPECAO_ROTINEIRA").style.display = 'none';
                document.getElementById("btn_Cancelar_INSPECAO_ROTINEIRA").style.display = 'none';
                document.getElementById("btn_Editar_INSPECAO_ROTINEIRA").style.display = 'block';


                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });


        return false;
    }
    function SalvarDados_Ficha2(tabela) {
        var saida = '';
        var array_filtrado = controlesReadOnlyFicha2.filter((el) => !controlesExcecoes_Salvar.includes(el));

        var lstInputsList = tabela.getElementsByTagName('input'); // lista de textbox

        // convert nodelist to array
        var lstInputs = [];
        for (var i = 0; i < lstInputsList.length; i++) 
            lstInputs.push(lstInputsList[i].id);

        lstInputs.push("txt_historico_Pontuacao_Geral_OAE_1");
        lstInputs.push("txt_atr_id_157");

        for (var i = 0; i < lstInputs.length; i++) {
            if ((!array_filtrado.includes(lstInputs[i]))
            || (lstInputs[i] == "txt_historico_Pontuacao_Geral_OAE_1"))
            {
                var txtId = lstInputs[i];
                // tratamento para os itens id = 1000 + id;
                var atributo_id = parseInt(txtId.substring(txtId.lastIndexOf("_") + 1, 100));
                if (atributo_id > 1000)
                    txtId = txtId.substring(0, txtId.lastIndexOf("_")) + "_" + (atributo_id - 1000);
                var txt = document.getElementById(txtId);
                if (txt)
                    saida = saida + ";" + txtId + ":" + txt.value;
            }
        }


        var lstCombos = tabela.getElementsByTagName('select'); // lista de combos
        for (var i = 0; i < lstCombos.length; i++) {
            if (!array_filtrado.includes(lstCombos[i].id))
                if (lstCombos[i].selectedIndex > -1) {
                    var cmbId = lstCombos[i].id;

                    if ((cmbId == "")) {

                    }
                    else {
                        // tratamento para os itens cujo id = 1000 + id;
                        var atributo_id = parseInt(cmbId.substring(cmbId.lastIndexOf("_") + 1, 100));
                        if (atributo_id > 1000)
                            cmbId = cmbId.substring(0, cmbId.lastIndexOf("_")) + "_" + (atributo_id - 1000);
                    }
                    saida = saida + ";" + cmbId + ":" + lstCombos[i].options[lstCombos[i].selectedIndex].value;
                }
        }


        saida = saida.substr(1) + ";"; //  retira ponto e virgula do comeco acrescenta no final

        //alert(saida);
        // ******************** manda os dados para o banco *************************
        var param = {
            obj_id: selectedId_obj_id,
            atr_id: -2,
            ati_id: -2,
            atv_valores: saida,
            nome_aba: tabela.id
        };

        var ord_id = -1;
        if (moduloCorrente == 'OrdemServico')
            ord_id = selectedId_ord_id;

        var codigoOAE = txt_atr_id_106.value + "-" + txt_atr_id_13.value;

        var selidTipoOAE = cmb_atr_id_98.options[cmb_atr_id_98.selectedIndex].value;

        param = JSON.stringify({ 'ObjAtributoValor': param, 'codigoOAE': codigoOAE, 'selidTipoOAE': selidTipoOAE, ord_id: ord_id });
     //   url: "/Objeto/ObjAtributoValores_Salvar",

        $.ajax({
            url: "/Inspecao/InspecaoAtributoValores_Salvar",
            data: param,
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                preenchetblFicha2(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);

                // alterna os campos para leitura
                Ficha2_setaReadWrite(tabela, true);

                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });



    }
    function SalvarDados_Ficha2_CRITERIO_DE_CLASSIFICACAO() {
        var tabela = document.getElementById("tblFicha2_CRITERIO_DE_CLASSIFICACAO");
        SalvarDados_Ficha2(tabela);

        tabela = document.getElementById("tblFicha2_POLITICA_ACOES_A_IMPLEMENTAR");
        SalvarDados_Ficha2(tabela);
    }
    function SalvarDados_Ficha2_NOTA_OAE_PARAMETRO_FUNCIONAL() {
        var tabela = document.getElementById("tblFicha2_NOTA_OAE_PARAMETRO_FUNCIONAL");
        SalvarDados_Ficha2(tabela);

        tabela = document.getElementById("tblFicha2_POLITICA_ACOES_A_IMPLEMENTAR");
        SalvarDados_Ficha2(tabela);

        //var cmb = document.getElementById("cmb_atr_id_145");
        //var valor = cmb.options[cmb.selectedIndex].value;
        //var param = {
        //    obj_id: selectedId_obj_id,
        //    atr_id: 145,
        //    ati_id: valor,
        //    atv_valores: valor
        //};

        //param = JSON.stringify({ 'ObjAtributoValor': param });

        //$.ajax({
        //    url: "/Objeto/ObjAtributoValor_Salvar",
        //    data: param,
        //    type: "POST",
        //    contentType: "application/json;charset=utf-8",
        //    dataType: "json",
        //    success: function (result) {

        //        preenchetblFicha2(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);

        //        // alterna os campos para leitura
        //        Ficha2_setaReadWrite(tblFicha2_NOTA_OAE_PARAMETRO_FUNCIONAL, true);

        //        return false;
        //    },
        //    error: function (errormessage) {
        //        alert(errormessage.responseText);
        //        return false;
        //    }
        //});


    }

    function CancelarDados_Ficha2(tabela) {
        Ficha2_setaReadWrite(tabela, true);

        preenchetblFicha2(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);
    }


    // popup GRUPOS
    function Ficha2_preencheCombo(clo_id, qualCombo, txtPlaceholder, tip_pai) {
        if (tip_pai == null)
            tip_pai = -1;

        //   var excluir_existentes = qualCombo == 'divFicha2_GrupoObjetos' ? 1 : 0;
        var excluir_existentes = 0;

        var cmb = $("#" + qualCombo);
        cmb.html(""); // limpa os itens existentes
        cmb.append($('<option selected ></option>').val(-1).html(txtPlaceholder)); // 1o item vazio

        $.ajax({
            url: '/Objeto/PreenchecmbTiposObjeto',
            type: "POST",
            dataType: "JSON",
            data: { clo_id: clo_id, tip_pai: tip_pai, excluir_existentes: excluir_existentes, obj_id: selectedId_obj_id },
            success: function (lstSubNiveis) {

                if (clo_id != 9) {
                    $.each(lstSubNiveis, function (i, subNivel) {
                        cmb.append($('<option></option>').val(subNivel.Value.trim()).html(subNivel.Text.trim()));
                    });
                }
                else {
                    var i = 0;
                    $("#divFicha2_GrupoObjetos").empty();
                    $.each(lstSubNiveis, function (i, objeto) {
                        i++;
                        if (i < 50) {
                            var tagchk = '<input type="checkbox" id="idXXX" nome="nameXXX" value="valueXXX" style="margin-right:5px">';
                            tagchk = tagchk.replace("idXXX", "chk" + i);
                            tagchk = tagchk.replace("nameXXX", "chk" + i);
                            tagchk = tagchk.replace("valueXXX", objeto.Value);

                            var taglbl = '<label for="idXXX" class="chklst" >TextoXXX</label> <br />';
                            taglbl = taglbl.replace("idXXX", "chk" + i);
                            taglbl = taglbl.replace("TextoXXX", objeto.Text);

                            $("#divFicha2_GrupoObjetos").append(tagchk + taglbl);
                        }
                    });
                }
            }
        });
    }
    function Ficha2_LimparCampos(aPartirDe) {

        if (aPartirDe <= 6) {
            $("#Ficha2_cmbSubdivisao2").html("");
        }

        if (aPartirDe <= 7) $("#Ficha2_cmbSubdivisao3").html(""); // limpa os itens existentes;
        if (aPartirDe <= 8) $("#divFicha2_GrupoObjetos").html(""); // limpa os itens existentes;
    }

    function btn_SelecionarGrupo_INSPECAO_ROTINEIRA_onclick() {
        var Ficha2_cmbSubdivisao1 = document.getElementById("Ficha2_cmbSubdivisao1");
        Ficha2_cmbSubdivisao1.selectedIndex = -1;

        Ficha2_LimparCampos(6);
        $("#modalSelecionarGrupo").modal('show');

    }
    function Ficha2_cmbSubdivisao1_onchange() {

        Ficha2_LimparCampos(6);

        // preenche proximo combo
        var valor = document.getElementById("Ficha2_cmbSubdivisao1").value;
        var ivalor = parseInt(valor);

        //var cmbTiposObjeto_FichaInspecaoRotineira = document.getElementById("cmbTiposObjeto_FichaInspecaoRotineira");
        //$("#Ficha2_cmbSubdivisao2").html(""); // limpa tudo
        //$("#Ficha2_cmbSubdivisao2").append($('<option selected ></option>').val(-1).html('-- Selecione --'));

        // oculta o divs Ficha2_Subdivisao2
        document.getElementById("Ficha2_divSubdivisao2").style.display = 'none';
        document.getElementById("Ficha2_divSubdivisao3").style.display = 'none';
        document.getElementById("Ficha2_divGrupoObjetos").style.display = 'block';

        // superestrutura
        if (ivalor == 11) {
            // mostra Subdivisao2
            document.getElementById("Ficha2_divSubdivisao2").style.display = 'block';
            Ficha2_preencheCombo(7, 'Ficha2_cmbSubdivisao2', '--Selecione--', ivalor);

            //// preenche combo manualmente, tip_id = 15 (tabuleiro face superior) e 16 (tabuleiro face inferior)
            //for (var i = 0; i < cmbTiposObjeto_FichaInspecaoRotineira.options.length; i++) {
            //    if ((getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 15)
            //        || (getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 16)) {
            //        var option = document.createElement("option");
            //        option.text = cmbTiposObjeto_FichaInspecaoRotineira.options[i].text;
            //        option.value = cmbTiposObjeto_FichaInspecaoRotineira.options[i].value;
            //        $("#Ficha2_cmbSubdivisao2").append($('<option></option>').val(option.value).html(option.text));
            //    }
            //}
        }
        else
            // ENCONTROS
            if (ivalor == 14) {
                // oculta tudo e deixa somente o botao salvar
                document.getElementById("Ficha2_divGrupoObjetos").style.display = 'none';

                //// mostra Subdivisao2 e 3
                //document.getElementById("Ficha2_divSubdivisao2").style.display = 'block';

                //// preenche combo manualmente, tip_id = 22,23,24 ESTRUTURAS DE TERRRA, DE CONCRETO E ACESSOS
                //$("#Ficha2_cmbSubdivisao2").append($('<option></option>').val("").html("--Selecione--"));
                //for (var i = 0; i < cmbTiposObjeto_FichaInspecaoRotineira.options.length; i++) {
                //    if ((getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 22)
                //        || (getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 23)
                //        || (getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 24)
                //    ) {
                //        var option = document.createElement("option");
                //        option.text = cmbTiposObjeto_FichaInspecaoRotineira.options[i].text;
                //        option.value = cmbTiposObjeto_FichaInspecaoRotineira.options[i].value;
                //        $("#Ficha2_cmbSubdivisao2").append($('<option></option>').val(option.value).html(option.text));
                //    }
                //}
            }
            else
                Ficha2_preencheCombo(9, 'divFicha2_GrupoObjetos', '--Selecione--', ivalor);

    }
    function Ficha2_cmbSubdivisao2_onchange() {

        // oculta o divs Subdivisao3
        document.getElementById("Ficha2_divSubdivisao3").style.display = 'none';

        // preenche proximo combo
        var valor = document.getElementById("Ficha2_cmbSubdivisao2").value;
        var ivalor = getTipoId(valor);

        if ((ivalor == 24) || (ivalor == 15) || (ivalor == 16)) { // 15 = Tabuleiro Face Superior; 16=Tabuleiro Face Inferior; 24 = Acesso
            Ficha2_LimparCampos(9);
            Ficha2_preencheCombo(9, 'divFicha2_GrupoObjetos', '--Selecione--', ivalor)
        }
        else {
            Ficha2_LimparCampos(8);
            document.getElementById("Ficha2_divSubdivisao3").style.display = 'block';
            Ficha2_preencheCombo(8, 'Ficha2_cmbSubdivisao3', '--Selecione--', ivalor)
        }


    }
    function Ficha2_cmbSubdivisao3_onchange() {

        // preenche proximo combo
        var valor = document.getElementById("Ficha2_cmbSubdivisao3").value;
        var ivalor = getTipoId(valor);

        Ficha2_LimparCampos(8);
        Ficha2_preencheCombo(9, 'divFicha2_GrupoObjetos', '--Selecione--', ivalor)
    }
    function Ficha2_bntSalvar_Grupos_click() {

        var iFicha2_cmbSubdivisao1 = parseInt($("#Ficha2_cmbSubdivisao1").val());

        // cria lista dos IDs de Grupos selecionados
        var selchks = [];
        $('#divFicha2_GrupoObjetos input:checked').each(function () {
            selchks.push($(this).attr('value'));
        });

        //se houver grupos selecionados, salva
        if ((selchks.length > 0) && (iFicha2_cmbSubdivisao1 != 14)
            || (iFicha2_cmbSubdivisao1 == 14)) {
            var codigoTipoOAE = $("#txt_atr_id_102").val();

            // cria o prefixo dos grupos
            var Ficha2_cmbSubdivisao1 = "";
            switch (iFicha2_cmbSubdivisao1) {
                case 11: Ficha2_cmbSubdivisao1 = "SE"; break;
                case 12: Ficha2_cmbSubdivisao1 = "ME"; break;
                case 13: Ficha2_cmbSubdivisao1 = "IE"; break;
                case 14: Ficha2_cmbSubdivisao1 = "ENC"; break;
            }

            var grupo_Prefixo = codigoTipoOAE + "-" + Ficha2_cmbSubdivisao1;

            if (iFicha2_cmbSubdivisao1 != 14) {
                var Ficha2_divSubdivisao2 = document.getElementById("Ficha2_divSubdivisao2");
                if (Ficha2_divSubdivisao2.style.display != 'none') {
                    var grupo_Prefixo = grupo_Prefixo + "-" + getTipoCodigo($("#Ficha2_cmbSubdivisao2").val());

                    var Ficha2_divSubdivisao3 = document.getElementById("Ficha2_divSubdivisao3");
                    if (Ficha2_divSubdivisao3.style.display != 'none') {
                        grupo_Prefixo = grupo_Prefixo + "-" + getTipoCodigo($("#Ficha2_cmbSubdivisao3").val());
                    }
                }

                //cria a lista de elementos (GRUPOS)
                var grupos_codigos = "";
                for (var i = 0; i < selchks.length; i++)
                    if (i == 0)
                        grupos_codigos = grupo_Prefixo + "-" + getTipoCodigo(selchks[i]);
                    else
                        grupos_codigos = grupos_codigos + ";" + grupo_Prefixo + "-" + getTipoCodigo(selchks[i]);

                grupos_codigos = grupos_codigos + ";"; // acrescenta um delimitador no final da string
            }
            else
                grupos_codigos = grupo_Prefixo; // codigo encontros + delimitador no final da string


            var listaGrupos = {
                obj_id: selectedId_obj_id,
                grupos_codigos: grupos_codigos
            };

            $.ajax({
                url: "/Objeto/AssociarGruposVariaveis",
                data: JSON.stringify(listaGrupos),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {

                    // atualiza os dados
                    Ficha2_CriarTabelaGrupos();

                    $("#modalSelecionarGrupo").modal('hide');
                    return false;
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                    $("#modalSelecionarGrupo").modal('show');
                    return false;
                }
            });
        }
        else {
            swal({
                type: 'error',
                title: 'Aviso',
                text: 'Grupo(s) não selecionado(s)'
            }).then(
                function () {
                    return false;
                });
        }
        return false;
    }


    // parte 3
    function Ficha2_Calcula_Notas_1_Requisito() {
        var cmb_atr_id_99 = document.getElementById("cmb_atr_id_99");
        var cmb_atr_id_99_val = 0;
        if (cmb_atr_id_99.selectedIndex > -1)
            cmb_atr_id_99_val = parseInt(cmb_atr_id_99.options[cmb_atr_id_99.selectedIndex].text);
        else
            cmb_atr_id_99_val = 0;

        var cmb_atr_id_100 = document.getElementById("cmb_atr_id_100");
        var cmb_atr_id_100_val = 0;
        if (cmb_atr_id_100.selectedIndex > -1)
            cmb_atr_id_100_val = parseInt(cmb_atr_id_100.options[cmb_atr_id_100.selectedIndex].text);
        else
            cmb_atr_id_100_val = 0;


        var cmb_atr_id_130 = document.getElementById("cmb_atr_id_130");
        var cmb_atr_id_131 = document.getElementById("cmb_atr_id_131");
        cmb_atr_id_130.selectedIndex = cmb_atr_id_99.selectedIndex;
        cmb_atr_id_131.selectedIndex = cmb_atr_id_100.selectedIndex;

        if (cmb_atr_id_130.selectedIndex > -1)
            document.getElementById("lblcmb_130").innerText = cmb_atr_id_130.options[cmb_atr_id_130.selectedIndex].text;
        else
            document.getElementById("lblcmb_130").innerText = "";

        if (cmb_atr_id_131.selectedIndex > -1)
            document.getElementById("lblcmb_131").innerText = cmb_atr_id_131.options[cmb_atr_id_131.selectedIndex].text;
        else
            document.getElementById("lblcmb_131").innerText = "";

        document.getElementById("txt_atr_id_151").value = cmb_atr_id_99_val + cmb_atr_id_100_val;


        var soma22 = document.getElementById("txt_atr_id_152").value; // = parseInt(cmb_atr_id_100_val);
        if (isNaN(soma22))
            soma2 = 0;
        else
            soma2 = parseFloat(soma22);

        var total = parseFloat(soma22) + cmb_atr_id_99_val + cmb_atr_id_100_val;
        document.getElementById("txt_atr_id_157").value = total.toFixed(2);
        document.getElementById("txt_historico_Pontuacao_Geral_OAE_1").value = total.toFixed(2);

        // preenche o ultimo item do menu acordeon
        var cmb1_Nota = document.getElementById("cmb_atr_id_147");
        var cmb1_Desc = document.getElementById("cmb_atr_id_148");

        if ((cmb_atr_id_99_val <= cmb_atr_id_100_val) && (cmb_atr_id_99_val > 0)) {
            cmb1_Nota.selectedIndex = cmb_atr_id_99.selectedIndex;
            cmb1_Desc.selectedIndex = cmb_atr_id_99.selectedIndex;
            document.getElementById("lblcmb_148").innerText = cmb1_Desc.options[cmb_atr_id_99.selectedIndex].text;
        }
        else
            if ((cmb_atr_id_99_val > cmb_atr_id_100_val) && (cmb_atr_id_100_val > 0)) {
                cmb1_Nota.selectedIndex = cmb_atr_id_100.selectedIndex;
                cmb1_Desc.selectedIndex = cmb_atr_id_100.selectedIndex;
                document.getElementById("lblcmb_148").innerText = cmb1_Desc.options[cmb_atr_id_100.selectedIndex].text;
            }

    }
    function Ficha2_Calcula_Notas_2_Requisito() {
        // localiza os controles
        var cmb1 = document.getElementById("cmb_atr_id_1084"); var cmb1_Nota = document.getElementById("cmb_atr_id_135");
        var cmb2 = document.getElementById("cmb_atr_id_1085"); var cmb2_Nota = document.getElementById("cmb_atr_id_136");
        var cmb3 = document.getElementById("cmb_atr_id_1091"); var cmb3_Nota = document.getElementById("cmb_atr_id_137");
        var cmb4 = document.getElementById("cmb_atr_id_1087"); var cmb4_Nota = document.getElementById("cmb_atr_id_138");
        var cmb5 = document.getElementById("cmb_atr_id_1088"); var cmb5_Nota = document.getElementById("cmb_atr_id_139");
        var cmb6 = document.getElementById("cmb_atr_id_1089"); var cmb6_Nota = document.getElementById("cmb_atr_id_140");
        var cmb7 = document.getElementById("cmb_atr_id_1093"); var cmb7_Nota = document.getElementById("cmb_atr_id_141");
        var cmb8 = document.getElementById("cmb_atr_id_1020"); var cmb8_Nota = document.getElementById("cmb_atr_id_142");
        var cmb9 = document.getElementById("cmb_atr_id_1092"); var cmb9_Nota = document.getElementById("cmb_atr_id_143");
        var cmb10 = document.getElementById("cmb_atr_id_1094"); var cmb10_Nota = document.getElementById("cmb_atr_id_144");

        // posiciona os combos Nota
        cmb1_Nota.selectedIndex = cmb1.selectedIndex;
        cmb2_Nota.selectedIndex = cmb2.selectedIndex;
        cmb3_Nota.selectedIndex = cmb3.selectedIndex;
        cmb4_Nota.selectedIndex = cmb4.selectedIndex;
        cmb5_Nota.selectedIndex = cmb5.selectedIndex;
        cmb6_Nota.selectedIndex = cmb6.selectedIndex;
        cmb7_Nota.selectedIndex = cmb7.selectedIndex;
        cmb8_Nota.selectedIndex = cmb8.selectedIndex;
        cmb9_Nota.selectedIndex = cmb9.selectedIndex;
        cmb10_Nota.selectedIndex = cmb10.selectedIndex;

        // acha os valores
        var cmb_val1 = 0; var cmb_val2 = 0; var cmb_val3 = 0; var cmb_val4 = 0; var cmb_val5 = 0;
        var cmb_val6 = 0; var cmb_val7 = 0; var cmb_val8 = 0; var cmb_val9 = 0; var cmb_val10 = 0;

        if (cmb1_Nota.selectedIndex > -1) cmb_val1 = parseFloat(cmb1_Nota.options[cmb1_Nota.selectedIndex].text);
        if (cmb2_Nota.selectedIndex > -1) cmb_val2 = parseFloat(cmb2_Nota.options[cmb2_Nota.selectedIndex].text);
        if (cmb3_Nota.selectedIndex > -1) cmb_val3 = parseFloat(cmb3_Nota.options[cmb3_Nota.selectedIndex].text);
        if (cmb4_Nota.selectedIndex > -1) cmb_val4 = parseFloat(cmb4_Nota.options[cmb4_Nota.selectedIndex].text);
        if (cmb5_Nota.selectedIndex > -1) cmb_val5 = parseFloat(cmb5_Nota.options[cmb5_Nota.selectedIndex].text);
        if (cmb6_Nota.selectedIndex > -1) cmb_val6 = parseFloat(cmb6_Nota.options[cmb6_Nota.selectedIndex].text);
        if (cmb7_Nota.selectedIndex > -1) cmb_val7 = parseFloat(cmb7_Nota.options[cmb7_Nota.selectedIndex].text);
        if (cmb8_Nota.selectedIndex > -1) cmb_val8 = parseFloat(cmb8_Nota.options[cmb8_Nota.selectedIndex].text);
        if (cmb9_Nota.selectedIndex > -1) cmb_val9 = parseFloat(cmb9_Nota.options[cmb9_Nota.selectedIndex].text);
        if (cmb10_Nota.selectedIndex > -1) cmb_val10 = parseFloat(cmb10_Nota.options[cmb10_Nota.selectedIndex].text);

        // calcula a nota
        var soma2 = cmb_val1 + cmb_val2 + cmb_val3 + cmb_val4 + cmb_val5 + cmb_val6 + cmb_val7 + cmb_val8 + cmb_val9 + cmb_val10;
        document.getElementById("txt_atr_id_152").value = soma2.toFixed(2);

        var soma11 = document.getElementById("txt_atr_id_151").value; // = parseInt(cmb_atr_id_100_val);
        var soma1 = 0;
        if ((isNaN(soma11)) || (soma11.trim() == ""))
            soma1 = 0;
        else
            soma1 = parseInt(soma11);

        var total = parseFloat(soma2) + soma1;
        document.getElementById("txt_atr_id_157").value = total.toFixed(2);
        document.getElementById("txt_historico_Pontuacao_Geral_OAE_1").value = total.toFixed(2);
    }
    function Ficha2_Calcula_Nota_Parametro_Funcional() {
        var cmb1 = document.getElementById("cmb_atr_id_145");
        var cmb = document.getElementById("cmb_atr_id_146");

        cmb.selectedIndex = cmb1.selectedIndex;

        var cmb_atr_id_146_val = 0;
        if (cmb1.selectedIndex > -1)
            cmb_atr_id_146_val = cmb.options[cmb.selectedIndex].text;

        if (cmb1.selectedIndex > -1)
            document.getElementById("txt_atr_id_153").value = cmb1.options[cmb1.selectedIndex].text;
        else
            document.getElementById("txt_atr_id_153").value = 0;

        document.getElementById("lblcmb_146").innerText = cmb_atr_id_146_val;


        // preenche o ultimo item do menu acordeon
        var cmb2_Nota = document.getElementById("cmb_atr_id_149");
        var cmb2_Desc = document.getElementById("cmb_atr_id_150");

        if (cmb1.selectedIndex > -1) {
            cmb2_Nota.selectedIndex = cmb1.selectedIndex;
            cmb2_Desc.selectedIndex = cmb1.selectedIndex;
            document.getElementById("lblcmb_150").innerText = cmb2_Desc.options[cmb2_Desc.selectedIndex].text;
        }

    }
    function Ficha2_Calcula_Notas_Tudo() {
        Ficha2_Calcula_Notas_1_Requisito();
        Ficha2_Calcula_Notas_2_Requisito();
        Ficha2_Calcula_Nota_Parametro_Funcional();
    }

</script>

@***** SCRIPT FICHA 4 - ESPECIAL ***********************@

<script>

    //var selectedId_clo_id = -1;
    //var selectedId_tip_id = -1;
    //var moduloCorrente = '';

    // var controlesReadOnlyFicha4 = ["txt_atr_id_13", "txt_atr_id_102", "txt_atr_id_105", "txt_atr_id_106", "txt_atr_id_107", "cmb_atr_id_130", "cmb_atr_id_131",
        //"cmb_atr_id_1020", "cmb_atr_id_1084", "cmb_atr_id_1085", "cmb_atr_id_1087", "cmb_atr_id_1088", "cmb_atr_id_1089", "cmb_atr_id_1091", "cmb_atr_id_1092", "cmb_atr_id_1093", "cmb_atr_id_1094",
    var controlesReadOnlyFicha4 = ["txt_atr_id_13", "txt_atr_id_102", "txt_atr_id_106", "cmb_atr_id_130", "cmb_atr_id_131",
        "cmb_atr_id_135", "cmb_atr_id_136", "cmb_atr_id_137", "cmb_atr_id_138", "cmb_atr_id_139", "cmb_atr_id_140", "cmb_atr_id_141", "cmb_atr_id_142", "cmb_atr_id_143", "cmb_atr_id_144", "txt_atr_id_151", "txt_atr_id_152", "txt_atr_id_153",
        , "txt_historico_Pontuacao_Geral_OAE_1", "txt_historico_documento_2", "txt_historico_data_2", "txt_historico_executantes_2", "txt_historico_Pontuacao_Geral_OAE_2", "txt_historico_documento_3", "txt_historico_data_3", "txt_historico_executantes_3", "txt_historico_Pontuacao_Geral_OAE_3"];

    //var controlesExcecoes_Salvar = ["cmb_atr_id_130", "cmb_atr_id_131", "cmb_atr_id_135", "cmb_atr_id_136", "cmb_atr_id_137", "cmb_atr_id_138", "cmb_atr_id_139", "cmb_atr_id_140", "cmb_atr_id_141", "cmb_atr_id_142", "cmb_atr_id_143", "cmb_atr_id_144", "cmb_atr_id_148", "cmb_atr_id_150", "txt_atr_id_151", "txt_atr_id_152", "txt_atr_id_153", "txt_atr_id_157"];

    var controles_Nao_Preencher_Valores = ["lblatr_id_157", "txt_atr_id_157", "txt_atr_id_99", "txt_atr_id_100", "txt_atr_id_145", "txt_atr_id_147", "txt_atr_id_149",
        // "cmb_atr_id_99", "cmb_atr_id_100", "cmb_atr_id_145", "cmb_atr_id_147", "cmb_atr_id_149"
    ];

    function esquemaBrowse_onchange(File) {
        // var File = this.files;
        if (File && File[0]) {
            //UploadEsquema();
            var file = File[0]; // $('#esquemaBrowse').get(0).files;

            // checa o tamanho do arquivo
            var tamanhoMb = (file.size / 1024 / 1024);
            if (tamanhoMb > 2) {
                showMessage('warning', 'Aviso', 'O tamanho máximo permitido é 2Mb');
                return;
            }

            var porcentagem = 0;
            let timerInterval
            Swal.fire({
                title: 'Enviando arquivo para o servidor',
                html: '<b></b>%',
                timer: 200000,
                timerProgressBar: false,
                allowOutsideClick: false,
                onBeforeOpen: () => {
                    Swal.showLoading()
                    timerInterval = setInterval(() => {
                        const content = Swal.getContent()
                        if (content) {
                            const b = content.querySelector('b')
                            if (b) {
                                b.textContent = porcentagem;
                            }
                        }
                    }, 100)
                },
                onClose: () => {
                    clearInterval(timerInterval)
                    return;
                }
            }).then((result) => {
                Swal.close();
                return;
            })

            var data = new FormData;
            data.append("EsquemaEstrutural", File[0]);
            data.append("obj_id", selectedId_obj_id);
            data.append("atr_id", 159);


            $.ajax({
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener("progress", function (evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = evt.loaded / evt.total;
                            percentComplete = parseInt(percentComplete * 100);

                            porcentagem = percentComplete;
                            if (percentComplete === 100) {
                                Swal.close();
                            }

                        }
                    }, false);
                    return xhr;
                },

                type: "Post",
                url: "/Objeto/EsquemaEstrutural_Upload",
                data: data,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.data != "") {
                        //alert("ok");
                        document.getElementById("img_atr_id_159").setAttribute('src', response.data);

                        swal({
                            type: 'success',
                            title: 'Sucesso',
                            text: 'Arquivo salvo com sucesso'
                        });


                        return false;
                    }
                    else {
                        swal({
                            type: 'error',
                            title: 'Aviso',
                            text: response
                        });
                        return false;
                    }
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                    return false;
                }
            })
        }
    }

    function accordion_encolher4(todos_menos) {
        // ENCOLHE TUDO

        // oculta os outros botoes
        document.getElementById("btn_Salvar_DADOS_GERAIS").style.display = 'none';
        document.getElementById("btn_Cancelar_DADOS_GERAIS").style.display = 'none';

        document.getElementById("btn_Salvar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
        document.getElementById("btn_Cancelar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
        document.getElementById("btn_Salvar_ATRIBUTOS_FIXOS").style.display = 'none';
        document.getElementById("btn_Cancelar_ATRIBUTOS_FIXOS").style.display = 'none';
        document.getElementById("btn_Salvar_SUPERESTRUTURA").style.display = 'none';
        document.getElementById("btn_Cancelar_SUPERESTRUTURA").style.display = 'none';
        document.getElementById("btn_Salvar_MESOESTRUTURA").style.display = 'none';
        document.getElementById("btn_Cancelar_MESOESTRUTURA").style.display = 'none';
        document.getElementById("btn_Salvar_INFRAESTRUTURA").style.display = 'none';
        document.getElementById("btn_Cancelar_INFRAESTRUTURA").style.display = 'none';
        document.getElementById("btn_Salvar_ENCONTROS").style.display = 'none';
        document.getElementById("btn_Cancelar_ENCONTROS").style.display = 'none';

        document.getElementById("btn_Salvar_ESQUEMA_ESTRUTURAL").style.display = 'none';
        document.getElementById("btn_Cancelar_ESQUEMA_ESTRUTURALS").style.display = 'none';
        document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
        document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
        document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
        document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
        document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
        document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';


        $('#div_Ficha_ATRIBUTOS_FUNCIONAIS').collapse('hide');
        document.getElementById("btn_Editar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
        document.getElementById("iconAngle_ATRIBUTOS_FUNCIONAIS").classList.remove('rotate');

        $('#div_Ficha_ATRIBUTOS_FIXOS').collapse('hide');
        document.getElementById("btn_Editar_ATRIBUTOS_FIXOS").style.display = 'none';
        document.getElementById("iconAngle_ATRIBUTOS_FIXOS").classList.remove('rotate');

        $('#div_Ficha_SUPERESTRUTURA').collapse('hide');
        document.getElementById("btn_Editar_SUPERESTRUTURA").style.display = 'none';
        document.getElementById("iconAngle_SUPERESTRUTURA").classList.remove('rotate');

        $('#div_Ficha_MESOESTRUTURA').collapse('hide');
        document.getElementById("btn_Editar_MESOESTRUTURA").style.display = 'none';
        document.getElementById("iconAngle_MESOESTRUTURA").classList.remove('rotate');

        $('#div_Ficha_INFRAESTRUTURA').collapse('hide');
        document.getElementById("btn_Editar_INFRAESTRUTURA").style.display = 'none';
        document.getElementById("iconAngle_INFRAESTRUTURA").classList.remove('rotate');

        $('#div_Ficha_ENCONTROS').collapse('hide');
        document.getElementById("btn_Editar_ENCONTROS").style.display = 'none';
        document.getElementById("iconAngle_ENCONTROS").classList.remove('rotate');

        $('#div_Ficha_ESQUEMA_ESTRUTURAL').collapse('hide');
        document.getElementById("btn_Editar_ESQUEMA_ESTRUTURAL").style.display = 'none';
        document.getElementById("iconAngle_ESQUEMA_ESTRUTURAL").classList.remove('rotate');

        $('#div_Ficha_ENCONTROS').collapse('hide');
        document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
        document.getElementById("iconAngle_CRITERIO_DE_CLASSIFICACAO").classList.remove('rotate');

        $('#div_Ficha_NOTA_OAE_PARAMETRO_FUNCIONAL').collapse('hide');
        document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
        document.getElementById("iconAngle_NOTA_OAE_PARAMETRO_FUNCIONAL").classList.remove('rotate');

        $('#div_Ficha_POLITICA_ACOES_A_IMPLEMENTAR').collapse('hide');
        document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
        document.getElementById("iconAngle_POLITICA_ACOES_A_IMPLEMENTAR").classList.remove('rotate');




        document.getElementById("btn_Editar_DADOS_GERAIS").style.display = 'block';


    }

    function nome_segundo_cabecalho4(controleId) {
        var prefix = controleId.substring(0, controleId.lastIndexOf("_") + 1);
        var num = parseInt(controleId.substring(controleId.lastIndexOf("_") + 1)) + 1000;
        return (prefix + num);

    }

    function limpatblFicha4() {

        var tabela = document.getElementById("divFicha4");

        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        var lstCombos = tabela.getElementsByTagName('select');
        var lstTextareas = tabela.getElementsByTagName('textarea');

        for (var i = 0; i < lstTxtBoxes.length; i++)
            lstTxtBoxes[i].value = "";

        for (var i = 0; i < lstTextareas.length; i++)
            lstTextareas[i].value = "";

        for (var i = 0; i < lstCombos.length; i++)
            lstCombos[i].innerText = null;

    }
    function preenchetblFicha4(obj_id, classe, tipo) {
        classe = parseInt(classe);
        tipo = parseInt(tipo);
        selectedId_clo_id = classe;
        selectedId_tip_id = tipo;


        // limpa antes de preencher
        limpatblFicha4();

        $('#txt_historico_data_1').datepicker({ dateFormat: 'dd/mm/yy' });

        var ord_id = 0;
        if (paginaPai == "OrdemServico")
            ord_id = selectedId_ord_id;

        var url = "/Objeto/ObjAtributoValores_ListAll";
        var data = { "obj_id": obj_id, "ord_id": ord_id };

        $.ajax({
            "url": url,
            "type": "GET",
            "datatype": "json",
            "data": data,
            "success": function (result) {
                for (var i = 0; i < result.data.length; i++) {

                    // coloca a imagem ESQUEMA_ESTRUTURAL
                    if (parseInt(result.data[i].atr_id) == 159) {
                        document.getElementById("img_atr_id_159").setAttribute('src', result.data[i].atv_valor);
                    }

                    // preenche os LABELS
                    var label = document.getElementById(result.data[i].atv_controle.replace("chk_", "lbl").replace("cmb_", "lbl"));
                    if (label) {
                        // procura o label2
                        var label2 = document.getElementById((nome_segundo_cabecalho4(label.id)));

                        var texto = result.data[i].atr_atributo_nome;
                        if (texto.includes('|')) {
                            partes = texto.split("|");
                            texto = partes[partes.length - 1].trim();
                        }
                        label.innerText = texto;

                        if (label2)
                            label2.innerText = texto;
                    }

                    // preenche o valor se houver
                    if (
                        (!controles_Nao_Preencher_Valores.includes(result.data[i].atv_controle.replace("lbl", "txt_")))
                        && (!controles_Nao_Preencher_Valores.includes((nome_segundo_cabecalho4(result.data[i].atv_controle.replace("lbl", "txt_"))).replace("lbl", "txt_")))
                        && (!controles_Nao_Preencher_Valores.includes(result.data[i].atv_controle))
                        && (!controles_Nao_Preencher_Valores.includes((nome_segundo_cabecalho4(result.data[i].atv_controle))))
                    ) {
                        if (parseInt(result.data[i].nItens) == 0) {
                            var textbox = document.getElementById(result.data[i].atv_controle.replace("lbl", "txt_"));
                            var textbox2 = document.getElementById((nome_segundo_cabecalho4(result.data[i].atv_controle.replace("lbl", "txt_"))).replace("lbl", "txt_"));
                            var mascara = result.data[i].atr_mascara_texto;



                            if (textbox) {
                                textbox.value = result.data[i].atv_valor;

                                // coloca mascara no textbox
                                if (mascara != "") {
                                    jQuery(textbox).mask(mascara);
                                    jQuery(textbox).attr('placeholder', mascara.replace(/9/g, '0'));
                                }

                            }
                            if (textbox2) {
                                textbox2.value = result.data[i].atv_valor;

                                if (mascara != "") {
                                    jQuery(textbox2).mask(mascara);
                                    jQuery(textbox).attr('placeholder', mascara.replace(/9/g, '0'));
                                }
                            }
                        }
                        else
                            if (result.data[i].atr_apresentacao_itens == 'combobox') {
                                var combo = document.getElementById(result.data[i].atv_controle);
                                var combo2 = document.getElementById((nome_segundo_cabecalho4(result.data[i].atv_controle)));

                                if (combo) {
                                    combo.innerText = null; // limpa

                                    if (combo2)
                                        combo2.innerText = null; // limpa

                                    // preenche combo
                                    var lista = result.data[i].atr_itens_todos.split(";");
                                    for (var m = 0; m < lista.length; m++) {
                                        var opt = document.createElement("option");
                                        opt.value = lista[m].substring(0, 3);
                                        opt.textContent = lista[m].substring(3);

                                        combo.appendChild(opt);
                                        if (combo2) {
                                            var opt2 = document.createElement("option");
                                            opt2.value = lista[m].substring(0, 3);
                                            opt2.textContent = lista[m].substring(3);
                                            combo2.appendChild(opt2);
                                        }
                                    }

                                    combo.value = result.data[i].atv_valor;
                                    if (combo2)
                                        combo2.value = result.data[i].atv_valor;
                                }
                            }
                            else
                                if (result.data[i].atr_apresentacao_itens == 'checkbox') {
                                    var checkbox_prefixo = result.data[i].atv_controle;

                                    var lista = result.data[i].atr_itens_todos.split(";");
                                    for (var m = 0; m < lista.length; m++) {
                                        var valor = lista[m].substring(0, 3);
                                        var texto = lista[m].substring(3);
                                        var checkbox = document.getElementById(checkbox_prefixo + "_" + parseInt(valor));
                                        if (checkbox) {
                                            var label = document.getElementById(checkbox_prefixo.replace("chk_", "lbl") + "_" + parseInt(valor));
                                            if (label)
                                                label.innerText = texto;

                                            checkbox.value = valor;

                                            // preenche os valores correspondentes
                                            if (parseInt(valor) == parseInt(result.data[i].ati_ids)) {
                                                var tick = result.data[i].atv_valor.substring(0, 1);
                                                checkbox.checked = tick == "1" ? true : false;

                                                // procura um textbox correspondente, do tipo checkbox+textbox
                                                var txt = document.getElementById(checkbox_prefixo.replace("chk", "txt") + "_" + parseInt(valor));
                                                if (txt) {
                                                    var texto = result.data[i].atv_valor.substr(2);
                                                    if (texto != "") {
                                                        txt.value = texto;
                                                        checkbox.checked = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                    }
                }


                Ficha4_Calcula_Notas_Tudo();
            }
        });

    }

    function Ficha4_setaReadWrite(tabela, ehRead) {
        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        var lstCombos = tabela.getElementsByTagName('select');
        var lstTextareas = tabela.getElementsByTagName('textarea');

        var cmb_atr_id_98 = document.getElementById("cmb_atr_id_98");


        // trava o
        if ((moduloCorrente == 'Objetos') // se estiver em Cadastro de Objetos,
            || ((moduloCorrente == 'OrdemServico') && (cmb_atr_id_98.selectedIndex > 0)) // se estiver em OrdemServico e já houver tipo de OAE selecionada
        ) {
            controlesReadOnlyFicha4.push("cmb_atr_id_98"); // combo Tipo OAE
            controlesReadOnlyFicha4.push("txt_atr_id_105"); // descricao Tipo OAE
        }
        for (var i = 0; i < lstTxtBoxes.length; i++)
            if (!controlesReadOnlyFicha4.includes(lstTxtBoxes[i].id))
                lstTxtBoxes[i].disabled = ehRead;

        for (var i = 0; i < lstTextareas.length; i++)
            if (!controlesReadOnlyFicha4.includes(lstTextareas[i].id))
                lstTextareas[i].disabled = ehRead;

        for (var i = 0; i < lstCombos.length; i++)
            if (!controlesReadOnlyFicha4.includes(lstCombos[i].id))
                lstCombos[i].disabled = ehRead;
            else
                lstCombos[i].disabled = true;

        // =============== ALTERNA OS BOTOES SALVAR/CANCELAR/EDITAR =============================================================
        // alterna para os botoes de salvar/cancelar
        var display1 = 'block';
        var display2 = 'none';

        if (ehRead) {
            display1 = 'none';
            display2 = 'block';
            document.getElementById("btnEsquemaUpload").style.display = 'none';
        }
        else
            document.getElementById("btnEsquemaUpload").style.display = 'unset';



        switch (tabela.id) {
            case "tblFicha4_DADOS_GERAIS":
                {
                    document.getElementById("btn_Salvar_DADOS_GERAIS").style.display = display1;
                    document.getElementById("btn_Cancelar_DADOS_GERAIS").style.display = display1;
                    document.getElementById("btn_Editar_DADOS_GERAIS").style.display = display2;
                    break;
                }
            case "tblFicha4_HISTORICO_INSPECOES":
                {
                    document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = display1;
                    document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = display1;
                    document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = display2;
                    break;
                }

            case "tblFicha4_ATRIBUTOS_FUNCIONAIS":
                {
                    document.getElementById("btn_Salvar_ATRIBUTOS_FUNCIONAIS").style.display = display1;
                    document.getElementById("btn_Cancelar_ATRIBUTOS_FUNCIONAIS").style.display = display1;
                    document.getElementById("btn_Editar_ATRIBUTOS_FUNCIONAIS").style.display = display2;
                    break;
                }

            case "tblFicha4_ATRIBUTOS_FIXOS":
                {
                    document.getElementById("btn_Salvar_ATRIBUTOS_FIXOS").style.display = display1;
                    document.getElementById("btn_Cancelar_ATRIBUTOS_FIXOS").style.display = display1;
                    document.getElementById("btn_Editar_ATRIBUTOS_FIXOS").style.display = display2;
                    break;
                }

            case "tblFicha4_SUPERESTRUTURA":
                {
                    document.getElementById("btn_Salvar_SUPERESTRUTURA").style.display = display1;
                    document.getElementById("btn_Cancelar_SUPERESTRUTURA").style.display = display1;
                    document.getElementById("btn_Editar_SUPERESTRUTURA").style.display = display2;
                    break;
                }

            case "tblFicha4_MESOESTRUTURA":
                {
                    document.getElementById("btn_Salvar_MESOESTRUTURA").style.display = display1;
                    document.getElementById("btn_Cancelar_MESOESTRUTURA").style.display = display1;
                    document.getElementById("btn_Editar_MESOESTRUTURA").style.display = display2;
                    break;
                }

            case "tblFicha4_INFRAESTRUTURA":
                {
                    document.getElementById("btn_Salvar_INFRAESTRUTURA").style.display = display1;
                    document.getElementById("btn_Cancelar_INFRAESTRUTURA").style.display = display1;
                    document.getElementById("btn_Editar_INFRAESTRUTURA").style.display = display2;
                    break;
                }

            case "tblFicha4_ENCONTROS":
                {
                    document.getElementById("btn_Salvar_ENCONTROS").style.display = display1;
                    document.getElementById("btn_Cancelar_ENCONTROS").style.display = display1;
                    document.getElementById("btn_Editar_ENCONTROS").style.display = display2;
                    break;
                }

            case "tblFicha4_DADOS_GERAIS2":
                {
                    document.getElementById("btn_Salvar_DADOS_GERAIS2").style.display = display1;
                    document.getElementById("btn_Cancelar_DADOS_GERAIS2").style.display = display1;
                    document.getElementById("btn_Editar_DADOS_GERAIS2").style.display = display2;
                    break;
                }

            case "tblFicha4_ESQUEMA_ESTRUTURAL":
                {
                    document.getElementById("btn_Salvar_ESQUEMA_ESTRUTURAL").style.display = display1;
                    document.getElementById("btn_Cancelar_ESQUEMA_ESTRUTURAL").style.display = display1;
                    document.getElementById("btn_Editar_ESQUEMA_ESTRUTURAL").style.display = display2;
                    break;
                }

            case "tblFicha4_CRITERIO_DE_CLASSIFICACAO":
                {
                    document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = display1;
                    document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = display1;
                    document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = display2;
                    break;
                }

            case "tblFicha4_POLITICA_ACOES_A_IMPLEMENTAR":
                {
                    //document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = display1;
                    //document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = display1;
                    //document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = display2;
                    break;
                }

            case "tblFicha4_NOTA_OAE_PARAMETRO_FUNCIONAL":
                {
                    document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = display1;
                    document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = display1;
                    document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = display2;
                    break;
                }
        }


    }

    function CancelarDados_Ficha4(tabela) {
        preenchetblFicha4(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);

        // alterna os campos para leitura
        Ficha4_setaReadWrite(tabela, true);

    }
    function EditarDados_Ficha4(tabela) {
        // alterna os campos para escrita
        Ficha4_setaReadWrite(tabela, false);

        return false;
    }

    function SalvarDados_Ficha4(tabela) {
        var obj_id = selectedId_obj_id;
        var atr_id = -1;
        var ati_id = -1;
        var atv_valor = -1;
        var saida = '';

        var lstTextareas = tabela.getElementsByTagName('textarea');
        for (var i = 0; i < lstTextareas.length; i++) {
            if (!controlesReadOnlyFicha4.includes(lstTextareas[i].id))
                saida = saida + ";" + lstTextareas[i].id + ":" + lstTextareas[i].value;
        }

        var lstCombos = tabela.getElementsByTagName('select');
        for (var i = 0; i < lstCombos.length; i++) {
            if (!controlesReadOnlyFicha4.includes(lstCombos[i].id))
                if (lstCombos[i].selectedIndex > -1)
                    saida = saida + ";" + lstCombos[i].id + ":" + lstCombos[i].options[lstCombos[i].selectedIndex].value;
        }


        var lstInputs = tabela.getElementsByTagName('input'); // lista de textbox + checkbox
        for (var i = 0; i < lstInputs.length; i++) {
            if ((!controlesReadOnlyFicha4.includes(lstInputs[i].id))
            || (lstInputs[i].id == "txt_historico_Pontuacao_Geral_OAE_1"))
            {
                if (lstInputs[i].type == "checkbox") {
                    // verifica se tem um texbox correspondente (para o caso de checkbox+textbox)
                    var txt = document.getElementById(lstInputs[i].id.replace("chk", "txt"));
                    if (txt) // existe o textbox
                        saida = saida + ";" + lstInputs[i].id + ":" + (lstInputs[i].checked ? 1 : 0) + ":" + txt.value;
                    else
                        saida = saida + ";" + lstInputs[i].id + ":" + (lstInputs[i].checked ? 1 : 0) + ":" + "";
                }
                else // textbox
                {
                    // verifica se tem um checkbox correspondente (para o caso de checkbox+textbox). Caso positivo, entao nao faz
                    var chk = document.getElementById(lstInputs[i].id.replace("txt", "chk"));
                    if (!chk)  // nao tem
                        saida = saida + ";" + lstInputs[i].id + ":" + lstInputs[i].value;
                }
            }
        }

        saida = saida.substr(1) + ";"; // acrescenta um ponto e virgula no final e retira do comeco


        // ********* ENVIA OS DADOS PARA O BANCO **********************************************************************
        var param = {
            obj_id: selectedId_obj_id,
            atr_id: -2,
            ati_id: -2,
            atv_valores: saida,
            nome_aba: tabela.id //.replace("tblFicha4_", "")
        };



        var txt_atr_id_13 = document.getElementById("txt_atr_id_13");
        var txt_atr_id_106 = document.getElementById("txt_atr_id_106");
        var cmb_atr_id_98 = document.getElementById("cmb_atr_id_98");


        var ord_id = -1;
        if (moduloCorrente == 'OrdemServico')
            ord_id = selectedId_ord_id;

        var codigoOAE = txt_atr_id_106.value + "-" + txt_atr_id_13.value;
        var selidTipoOAE = cmb_atr_id_98.options[cmb_atr_id_98.selectedIndex].value;
        param = JSON.stringify({ 'ObjAtributoValor': param, 'codigoOAE': codigoOAE, 'selidTipoOAE': selidTipoOAE, ord_id: ord_id });

        $.ajax({
            url: "/Objeto/ObjAtributoValores_Salvar",
            data: param,
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                //$("#modalSalvarAtributoFixoValor").modal('hide');
                //if (selectedGrid == 1)
                //    $('#tblObjAtributosFixos').DataTable().ajax.reload(null, false);  //false = sem reload na pagina.
                //else
                //    $('#tblObjAtributosFuncionais').DataTable().ajax.reload(null, false);  //false = sem reload na pagina.
                if (moduloCorrente == 'OrdemServico')
                    $('#tblOrdemServicos').DataTable().ajax.reload(null, false);  //false = sem reload na pagina.

                preenchetblFicha4(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);
                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });


        // alterna os campos para leitura
        Ficha4_setaReadWrite(tabela, true);
    }

    function SalvarDados_Ficha4_aux(tabela) {
        var saida = '';
        var array_filtrado = controlesReadOnlyFicha4.filter((el) => !controlesExcecoes_Salvar.includes(el));

        var lstInputs = tabela.getElementsByTagName('input'); // lista de textbox
        for (var i = 0; i < lstInputs.length; i++) {
            if (!array_filtrado.includes(lstInputs[i].id)) {
                var txtId = lstInputs[i].id;
                // tratamento para os itens id = 1000 + id;
                var atributo_id = parseInt(txtId.substring(txtId.lastIndexOf("_") + 1, 100));
                if (atributo_id > 1000)
                    txtId = txtId.substring(0, txtId.lastIndexOf("_")) + "_" + (atributo_id - 1000);
                var txt = document.getElementById(txtId);
                if (txt)
                    saida = saida + ";" + txtId + ":" + lstInputs[i].value;
            }
        }


        var lstCombos = tabela.getElementsByTagName('select'); // lista de combos
        for (var i = 0; i < lstCombos.length; i++) {
            if (!array_filtrado.includes(lstCombos[i].id))
                if (lstCombos[i].selectedIndex > -1) {
                    var cmbId = lstCombos[i].id;
                    // tratamento para os itens cujo id = 1000 + id;
                    var atributo_id = parseInt(cmbId.substring(cmbId.lastIndexOf("_") + 1, 100));
                    if (atributo_id > 1000)
                        cmbId = cmbId.substring(0, cmbId.lastIndexOf("_")) + "_" + (atributo_id - 1000);

                    saida = saida + ";" + cmbId + ":" + lstCombos[i].options[lstCombos[i].selectedIndex].value;
                }
        }


        saida = saida.substr(1) + ";"; //  retira ponto e virgula do comeco acrescenta no final

        //alert(saida);
        // ******************** manda os dados para o banco *************************
        var param = {
            obj_id: selectedId_obj_id,
            atr_id: -2,
            ati_id: -2,
            atv_valores: saida,
            nome_aba: tabela.id
        };

        var ord_id = -1;
        if (moduloCorrente == 'OrdemServico')
            ord_id = selectedId_ord_id;

        var codigoOAE = txt_atr_id_106.value + "-" + txt_atr_id_13.value;

        var selidTipoOAE = cmb_atr_id_98.options[cmb_atr_id_98.selectedIndex].value;

        param = JSON.stringify({ 'ObjAtributoValor': param, 'codigoOAE': codigoOAE, 'selidTipoOAE': selidTipoOAE, ord_id: ord_id });

        $.ajax({
            url: "/Objeto/ObjAtributoValores_Salvar",
            data: param,
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                preenchetblFicha4(selectedId_obj_id, selectedId_clo_id, selectedId_tip_id);

                // alterna os campos para leitura
                Ficha4_setaReadWrite(tabela, true);

                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });



    }
    function SalvarDados_Ficha4_CRITERIO_DE_CLASSIFICACAO() {
        var tabela = document.getElementById("tblFicha4_CRITERIO_DE_CLASSIFICACAO");
        SalvarDados_Ficha4_aux(tabela);

        tabela = document.getElementById("tblFicha4_POLITICA_ACOES_A_IMPLEMENTAR");
        SalvarDados_Ficha4_aux(tabela);
    }
    function SalvarDados_Ficha4_NOTA_OAE_PARAMETRO_FUNCIONAL() {
        var tabela = document.getElementById("tblFicha4_NOTA_OAE_PARAMETRO_FUNCIONAL");
        SalvarDados_Ficha4(tabela);

        tabela = document.getElementById("tblFicha4_POLITICA_ACOES_A_IMPLEMENTAR");
        SalvarDados_Ficha4(tabela);
    }

    function header_click4(quem, expandir) {
        if (expandir == null)
            expandir = 0;

        if (selectedId_clo_id <= 2) {
            expandir = 0;
            accordion_encolher4(2);
        }
        else
            switch (quem.id) {
                case "btn_Toggle_HISTORICO_INSPECOES":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_HISTORICO_INSPECOES, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'none';
                            document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'none';
                            document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_HISTORICO_INSPECOES").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'none';
                                document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_HISTORICO_INSPECOES").style.display = 'block';
                                document.getElementById("btn_Cancelar_HISTORICO_INSPECOES").style.display = 'block';
                            }

                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_HISTORICO_INSPECOES").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_ATRIBUTOS_FUNCIONAIS":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_ATRIBUTOS_FUNCIONAIS, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
                            document.getElementById("btn_Cancelar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
                            document.getElementById("btn_Editar_ATRIBUTOS_FUNCIONAIS").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
                                document.getElementById("btn_Cancelar_ATRIBUTOS_FUNCIONAIS").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_ATRIBUTOS_FUNCIONAIS").style.display = 'block';
                                document.getElementById("btn_Cancelar_ATRIBUTOS_FUNCIONAIS").style.display = 'block';
                            }

                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_ATRIBUTOS_FUNCIONAIS").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_ATRIBUTOS_FIXOS":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_ATRIBUTOS_FIXOS, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_ATRIBUTOS_FIXOS").style.display = 'none';
                            document.getElementById("btn_Cancelar_ATRIBUTOS_FIXOS").style.display = 'none';
                            document.getElementById("btn_Editar_ATRIBUTOS_FIXOS").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_ATRIBUTOS_FIXOS").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_ATRIBUTOS_FIXOS").style.display = 'none';
                                document.getElementById("btn_Cancelar_ATRIBUTOS_FIXOS").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_ATRIBUTOS_FIXOS").style.display = 'block';
                                document.getElementById("btn_Cancelar_ATRIBUTOS_FIXOS").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_ATRIBUTOS_FIXOS").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_SUPERESTRUTURA":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_SUPERESTRUTURA, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_SUPERESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Cancelar_SUPERESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Editar_SUPERESTRUTURA").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_SUPERESTRUTURA").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_SUPERESTRUTURA").style.display = 'none';
                                document.getElementById("btn_Cancelar_SUPERESTRUTURA").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_SUPERESTRUTURA").style.display = 'block';
                                document.getElementById("btn_Cancelar_SUPERESTRUTURA").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_SUPERESTRUTURA").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_MESOESTRUTURA":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_MESOESTRUTURA, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_MESOESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Cancelar_MESOESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Editar_MESOESTRUTURA").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_MESOESTRUTURA").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_MESOESTRUTURA").style.display = 'none';
                                document.getElementById("btn_Cancelar_MESOESTRUTURA").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_MESOESTRUTURA").style.display = 'block';
                                document.getElementById("btn_Cancelar_MESOESTRUTURA").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_MESOESTRUTURA").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_INFRAESTRUTURA":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_INFRAESTRUTURA, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_INFRAESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Cancelar_INFRAESTRUTURA").style.display = 'none';
                            document.getElementById("btn_Editar_INFRAESTRUTURA").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_INFRAESTRUTURA").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_INFRAESTRUTURA").style.display = 'none';
                                document.getElementById("btn_Cancelar_INFRAESTRUTURA").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_INFRAESTRUTURA").style.display = 'block';
                                document.getElementById("btn_Cancelar_INFRAESTRUTURA").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_INFRAESTRUTURA").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_ENCONTROS":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_ENCONTROS, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_ENCONTROS").style.display = 'none';
                            document.getElementById("btn_Cancelar_ENCONTROS").style.display = 'none';
                            document.getElementById("btn_Editar_ENCONTROS").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_ENCONTROS").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_ENCONTROS").style.display = 'none';
                                document.getElementById("btn_Cancelar_ENCONTROS").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_ENCONTROS").style.display = 'block';
                                document.getElementById("btn_Cancelar_ENCONTROS").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_ENCONTROS").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_ESQUEMA_ESTRUTURAL":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_ESQUEMA_ESTRUTURAL, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_ESQUEMA_ESTRUTURAL").style.display = 'none';
                            document.getElementById("btn_Cancelar_ESQUEMA_ESTRUTURAL").style.display = 'none';
                            document.getElementById("btn_Editar_ESQUEMA_ESTRUTURAL").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_ESQUEMA_ESTRUTURAL").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_ESQUEMA_ESTRUTURAL").style.display = 'none';
                                document.getElementById("btn_Cancelar_ESQUEMA_ESTRUTURAL").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_ESQUEMA_ESTRUTURAL").style.display = 'block';
                                document.getElementById("btn_Cancelar_ESQUEMA_ESTRUTURAL").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_ESQUEMA_ESTRUTURAL").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_CRITERIO_DE_CLASSIFICACAO":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_CRITERIO_DE_CLASSIFICACAO, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                                document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                                document.getElementById("btn_Cancelar_CRITERIO_DE_CLASSIFICACAO").style.display = 'block';
                            }
                        }

                        //calcula as notas
                        Ficha4_Calcula_Notas_2_Requisito();

                        // roda o icone 90graus
                        document.getElementById("iconAngle_CRITERIO_DE_CLASSIFICACAO").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_NOTA_OAE_PARAMETRO_FUNCIONAL":
                    {
                        // alterna os campos para leitura
                        Ficha4_setaReadWrite(tblFicha4_NOTA_OAE_PARAMETRO_FUNCIONAL, true);

                        // mostra o botao editar
                        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                            document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                        }
                        else {
                            document.getElementById("btn_Editar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            if (quem.getAttribute('aria-expanded') == "true") {
                                document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                                document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'none';
                            }
                            else {
                                document.getElementById("btn_Salvar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                                document.getElementById("btn_Cancelar_NOTA_OAE_PARAMETRO_FUNCIONAL").style.display = 'block';
                            }
                        }

                        // roda o icone 90graus
                        document.getElementById("iconAngle_NOTA_OAE_PARAMETRO_FUNCIONAL").classList.toggle('rotate');
                        break;
                    }

                case "btn_Toggle_POLITICA_ACOES_A_IMPLEMENTAR":
                    {
                        //// alterna os campos para leitura
                        //    Ficha4_setaReadWrite(tblFicha4_POLITICA_ACOES_A_IMPLEMENTAR, true);

                        //// mostra o botao editar
                        //if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
                        //    document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //}
                        //else {
                        //    document.getElementById("btn_Editar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    if (quem.getAttribute('aria-expanded') == "true") {
                        //        document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //        document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'none';
                        //    }
                        //    else {
                        //        document.getElementById("btn_Salvar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //        document.getElementById("btn_Cancelar_POLITICA_ACOES_A_IMPLEMENTAR").style.display = 'block';
                        //    }
                        //}

                        // roda o icone 90graus
                        document.getElementById("iconAngle_POLITICA_ACOES_A_IMPLEMENTAR").classList.toggle('rotate');
                        break;
                    }

            }
    }

    function tica_chktxt4(quem) {
        var chk = $('#' + quem.replace("txt", "chk"));
        var txt = $('#' + quem);

        if (txt.val().trim() != "")
            chk.prop('checked', true);
        else
            chk.prop('checked', false);

    }
    function chk_tick4(quem) {

        var chk = $('#' + quem);
        var txt = $('#' + quem.replace("chk", "txt"));

        if (!chk.prop('checked'))
            txt.val("");

    }

    function Ficha4_cmb_atr_id_98_onchange() {
        var cmb_atr_id_98 = document.getElementById("cmb_atr_id_98");
        var cmb_atr_id_98Val = cmb_atr_id_98.options[cmb_atr_id_98.selectedIndex].value;
        var cmb_atr_id_98Text = cmb_atr_id_98.options[cmb_atr_id_98.selectedIndex].text;

        var tip_codigo = cmb_atr_id_98Text.substring(cmb_atr_id_98Text.lastIndexOf("(") + 1, cmb_atr_id_98Text.lastIndexOf(")"));
        var tip_nome = cmb_atr_id_98Text.substring(0, cmb_atr_id_98Text.lastIndexOf("("));
        var rodoviaValue = $("#txt_atr_id_106").val();
        var kmValue = $("#txt_atr_id_13").val();

        var desc = tip_nome + " " + rodoviaValue + "-" + kmValue + "-" + tip_codigo;

        $("#txt_atr_id_105").val(desc);


    }


    // CALCULO DE NOTAS
    function Ficha4_Calcula_Notas_1_Requisito() {
        var cmb_atr_id_99 = document.getElementById("cmb_atr_id_99");
        var cmb_atr_id_99_val = 0;
        if (cmb_atr_id_99.selectedIndex > -1)
            cmb_atr_id_99_val = parseInt(cmb_atr_id_99.options[cmb_atr_id_99.selectedIndex].text);
        else
            cmb_atr_id_99_val = 0;

        var cmb_atr_id_100 = document.getElementById("cmb_atr_id_100");
        var cmb_atr_id_100_val = 0;
        if (cmb_atr_id_100.selectedIndex > -1)
            cmb_atr_id_100_val = parseInt(cmb_atr_id_100.options[cmb_atr_id_100.selectedIndex].text);
        else
            cmb_atr_id_100_val = 0;


        var cmb_atr_id_130 = document.getElementById("cmb_atr_id_130");
        var cmb_atr_id_131 = document.getElementById("cmb_atr_id_131");
        cmb_atr_id_130.selectedIndex = cmb_atr_id_99.selectedIndex;
        cmb_atr_id_131.selectedIndex = cmb_atr_id_100.selectedIndex;

        if (cmb_atr_id_130.selectedIndex > -1)
            document.getElementById("lblcmb_130").innerText = cmb_atr_id_130.options[cmb_atr_id_130.selectedIndex].text;
        else
            document.getElementById("lblcmb_130").innerText = "";

        if (cmb_atr_id_131.selectedIndex > -1)
            document.getElementById("lblcmb_131").innerText = cmb_atr_id_131.options[cmb_atr_id_131.selectedIndex].text;
        else
            document.getElementById("lblcmb_131").innerText = "";

        document.getElementById("txt_atr_id_151").value = cmb_atr_id_99_val + cmb_atr_id_100_val;


        var soma22 = document.getElementById("txt_atr_id_152").value; // = parseInt(cmb_atr_id_100_val);
        if (isNaN(soma22))
            soma2 = 0;
        else
            soma2 = parseFloat(soma22);

        var total = parseFloat(soma22) + cmb_atr_id_99_val + cmb_atr_id_100_val;
        document.getElementById("txt_atr_id_157").value = total.toFixed(2);
        document.getElementById("txt_historico_Pontuacao_Geral_OAE_1").value = total.toFixed(2);

        // preenche o ultimo item do menu acordeon
        var cmb1_Nota = document.getElementById("cmb_atr_id_147");
        var cmb1_Desc = document.getElementById("cmb_atr_id_148");

        if ((cmb_atr_id_99_val <= cmb_atr_id_100_val) && (cmb_atr_id_99_val > 0)) {
            cmb1_Nota.selectedIndex = cmb_atr_id_99.selectedIndex;
            cmb1_Desc.selectedIndex = cmb_atr_id_99.selectedIndex;
            document.getElementById("lblcmb_148").innerText = cmb1_Desc.options[cmb_atr_id_99.selectedIndex].text;
        }
        else
            if ((cmb_atr_id_99_val > cmb_atr_id_100_val) && (cmb_atr_id_100_val > 0)) {
                cmb1_Nota.selectedIndex = cmb_atr_id_100.selectedIndex;
                cmb1_Desc.selectedIndex = cmb_atr_id_100.selectedIndex;
                document.getElementById("lblcmb_148").innerText = cmb1_Desc.options[cmb_atr_id_100.selectedIndex].text;
            }

    }
    function Ficha4_Calcula_Notas_2_Requisito() {
        // localiza os controles
        var cmb1 = document.getElementById("cmb_atr_id_1084"); var cmb1_Nota = document.getElementById("cmb_atr_id_135");
        var cmb2 = document.getElementById("cmb_atr_id_1085"); var cmb2_Nota = document.getElementById("cmb_atr_id_136");
        var cmb3 = document.getElementById("cmb_atr_id_1091"); var cmb3_Nota = document.getElementById("cmb_atr_id_137");
        var cmb4 = document.getElementById("cmb_atr_id_1087"); var cmb4_Nota = document.getElementById("cmb_atr_id_138");
        var cmb5 = document.getElementById("cmb_atr_id_1088"); var cmb5_Nota = document.getElementById("cmb_atr_id_139");
        var cmb6 = document.getElementById("cmb_atr_id_1089"); var cmb6_Nota = document.getElementById("cmb_atr_id_140");
        var cmb7 = document.getElementById("cmb_atr_id_1093"); var cmb7_Nota = document.getElementById("cmb_atr_id_141");
        var cmb8 = document.getElementById("cmb_atr_id_1020"); var cmb8_Nota = document.getElementById("cmb_atr_id_142");
        var cmb9 = document.getElementById("cmb_atr_id_1092"); var cmb9_Nota = document.getElementById("cmb_atr_id_143");
        var cmb10 = document.getElementById("cmb_atr_id_1094"); var cmb10_Nota = document.getElementById("cmb_atr_id_144");

        // posiciona os combos Nota
        cmb1_Nota.selectedIndex = cmb1.selectedIndex;
        cmb2_Nota.selectedIndex = cmb2.selectedIndex;
        cmb3_Nota.selectedIndex = cmb3.selectedIndex;
        cmb4_Nota.selectedIndex = cmb4.selectedIndex;
        cmb5_Nota.selectedIndex = cmb5.selectedIndex;
        cmb6_Nota.selectedIndex = cmb6.selectedIndex;
        cmb7_Nota.selectedIndex = cmb7.selectedIndex;
        cmb8_Nota.selectedIndex = cmb8.selectedIndex;
        cmb9_Nota.selectedIndex = cmb9.selectedIndex;
        cmb10_Nota.selectedIndex = cmb10.selectedIndex;

        // acha os valores
        var cmb_val1 = 0; var cmb_val2 = 0; var cmb_val3 = 0; var cmb_val4 = 0; var cmb_val5 = 0;
        var cmb_val6 = 0; var cmb_val7 = 0; var cmb_val8 = 0; var cmb_val9 = 0; var cmb_val10 = 0;

        if (cmb1_Nota.selectedIndex > -1) cmb_val1 = parseFloat(cmb1_Nota.options[cmb1_Nota.selectedIndex].text);
        if (cmb2_Nota.selectedIndex > -1) cmb_val2 = parseFloat(cmb2_Nota.options[cmb2_Nota.selectedIndex].text);
        if (cmb3_Nota.selectedIndex > -1) cmb_val3 = parseFloat(cmb3_Nota.options[cmb3_Nota.selectedIndex].text);
        if (cmb4_Nota.selectedIndex > -1) cmb_val4 = parseFloat(cmb4_Nota.options[cmb4_Nota.selectedIndex].text);
        if (cmb5_Nota.selectedIndex > -1) cmb_val5 = parseFloat(cmb5_Nota.options[cmb5_Nota.selectedIndex].text);
        if (cmb6_Nota.selectedIndex > -1) cmb_val6 = parseFloat(cmb6_Nota.options[cmb6_Nota.selectedIndex].text);
        if (cmb7_Nota.selectedIndex > -1) cmb_val7 = parseFloat(cmb7_Nota.options[cmb7_Nota.selectedIndex].text);
        if (cmb8_Nota.selectedIndex > -1) cmb_val8 = parseFloat(cmb8_Nota.options[cmb8_Nota.selectedIndex].text);
        if (cmb9_Nota.selectedIndex > -1) cmb_val9 = parseFloat(cmb9_Nota.options[cmb9_Nota.selectedIndex].text);
        if (cmb10_Nota.selectedIndex > -1) cmb_val10 = parseFloat(cmb10_Nota.options[cmb10_Nota.selectedIndex].text);

        // calcula a nota
        var soma2 = cmb_val1 + cmb_val2 + cmb_val3 + cmb_val4 + cmb_val5 + cmb_val6 + cmb_val7 + cmb_val8 + cmb_val9 + cmb_val10;
        document.getElementById("txt_atr_id_152").value = soma2.toFixed(2);

        var soma11 = document.getElementById("txt_atr_id_151").value; // = parseInt(cmb_atr_id_100_val);
        var soma1 = 0;
        if ((isNaN(soma11)) || (soma11.trim() == ""))
            soma1 = 0;
        else
            soma1 = parseInt(soma11);

        var total = parseFloat(soma2) + soma1;
        document.getElementById("txt_atr_id_157").value = total.toFixed(2);
        document.getElementById("txt_historico_Pontuacao_Geral_OAE_1").value = total.toFixed(2);
    }
    function Ficha4_Calcula_Nota_Parametro_Funcional() {
        var cmb1 = document.getElementById("cmb_atr_id_145");
        var cmb = document.getElementById("cmb_atr_id_146");

        cmb.selectedIndex = cmb1.selectedIndex;

        var cmb_atr_id_146_val = 0;
        if (cmb1.selectedIndex > -1)
            cmb_atr_id_146_val = cmb.options[cmb.selectedIndex].text;

        if (cmb1.selectedIndex > -1)
            document.getElementById("txt_atr_id_153").value = cmb1.options[cmb1.selectedIndex].text;
        else
            document.getElementById("txt_atr_id_153").value = 0;

        document.getElementById("lblcmb_146").innerText = cmb_atr_id_146_val;


        // preenche o ultimo item do menu acordeon
        var cmb2_Nota = document.getElementById("cmb_atr_id_149");
        var cmb2_Desc = document.getElementById("cmb_atr_id_150");

        if (cmb1.selectedIndex > -1) {
            cmb2_Nota.selectedIndex = cmb1.selectedIndex;
            cmb2_Desc.selectedIndex = cmb1.selectedIndex;
            document.getElementById("lblcmb_150").innerText = cmb2_Desc.options[cmb2_Desc.selectedIndex].text;
        }

    }
    function Ficha4_Calcula_Notas_Tudo() {
        Ficha4_Calcula_Notas_1_Requisito();
        Ficha4_Calcula_Notas_2_Requisito();
        Ficha4_Calcula_Nota_Parametro_Funcional();
    }



</script>


@***** SCRIPT FICHA 4 - ESPECIAL CAMPO ***********************@
<script>


    function Ficha4_CAMPO_ExportarXLS() {
        $.ajax({
            "url": "/Inspecao/FichaInspecaoEspecialAnomalias_ExportarXLS",
            "type": "GET",
            "datatype": "json",
            "data": { "ord_id": selectedId_ord_id },
            "success": function (result) {
                // return result = caminho da planilha preenchida e salva para download

                window.open("../../Reports/frmDownloadFile.aspx?filename=" + result.data);
                //  window.open("../../temp/" + result.data);
                return false;
            }
        });

        return false;
    }



    function CancelarDados_Ficha4_CAMPO(tabela) {
        preenchetblFicha4_CAMPO();

        // alterna os campos para leitura
        Ficha4_CAMPO_setaReadWrite(tabela, true);
    }
    function EditarDados_Ficha4_CAMPO(tabela) {
        // alterna os campos para escrita
        Ficha4_CAMPO_setaReadWrite(tabela, false);

        return false;
    }

    function SalvarDados_Ficha4_CAMPO_VALORES() {

        // monta lista de valores das linhas
        var saida = '';
        var table = document.getElementById("tblFicha4_INSPECAO_ESPECIAL_CAMPO");
        var linhaGrupo = "";

        for (var i = 0; i < table.rows.length; i++) {
            if (table.rows[i].id.includes("trFICHA4_CAMPO_ian_id"))
            {
                var ian_id = table.rows[i].id.replace("trFICHA4_CAMPO_ian_id_", "");

                var txt_Numero_ian_id = document.getElementById("txt_Numero_ian_id_" + ian_id);
                if (txt_Numero_ian_id) {
                    var ian_numero = $("#txt_Numero_ian_id_" + ian_id).val();
                    var leg_codigo = $("#cmb_Sigla_ian_id_" + ian_id).val();
                    var atp_codigo = $("#cmb_Cod_ian_id_" + ian_id).val();
                    var ale_codigo = $("#cmb_Alerta_ian_id_" + ian_id).val();
                    var ian_quantidade = $("#txt_Quantidade_ian_id_" + ian_id).val();
                    var ian_espacamento = $("#txt_EspacamentoMedio_ian_id_" + ian_id).val();
                    var ian_largura = $("#txt_Largura_ian_id_" + ian_id).val();
                    var ian_comprimento = $("#txt_Comprimento_ian_id_" + ian_id).val();
                    var ian_abertura_minima = $("#txt_AberturaMinima_ian_id_" + ian_id).val();
                    var ian_abertura_maxima = $("#txt_AberturaMaxima_ian_id_" + ian_id).val();
                    var aca_codigo = $("#cmb_Causa_ian_id_" + ian_id).val();
                    var ian_fotografia = $("#txt_Foto_ian_id_" + ian_id).val();
                    var ian_croqui = $("#txt_Croqui_ian_id_" + ian_id).val();
                    var ian_desenho = $("#txt_Desenho_ian_id_" + ian_id).val();
                    var ian_observacoes = $("#txt_Obs_ian_id_" + ian_id).val();
                    var ire_id_sugerido = $("#lbl_ReparoIndicado_ian_id_" + ian_id).val();
                    var qt_sugerido = $("#lbl_QuantidadeIndicada_ian_id_" + ian_id).val();
                    var ire_id_adotado = $("#txt_ReparoAdotado_ian_id_" + ian_id).val();
                    var qt_adotado = $("#txt_QuantidadeAdotada_ian_id_" + ian_id).val();

                    if (ian_numero.trim() == "")
                        ian_numero = " ";

                    var valor = ian_quantidade.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    valor = ian_espacamento.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    valor = ian_largura.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    valor = ian_comprimento.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    valor = ian_abertura_minima.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    valor = ian_abertura_maxima.value;
                    if ((valor.trim() == ",") || (valor.trim() == ".") || (valor.trim() == ""))
                        valor = " ";

                    if (ian_fotografia.trim() == "")
                        ian_fotografia = " ";

                    if (ian_croqui.trim() == "")
                        ian_croqui = " ";

                    if (ian_desenho.trim() == "")
                        ian_desenho = " ";

                    if (ian_observacoes.trim() == "")
                        ian_observacoes = " ";

                    if (ire_id_sugerido.trim() == "")
                        ire_id_sugerido = " ";

                    if (qt_sugerido.trim() == "")
                        qt_sugerido = " ";

                    if (ire_id_adotado.trim() == "")
                        ire_id_adotado = " ";

                    if (qt_adotado.trim() == "")
                        qt_adotado = " ";

                    //if (isNaN(ovv_tpu_quantidade))
                    //    ovv_tpu_quantidade = 0;

                    var linhaMontada = '<tr_linha>'
                        + ian_id + '<quebra>'
                        + ian_numero + '<quebra>' + leg_codigo + '<quebra>'
                        + atp_codigo + '<quebra>' + ale_codigo + '<quebra>'
                        + ian_quantidade + '<quebra>' + ian_espacamento + '<quebra>'
                        + ian_largura + '<quebra>' + ian_comprimento + '<quebra>'
                        + ian_abertura_minima + '<quebra>' + ian_abertura_maxima + '<quebra>'
                        + aca_codigo + '<quebra>' + ian_fotografia + '<quebra>'
                        + ian_croqui + '<quebra>' + ian_desenho + '<quebra>'
                        + ian_observacoes + '<quebra>'
                        + ire_id_sugerido + '<quebra>' + ire_id_adotado + '<quebra>'
                        + '</tr_linha>';

                    saida = saida + linhaMontada;
                }
             }
        }
      //  alert(saida);

        // ********* ENVIA OS DADOS PARA O BANCO **********************************************************************
        var ord_id = 0;
        if (paginaPai == "OrdemServico")
            ord_id = selectedId_ord_id;


        var ins_anom_Responsavel = $("#txt_ins_anom_Responsavel").val();
        var ins_anom_data = $("#txt_ins_anom_data").val();
        var ins_anom_quadroA_1 = $("#cmb_ins_anom_quadroA_1").val();
        var ins_anom_quadroA_2 = $("#txt_ins_anom_quadroA_2").val();

        if (ins_anom_quadroA_1 == 'nao')
            ins_anom_quadroA_2 = '';

        $.ajax({
            url: "/Inspecao/InspecaoAnomalias_Valores_Salvar",
            data: JSON.stringify({
                'ord_id': ord_id,
                'ins_anom_Responsavel': ins_anom_Responsavel, 'ins_anom_data': ins_anom_data,
                'ins_anom_quadroA_1': ins_anom_quadroA_1, 'ins_anom_quadroA_2': ins_anom_quadroA_2,
                'listaConcatenada': saida
            }),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                preenchetblFicha4_CAMPO();

                Ficha4_CAMPO_setaReadWrite(tblFicha4_INSPECAO_ESPECIAL_CAMPO, true);

                //document.getElementById("btn_Salvar_INSPECAO_ESPECIAL_CAMPO").style.display = 'none';
                //document.getElementById("btn_Cancelar_INSPECAO_ESPECIAL_CAMPO").style.display = 'none';
                //document.getElementById("btn_Editar_INSPECAO_ESPECIAL_CAMPO").style.display = 'block';

                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });


        return false;
    }

    function limpatblFicha4_CAMPO() {

        var tabela = document.getElementById("divFicha4_CAMPO");

        // habilita ou desabilita todos os controles editaveis
        if (tabela) {
            var lstTxtBoxes = tabela.getElementsByTagName('input');
            var lstCombos = tabela.getElementsByTagName('select');
            var lstTextareas = tabela.getElementsByTagName('textarea');

            for (var i = 0; i < lstTxtBoxes.length; i++)
                lstTxtBoxes[i].value = "";

            for (var i = 0; i < lstTextareas.length; i++)
                lstTextareas[i].value = "";

            for (var i = 0; i < lstCombos.length; i++)
                lstCombos[i].innerText = null;
        }

    }

    function prenchetdCombos(qualCombo, listadeValores, selectedValue, linhaAux)
    {
        var tooltip = 'TOOLTIP_' + qualCombo;
        var opcoes = 'OPCOES_' + qualCombo;

        var op0 = ' <option selectedXX value="-1" ></option> ';
        var op = ' <option selectedXX value="valor" title="tooltip">texto</option> ';
        var total = op0;

        if (parseInt(selectedValue) == -1) {
            total = total.replace("selectedXX", "selected");
            linhaAux = linhaAux.replace(tooltip, "");
        }
        else
            total = total.replace("selectedXX", "");

        var pedacos = listadeValores.split(";");
        for (k = 0; k < pedacos.length; k++) {
            var aux = pedacos[k].split(":");
            var opt = op;
            opt = opt.replace("valor", aux[0].trim()); //.replace("texto", aux[1]);
            opt = opt.replace("texto", aux[0].trim()); //.replace("texto", aux[1]);
            opt = opt.replace("tooltip", aux[1].trim());

            // checa se é o item selecionado
            if ((selectedValue) == (aux[0].trim())) {
                opt = opt.replace("selectedXX", "selected");
                linhaAux = linhaAux.replace(tooltip, aux[1]);
            }
            else {
                opt = opt.replace("selectedXX", "");
                linhaAux = linhaAux.replace(tooltip, aux[1]);
            }
            total = total + opt;
        }

        if (linhaAux.includes(tooltip))
            linhaAux = linhaAux.replace(tooltip, "");

        linhaAux = linhaAux.replace(opcoes, total);

        return linhaAux;
    }

    function preenchetblFicha4_CAMPO() {

        $("#lblOAE").text(selected_obj_codigo);
        $('#txt_ins_anom_data').datepicker({ dateFormat: 'dd/mm/yy' });


        var linhaCabecalhos = ' <tr id="trFICHA4_CAMPO_ian_id_ZZZ" > ' +
            ' <td class="borderLeft qualClasse"  id="tdFICHA4_CodObjeto_ian_id_ZZZ" style="display:EhOrdemServico" > <label class="lblsBold" id="lbl_ObjCodigo_ian_id_ZZZ">lbl_ObjCodigo_VVV</label></td > ' +
            ' <td class="borderLeft qualClasse"><label class="lblsBold" id="lbl_Item_ian_id_ZZZ"></label>lbl_Item_VVV</td> ' +
            ' <td class="borderLeft centroH qualClasse" title="lbl_Localizacao_tooltip" ><label class="lblsBold" id="lbl_Localizacao_ian_id_ZZZ"></label>lbl_Localizacao_VVV</td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft " ></td> ' +
            ' <td class="borderLeft  borderRight" ></td> ' +
            ' <td class="borderLeft "   id="tdFICHA4_ReparoIndicado_ian_id_ZZZ"  style="display:EhOrdemServico" ></td> ' +
            ' <td class="borderLeft "   id="tdFICHA4_QtIndicada_ian_id_ZZZ" style="display:EhOrdemServico" ></td> ' +
            ' <td class="borderLeft "   id="tdFICHA4_ReparoAdotado_ian_id_ZZZ" style="display:EhOrdemServico" ></td> ' +
            ' <td class="borderLeft borderRight"   id="tdFICHA4_QtAdotada_ian_id_ZZZ" style="display:EhOrdemServico" ></td> ' +
            ' </tr>';

        var linhaObjetos = ' <tr id="trFICHA4_CAMPO_ian_id_ZZZ" > ' + 
            ' <td class="borderLeft qualClasse" id="tdFICHA4_CodObjeto_ian_id_ZZZ"  style="display:EhOrdemServico" > <label class="lblsBold" id="lbl_ObjCodigo_ian_id_ZZZ">lbl_ObjCodigo_VVV</label></td > ' +
            ' <td class="borderLeft qualClasse"> ' +
            '          <button id="btn_ExcluirObjeto_ian_id_ZZZ" ' +
            '            type="button" ' +
            '             onclick="return Ficha4_ExcluirObjeto(ZZZ)" ' +
            '             title="Excluir Objeto" ' +
            '             style="border:none; box-shadow:none; background-color:transparent; display:none"> ' +
            '             <span class="glyphicon glyphicon-trash text-success contornoBranco"></span> ' +
            '          </button> ' +
            '           <label class="lblsBold" style="vertical-align: middle; display:inline" id="lbl_Item_ian_id_ZZZ"></label>lbl_Item_VVV ' +
            ' </td > ' +
                                ' <td class="borderLeft centroH qualClasse" title="lbl_Localizacao_tooltip" ><label class="lblsBold" id="lbl_Localizacao_ian_id_ZZZ" ></label>lbl_Localizacao_VVV</td> ' +
                                ' <td class="borderLeft centroH qualClasse" > <input disabled id="txt_Numero_ian_id_ZZZ" class="centroH" style="width:94%;" value="txt_Numero_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse" > <select disabled id="cmb_Sigla_ian_id_ZZZ" class="cmbs_anom" title="TOOLTIP_cmb_Sigla" onchange="cmb_Sigla_onchange(this)" >OPCOES_cmb_Sigla</select></td > ' +
                                ' <td class="borderLeft centroH qualClasse" > <select disabled id="cmb_Cod_ian_id_ZZZ" class="cmbs_anom"  >OPCOES_cmb_Cod</select></td> ' +
                                ' <td class="borderLeft centroH qualClasse" > <select disabled id="cmb_Alerta_ian_id_ZZZ" class="cmbs_anom" title="TOOLTIP_cmb_Alerta" >OPCOES_cmb_Alerta</select></td > ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Quantidade_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Quantidade_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_EspacamentoMedio_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_EspacamentoMedio_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Largura_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Largura_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Comprimento_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Comprimento_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_AberturaMinima_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_AberturaMinima_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_AberturaMaxima_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_AberturaMaxima_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse" > <select disabled id="cmb_Causa_ian_id_ZZZ" class="cmbs_anom" title="TOOLTIP_cmb_Causa" >OPCOES_cmb_Causa</select></td > ' +

                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Foto_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Foto_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Croqui_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Croqui_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse"><input disabled id="txt_Desenho_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Desenho_VVV" /></td> ' +
                                ' <td class="borderLeft centroH qualClasse borderRight"><input disabled id="txt_Obs_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_Obs_VVV" /></td> ' +

                                ' <td class="borderLeft centroH qualClasse" id="tdFICHA4_ReparoIndicado_ian_id_ZZZ" style="display:EhOrdemServico"  ><label class="lblsBold" id="lbl_ReparoIndicado_ian_id_ZZZ">lbl_ReparoIndicado_VVV</label></td> ' +
                                ' <td class="borderLeft centroH qualClasse" id="tdFICHA4_QtIndicada_ian_id_ZZZ" style="display:EhOrdemServico" ><label class="lblsBold" id="lbl_QuantidadeIndicada_ian_id_ZZZ">lbl_QuantidadeIndicada_VVV</label></td> ' +
                                ' <td class="borderLeft centroH qualClasse" id="tdFICHA4_ReparoAdotado_ian_id_ZZZ" style="display:EhOrdemServico" ><input disabled id="txt_ReparoAdotado_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_ReparoAdotado_VVV" /></td> ' +
                                ' <td class="borderLeft centroH borderRight qualClasse" id="tdFICHA4_QtAdotada_ian_id_ZZZ" style="display:EhOrdemServico" ><input disabled id="txt_QuantidadeAdotada_ian_id_ZZZ" class="centroH" style="width:94%;"  value="txt_QuantidadeAdotada_VVV" /></td> ' +
                         ' </tr>';


        $.ajax({
            "url": "/Inspecao/InspecaoAnomalias_Valores_ListAll",
            "type": "GET",
            "datatype": "json",
            "data": { "ord_id": selectedId_ord_id },
            "success": function (result) {

                $('#txt_ins_anom_data').val("");
                $('#txt_ins_anom_Responsavel').val("");
                $('#cmb_ins_anom_quadroA_1').val("");
                $('#txt_ins_anom_quadroA_2').val("");

                // limpa as linhas se houver
                var table = document.getElementById("tblFicha4_INSPECAO_ESPECIAL_CAMPO");
                var rowCount = table.rows.length;
                for (var i = rowCount - 1; i >= 0; i--) {
                    if (table.rows[i].id.indexOf("trFICHA4_CAMPO_ian_id") >= 0)
                        table.deleteRow(i);
                }

                var linhas = '';
                var celulaPai = document.getElementById("tr_pai");

               for (var i = 0; i < result.data.length; i++)
               {
                   if (i == 0)
                   {
                       $('#txt_ins_anom_Responsavel').val(result.data[i].ins_anom_Responsavel);
                       $('#txt_ins_anom_data').val(result.data[i].ins_anom_data);
                       $('#cmb_ins_anom_quadroA_1').val(result.data[i].ins_anom_quadroA_1);
                       $('#txt_ins_anom_quadroA_2').val(result.data[i].ins_anom_quadroA_2);
                   }

                   var linhaAux = linhaObjetos;
                   if (parseInt(result.data[i].clo_id) < 10)
                       linhaAux = linhaCabecalhos;

                    if (parseInt(result.data[i].clo_id) == 6)  // subdivisao1
                        linhaAux = linhaAux.replace(/YYY/g, result.data[i].rownum).replace(/qualClasse/g, "cabecalho_subdivisao1");
                    else
                        if (parseInt(result.data[i].clo_id) == 7) // subdivisao2
                            linhaAux = linhaAux.replace(/YYY/g, result.data[i].rownum).replace(/qualClasse/g, "cabecalho_subdivisao2");
                        else
                            if (parseInt(result.data[i].clo_id) == 9) // grupo
                                linhaAux = linhaAux.replace(/YYY/g, result.data[i].rownum).replace(/qualClasse/g, "cabecalho_grupos");
                            else
                                if (!isNaN(result.data[i].obj_id)) // LINHA NORMAL
                                {
                                    linhaAux = linhaAux.replace(/YYY/g, result.data[i].rownum).replace(/XXX/g, result.data[i].obj_id).replace(/qualClasse/g, "linha_normal");
                               }

                   linhaAux = linhaAux.replace(/ZZZ/g, result.data[i].ian_id); // id da linha

                   linhaAux = linhaAux.replace(/lbl_ObjCodigo_VVV/g, result.data[i].obj_codigo);
                   linhaAux = linhaAux.replace(/lbl_Item_VVV/g, result.data[i].item);

                   if (!isNaN(result.data[i].obj_id))
                       if (parseInt(result.data[i].clo_id) < 10) {
                           linhaAux = linhaAux.replace(/lbl_Localizacao_VVV/g, result.data[i].tip_nome);
                           linhaAux = linhaAux.replace(/lbl_Localizacao_tooltip/g, result.data[i].obj_codigo);
                       }
                       else {
                           linhaAux = linhaAux.replace(/lbl_Localizacao_VVV/g, result.data[i].obj_descricao);
                           linhaAux = linhaAux.replace(/lbl_Localizacao_tooltip/g, result.data[i].obj_codigo);
                       }
                   else {
                       linhaAux = linhaAux.replace(/lbl_Localizacao_VVV/g, result.data[i].tip_nome);
                       linhaAux = linhaAux.replace(/lbl_Localizacao_tooltip/g, result.data[i].obj_codigo);
                   }

                   if (parseInt(result.data[i].clo_id) >= 10) {
                       linhaAux = linhaAux.replace(/txt_Numero_VVV/g, result.data[i].ian_numero);
                       linhaAux = linhaAux.replace(/txt_Quantidade_VVV/g, result.data[i].ian_quantidade);
                       linhaAux = linhaAux.replace(/txt_EspacamentoMedio_VVV/g, result.data[i].ian_espacamento);
                       linhaAux = linhaAux.replace(/txt_Largura_VVV/g, result.data[i].ian_largura);
                       linhaAux = linhaAux.replace(/txt_Comprimento_VVV/g, result.data[i].ian_comprimento);
                       linhaAux = linhaAux.replace(/txt_AberturaMinima_VVV/g, result.data[i].ian_abertura_minima);
                       linhaAux = linhaAux.replace(/txt_AberturaMaxima_VVV/g, result.data[i].ian_abertura_maxima);
                       linhaAux = linhaAux.replace(/txt_Foto_VVV/g, result.data[i].ian_fotografia);
                       linhaAux = linhaAux.replace(/txt_Croqui_VVV/g, result.data[i].ian_croqui);
                       linhaAux = linhaAux.replace(/txt_Desenho_VVV/g, result.data[i].ian_desenho);
                       linhaAux = linhaAux.replace(/txt_Obs_VVV/g, result.data[i].ian_observacoes);
                       linhaAux = linhaAux.replace(/lbl_ReparoIndicado_VVV/g, result.data[i].ire_id_sugerido);
                       linhaAux = linhaAux.replace(/lbl_QuantidadeIndicada_VVV/g, result.data[i].rownum);
                       linhaAux = linhaAux.replace(/txt_ReparoAdotado_VVV/g, result.data[i].rownum);
                       linhaAux = linhaAux.replace(/txt_QuantidadeAdotada_VVV/g, result.data[i].rownum);

                       linhaAux = linhaAux.replace(/-1/g, '');

                       // cria os itens dos combos ========================================
                       linhaAux = prenchetdCombos('cmb_Sigla', result.data[i].lstLegendas, result.data[i].leg_codigo, linhaAux);

                       linhaAux = prenchetdCombos('cmb_Alerta', result.data[i].lstAlertas, result.data[i].ale_codigo, linhaAux);

                       linhaAux = prenchetdCombos('cmb_Cod', result.data[i].lstTipos, result.data[i].atp_codigo, linhaAux);

                       linhaAux = prenchetdCombos('cmb_Causa', result.data[i].lstCausas, result.data[i].aca_codigo, linhaAux);

                   }


                   linhas = linhas + linhaAux;
                }

                // oculta algumas colunas se a pagina for O.S. ou Inspecao
                if (paginaPai == "OrdemServico")
                    linhas = linhas.replace(/EhOrdemServico/g, 'none');

                // mescla na tabela existente
                celulaPai.insertAdjacentHTML('afterend', linhas);

                // coloca mascara no campo quantidade
                //var qts = $('[id^="txt_quantidade_"]');
                //for (var i = 0; i < qts.length; i++) {
                //    jQuery(qts[i]).attr('placeholder', "000.00");
                //    jQuery(qts[i]).mask("999.99");
                //}


            }
        });

    }


    function Ficha4_CAMPO_CalculaReparoIndicado(quem)
    {
        var sufixo = quem.id.replace("cmb_Sigla", "").replace("cmb_Cod", "").replace("cmb_Alerta", "").replace("cmb_Causa", "");

        // combo Sigla
        var cmb_Sigla_id = "cmb_Sigla" + sufixo;
        var cmb_Sigla = document.getElementById(cmb_Sigla_id);

        // combo Codigo
        var cmb_Cod_id = "cmb_Cod" + sufixo;
        var cmb_Cod = document.getElementById(cmb_Cod_id);

        // combo Alerta
        var cmb_Alerta_id = "cmb_Alerta" + sufixo;
        var cmb_Alerta = document.getElementById(cmb_Alerta_id);

        // combo Causa
        var cmb_Causa_id = "cmb_Causa" + sufixo;
        var cmb_Causa = document.getElementById(cmb_Causa_id);

        // label ReparoIndicado
        var lbl_ReparoIndicado_id = "lbl_ReparoIndicado" + sufixo;
        var lbl_ReparoIndicado = document.getElementById(lbl_ReparoIndicado_id);

        // label Quantidade Indicada
        var lbl_QuantidadeIndicada_id = "lbl_QuantidadeIndicada" + sufixo;
        var lbl_QuantidadeIndicada = document.getElementById(lbl_QuantidadeIndicada_id);


    }


    function cmb_Sigla_onchange(quem)
    {
        var seltooltip = quem.options[quem.selectedIndex].title;
        quem.title = seltooltip;

        var valor = quem.options[quem.selectedIndex].value;

        // preenche combo Codigo
        var cmb_Cod_id = quem.id.replace("cmb_Sigla", "cmb_Cod")
        var cmb_Cod = document.getElementById(cmb_Cod_id);

        $.ajax({
            url: '/Inspecao/InspecaoAnomaliaTipos_by_Legenda',
            type: "POST",
            dataType: "JSON",
            data: { leg_codigo: valor },
            success: function (result) {

                $('#' + cmb_Cod_id).html('');
                var pedacos = result.data.split(";");
                for (k = 0; k < pedacos.length; k++) {
                    var aux = pedacos[k].split(":");
                    var opt = document.createElement('option');
                    opt.value = aux[0].trim();
                    opt.innerHTML = aux[0].trim();
                    opt.title = aux[1].trim();
                    cmb_Cod.appendChild(opt);
                }

                // preenche combo causas
                var cmb_Causa_id = quem.id.replace("cmb_Sigla", "cmb_Causa")
                var cmb_Causa = document.getElementById(cmb_Causa_id);
                $.ajax({
                    url: '/Inspecao/InspecaoAnomaliaCausas_by_Legenda',
                    type: "POST",
                    dataType: "JSON",
                    data: { leg_codigo: valor },
                    success: function (result) {
                        $('#' + cmb_Causa_id).html('');
                       var pedacos = result.data.split(";");
                        for (k = 0; k < pedacos.length; k++) {
                            var aux = pedacos[k].split(":");
                            var opt = document.createElement('option');
                            opt.value = aux[0].trim();
                            opt.innerHTML = aux[0].trim();
                            opt.title = aux[1].trim();
                            cmb_Causa.appendChild(opt);
                        }
                    }
                });


            }
        });

    }

    function Ficha4_CAMPO_setaReadWrite(tabela, ehRead) {
        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        var lstCombos = tabela.getElementsByTagName('select');
        var lstTextareas = tabela.getElementsByTagName('textarea');

        for (var i = 0; i < lstTxtBoxes.length; i++) {
            lstTxtBoxes[i].disabled = ehRead;

            if (!ehRead)
            {
                var mascara = "99";
                var str = lstTxtBoxes[i].id;
                if (str.startsWith("txt_Quantidade_ian_id_"))
                    mascara = "999";
                else
                    if (str.startsWith("txt_EspacamentoMedio_ian_id_"))
                        mascara = "9999";
                    else
                        if (str.startsWith("txt_Largura_ian_id_"))
                            mascara = "9999";
                        else
                            if (str.startsWith("txt_Comprimento_ian_id_"))
                                mascara = "9999";
                            else
                                if (str.startsWith("txt_AberturaMinima_ian_id_"))
                                    mascara = "99.99";
                                else
                                    if (str.startsWith("txt_AberturaMaxima_ian_id_"))
                                        mascara = "99.99";

                jQuery("#" + str).mask(mascara);
            }
        }

        for (var i = 0; i < lstTextareas.length; i++)
                lstTextareas[i].disabled = ehRead;

        for (var i = 0; i < lstCombos.length; i++)
                lstCombos[i].disabled = ehRead;

        // =============== ALTERNA OS BOTOES SALVAR/CANCELAR/EDITAR =============================================================
        if (ehRead) {
            document.getElementById("btn_Salvar_INSPECAO_ESPECIAL_CAMPO").style.display = 'none';
            document.getElementById("btn_Cancelar_INSPECAO_ESPECIAL_CAMPO").style.display = 'none';
            document.getElementById("btn_Editar_INSPECAO_ESPECIAL_CAMPO").style.display = 'block';
            document.getElementById("btn_Adicionar_Objeto_Anomalia").style.display = 'none';
        }
        else {
            document.getElementById("btn_Salvar_INSPECAO_ESPECIAL_CAMPO").style.display = 'block';
            document.getElementById("btn_Cancelar_INSPECAO_ESPECIAL_CAMPO").style.display = 'block';
            document.getElementById("btn_Editar_INSPECAO_ESPECIAL_CAMPO").style.display = 'none' ;
            document.getElementById("btn_Adicionar_Objeto_Anomalia").style.display = 'block';
        }

        // botoes da lixeira criados dinamicamente
        var tblFicha4_INSPECAO_ESPECIAL_CAMPO = document.getElementById("tblFicha4_INSPECAO_ESPECIAL_CAMPO");
        var lstButtons = tblFicha4_INSPECAO_ESPECIAL_CAMPO.getElementsByTagName('button');

        for (var i = 0; i < lstButtons.length; i++)
            if (lstButtons[i].id.includes("btn_ExcluirObjeto_rownum")) {
                lstButtons[i].style.display = ehRead ? 'none' : 'inline'; // aqui display block/none; na criacao da tabela visibility: visible/hidden (para nao misturar porque la existe validacao)
            }

    }


    //function Ficha4_CAMPO_preencheCombo(clo_id, qualCombo, txtPlaceholder, tip_pai) {
    //    if (tip_pai == null)
    //        tip_pai = -1;

    //    //   var excluir_existentes = qualCombo == 'divFicha2_GrupoObjetos' ? 1 : 0;
    //    var excluir_existentes = 0;

    //    var cmb = $("#" + qualCombo);
    //    cmb.html(""); // limpa os itens existentes
    //    cmb.append($('<option selected ></option>').val(-1).html(txtPlaceholder)); // 1o item vazio

    //    $.ajax({
    //        url: '/Objeto/PreenchecmbTiposObjeto',
    //        type: "POST",
    //        dataType: "JSON",
    //        data: { clo_id: clo_id, tip_pai: tip_pai, excluir_existentes: excluir_existentes, obj_id: selectedId_obj_id },
    //        success: function (lstSubNiveis) {

    //            if (clo_id != 10) {
    //                $.each(lstSubNiveis, function (i, subNivel) {
    //                    cmb.append($('<option></option>').val(subNivel.Value.trim()).html(subNivel.Text.trim()));
    //                });
    //            }
    //            else {
    //                var i = 0;
    //                $("#divFicha4_CAMPO_LocalizacaoObjeto").empty();
    //                $.each(lstSubNiveis, function (i, objeto) {
    //                    i++;
    //                    if (i < 50) {
    //                        var tagchk = '<input type="checkbox" id="idXXX" nome="nameXXX" value="valueXXX" style="margin-right:5px">';
    //                        tagchk = tagchk.replace("idXXX", "chk" + i);
    //                        tagchk = tagchk.replace("nameXXX", "chk" + i);
    //                        tagchk = tagchk.replace("valueXXX", objeto.Value);

    //                        var taglbl = '<label for="idXXX" class="chklst" >TextoXXX</label> <br />';
    //                        taglbl = taglbl.replace("idXXX", "chk" + i);
    //                        taglbl = taglbl.replace("TextoXXX", objeto.Text);

    //                        $("#divFicha4_CAMPO_LocalizacaoObjeto").append(tagchk + taglbl);
    //                    }
    //                });
    //            }
    //        }
    //    });
    //}

    function Ficha4_CAMPO_preencheLocalizacao(tip_id_Subdivisao1) {

        $.ajax({
            url: '/Objeto/PreencheCmbObjetoLocalizacao',
            type: "POST",
            dataType: "JSON",
            data: { obj_id_TipoOAE: selectedId_obj_id, tip_id_Subdivisao1: tip_id_Subdivisao1 },
            success: function (lstSubNiveis) {

                    var i = 0;
                    $("#divFicha4_CAMPO_LocalizacaoObjeto").empty();
                    $.each(lstSubNiveis, function (i, objeto) {
                        i++;
                        if (i < 100) {
                            var tagchk = '<input type="checkbox" id="idXXX" nome="nameXXX" value="valueXXX" style="margin-right:5px">';
                            tagchk = tagchk.replace("idXXX", "chk" + i);
                            tagchk = tagchk.replace("nameXXX", "chk" + i);
                            tagchk = tagchk.replace("valueXXX", objeto.Value);

                            var taglbl = '<label for="idXXX" class="chklst" >TextoXXX</label> <br />';
                            taglbl = taglbl.replace("idXXX", "chk" + i);
                            taglbl = taglbl.replace("TextoXXX", objeto.Text);

                            $("#divFicha4_CAMPO_LocalizacaoObjeto").append(tagchk + taglbl);
                        }
                    });
            }
        });
    }
    function Ficha4_ExcluirObjeto(qual_ian_id)
    {
        var form = this;

        swal({
            title: "Excluir. Tem certeza?",
            icon: "warning",
            buttons: [
                'Não',
                'Sim'
            ],
            dangerMode: true,
            focusCancel: true
        }).then(function (isConfirm) {
            if (isConfirm) {
                var response = POST("/Inspecao/InspecaoAnomaliaObjetos_Excluir", JSON.stringify({ id: qual_ian_id }))
                if (response.erroId >= 1) {
                    swal({
                        type: 'success',
                        title: 'Sucesso',
                        text: 'Registro excluído com sucesso'
                    });

                    // atualiza tabela 
                    preenchetblFicha4_CAMPO();

                    return false;
                }
                else {
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: 'Erro ao excluir registro'
                    });
                }
                return false;
            } else {
                return false;
            }
        })
        return false;

    }


    function Ficha4_CAMPO_LimparCampos(aPartirDe) {

        if (aPartirDe <= 6) {
            $("#Ficha4_CAMPO_cmbSubdivisao2").html("");
        }

        if (aPartirDe <= 7) $("#Ficha4_CAMPO_cmbSubdivisao3").html(""); 
        if (aPartirDe <= 8) $("#Ficha4_CAMPO_cmbGrupoObjetos").html(""); 

    }


    function Ficha4_CAMPO_btn_Adicionar_Objeto_Anomalia_onclick() {
        var Ficha4_CAMPO_cmbSubdivisao1 = document.getElementById("Ficha4_CAMPO_cmbSubdivisao1");
        Ficha4_CAMPO_cmbSubdivisao1.selectedIndex = -1;

        // limpa os itens existentes;
        $("#Ficha4_CAMPO_cmbSubdivisao2").html("");
        $("#Ficha4_CAMPO_cmbSubdivisao3").html(""); 
        $("#Ficha4_CAMPO_cmbGrupoObjetos").html(""); 
        $("#divFicha4_CAMPO_LocalizacaoObjeto").html(""); 

        $("#modalSelecionarObjetoLocalizacao").modal('show');

    }
    function Ficha4_CAMPO_cmbSubdivisao1_onchange() {

        Ficha4_CAMPO_LimparCampos(6);

        // preenche proximo combo
        var valor = document.getElementById("Ficha4_CAMPO_cmbSubdivisao1").value;
        var ivalor = parseInt(valor);

        Ficha4_CAMPO_preencheLocalizacao(ivalor);

        //// oculta o divs Ficha2_Subdivisao2
        //document.getElementById("Ficha4_CAMPO_divSubdivisao2").style.display = 'none';
        //document.getElementById("Ficha4_CAMPO_divSubdivisao3").style.display = 'none';
        //document.getElementById("Ficha4_CAMPO_divGrupoObjetos").style.display = 'block';
        //document.getElementById("Ficha4_CAMPO_divLocalizacaoObjeto").style.display = 'block';

        //// superestrutura
        //if (ivalor == 11) {
        //    // mostra Subdivisao2
        //    document.getElementById("Ficha4_CAMPO_divSubdivisao2").style.display = 'block';
        //    Ficha4_CAMPO_preencheCombo(7, 'Ficha4_CAMPO_cmbSubdivisao2', '--Selecione--', ivalor);
        //}
        //else
        //    // ENCONTROS
        //    if (ivalor == 14) {
        //        // mostra Subdivisao2 e 3
        //        document.getElementById("Ficha4_CAMPO_divSubdivisao2").style.display = 'block';

        //        Ficha4_CAMPO_preencheCombo(7, 'Ficha4_CAMPO_cmbSubdivisao2', '--Selecione--', ivalor);

        //        //// preenche combo manualmente, tip_id = 22,23,24 ESTRUTURAS DE TERRRA, DE CONCRETO E ACESSOS
        //        //$("#Ficha4_CAMPO_cmbSubdivisao2").append($('<option></option>').val("").html("--Selecione--"));
        //        //for (var i = 0; i < cmbTiposObjeto_FichaInspecaoRotineira.options.length; i++) {
        //        //    if ((getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 22)
        //        //        || (getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 23)
        //        //        || (getTipoId(cmbTiposObjeto_FichaInspecaoRotineira.options[i].value) == 24)
        //        //    ) {
        //        //        var option = document.createElement("option");
        //        //        option.text = cmbTiposObjeto_FichaInspecaoRotineira.options[i].text;
        //        //        option.value = cmbTiposObjeto_FichaInspecaoRotineira.options[i].value;
        //        //        $("#Ficha4_CAMPO_cmbSubdivisao2").append($('<option></option>').val(option.value).html(option.text));
        //        //    }
        //        //}
        //    }
        //    else
        //        Ficha4_CAMPO_preencheCombo(9, 'Ficha4_CAMPO_cmbGrupoObjetos', '--Selecione--', ivalor);

    }
    function Ficha4_CAMPO_cmbSubdivisao2_onchange() {

        // oculta o divs Subdivisao3
        document.getElementById("Ficha4_CAMPO_divSubdivisao3").style.display = 'none';

        // preenche proximo combo
        var valor = document.getElementById("Ficha4_CAMPO_cmbSubdivisao2").value;
        var ivalor = getTipoId(valor);

        $("#Ficha4_CAMPO_cmbSubdivisao3").html("");
        $("#Ficha4_CAMPO_cmbGrupoObjetos").html("");
        $("#divFicha4_CAMPO_LocalizacaoObjeto").html(""); 

        if ((ivalor == 24) || (ivalor == 15) || (ivalor == 16)) { // 15 = Tabuleiro Face Superior; 16=Tabuleiro Face Inferior; 24 = Acesso
            Ficha4_CAMPO_LimparCampos(9);
            Ficha4_CAMPO_preencheCombo(9, 'Ficha4_CAMPO_cmbGrupoObjetos', '--Selecione--', ivalor)
        }
        else {
            Ficha4_CAMPO_LimparCampos(8);
            document.getElementById("Ficha4_CAMPO_divSubdivisao3").style.display = 'block';
            Ficha4_CAMPO_preencheCombo(8, 'Ficha4_CAMPO_cmbSubdivisao3', '--Selecione--', ivalor)
        }


    }
    function Ficha4_CAMPO_cmbSubdivisao3_onchange() {

        // preenche proximo combo
        var valor = document.getElementById("Ficha4_CAMPO_cmbSubdivisao3").value;
        var ivalor = getTipoId(valor);

        Ficha4_CAMPO_LimparCampos(8);
        Ficha4_CAMPO_preencheCombo(9, 'Ficha4_CAMPO_cmbGrupoObjetos', '--Selecione--', ivalor)
    }

    function Ficha4_CAMPO_cmbGrupoObjetos_onchange() {

        // preenche proximo combo
        var valor = document.getElementById("Ficha4_CAMPO_cmbGrupoObjetos").value;
        var ivalor = getTipoId(valor);

     //   Ficha4_CAMPO_preencheCombo(10, 'divFicha4_CAMPO_LocalizacaoObjeto', '--Selecione--', ivalor)
        Ficha4_CAMPO_preencheLocalizacao(ivalor);
    }




    function Ficha4_CAMPO_bntSalvar_Localizacao_click() {

        var Ficha4_CAMPO_cmbSubdivisao1 = document.getElementById("Ficha4_CAMPO_cmbSubdivisao1");

        // cria lista dos IDs de Objetos selecionados
        var selchks = [];
        $('#divFicha4_CAMPO_LocalizacaoObjeto input:checked').each(function () {
            selchks.push($(this).attr('value'));
        });

        //se houver grupos selecionados, salva
        if (selchks.length > 0)
        {
            if (Ficha4_CAMPO_cmbSubdivisao1.selectedIndex > 0) {

                //cria a lista de objetos
                var obj_ids = "";
                for (var i = 0; i < selchks.length; i++)
                    if (i == 0)
                        obj_ids = selchks[i];
                    else
                        obj_ids = obj_ids + ";" + selchks[i];

                obj_ids = obj_ids + ";"; // acrescenta um delimitador no final da string

                var listaObjs = {
                    ord_id: selectedId_ord_id, obj_ids: obj_ids
                };

                $.ajax({
                    url: "/Inspecao/InspecaoAnomaliaObjetos_Salvar",
                    data: JSON.stringify(listaObjs),
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    success: function (result) {

                        // atualiza os dados
                        preenchetblFicha4_CAMPO();

                        $("#modalSelecionarObjetoLocalizacao").modal('hide');
                        return false;
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                        $("#modalSelecionarObjetoLocalizacao").modal('show');
                        return false;
                    }
                });
            }
        }
        else {
            swal({
                type: 'error',
                title: 'Aviso',
                text: 'Objeto(s) não selecionado(s)'
            }).then(
                function () {
                    return false;
                });
        }
        return false;
    }




</script>





@***** INICIO DAS ABAS ***********************@

<section class="content" style="min-height: 50px;">
    <div class="row">
        <div class="box box-primary">
            <div class="box-body">

                <ul class="nav nav-tabs" id="Tabs" role="tablist">
                    <li class="active" id="liDetalhesOS">
                        <a id="tabDetalhesOSheader" data-toggle="tab" href="#tabDetalhesOS" onclick="OrdemServico_setaReadWrite(true)">Detalhes O.S.</a>
                    </li>
                    <li style="display:none" id="liFichaInspecaoCadastral">
                        <a id="tabFichaInspecaoCadastralheader" data-toggle="tab" href="#tabFichaInspecaoCadastral" onclick="abreFicha(1);">Ficha Básica - Inspeção Cadastral </a>
                    </li>
                    <li style="display:none" id="liFichaInspecao1aRotineira">
                        <a id="tabFichaInspecao1aRotineiraheader" data-toggle="tab" href="#tabFichaInspecao1aRotineira" onclick="abreFicha(2);">Ficha Básica - Primeira Rotineira</a>
                    </li>

                    <li style="display:none" id="liFichaInspecaoRotineira">
                        <a id="tabFichaInspecaoRotineiraheader" data-toggle="tab" href="#tabFichaInspecaoRotineira" onclick="abreFicha(3);">Ficha Básica - Inspeção Rotineira</a>
                    </li>

                    <li style="display:none" id="liFichaInspecaoEspecial">
                        <a id="tabFichaInspecaoEspecialheader" data-toggle="tab" href="#tabFichaInspecaoEspecial" onclick="abreFicha(4);">Ficha de Informações Básicas - Inspeção Especial</a>
                    </li>

                    <li style="display:none" id="liFichaInspecaoEspecialAnomalias">
                        <a id="tabFichaInspecaoEspecialAnomaliasheader" data-toggle="tab" href="#tabFichaInspecaoEspecialAnomalias" onclick="abreFicha(5);">Ficha de Cadastramento de Anomalias - Inspeção Especial</a>
                    </li>

                    <li>
                        <a id="tabDocumentosAssociadosOBJHeader" data-toggle="tab" href="#tabDocumentosAssociadosOBJ" onclick="$('#tblDocumentosAssociadosOBJ').DataTable().ajax.reload();">Documentos Associados ao Objeto</a>
                    </li>
                    <li>
                        <a id="tabDocumentosAssociadosOSHeader" data-toggle="tab" href="#tabDocumentosAssociadosOS" onclick="$('#tblDocumentosAssociados').DataTable().ajax.reload();">Documentos Associados à Ordem de Serviço</a>
                    </li>

                </ul>

                <div class="tab-content" id="TabContent">
                    <div class="tab-pane fade in active" id="tabDetalhesOS" role="tabpanel" aria-labelledby="tabDetalhesOS">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-primary" id="btnEditar_Detalhes" style="display:inline" onclick="OrdemServico_Editar(selectedId_ord_id, 'btnEditar_Detalhes')">Editar</button>
                                    <button type="button" class="btn btn-primary" id="btnSalvar_Detalhes" style="display:none" onclick="OrdemServico_Salvar()">Salvar</button>
                                    <button type="button" class="btn btn-primary" id="btnCancelar_Detalhes" style="display:none" onclick="OrdemServico_Cancelar()">Cancelar</button>
                                </div>
                                <div class="col-sm-8">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas"></label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br />

                        <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                            <br />
                            <div class="form-group" id="divDetalhes">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Código</label>
                                        <div class="col-sm-10">
                                            <input id="txtord_codigo" name="txtord_codigo"
                                                   style="margin-left: -3px !important;"
                                                   class="form-control" disabled />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Descrição<span class="text-danger">*</span></label>
                                        <div class="col-sm-10">
                                            <input id="txtord_descricao" name="txtord_descricao" class="form-control"
                                                   style="margin-left: -3px !important;"
                                                   placeholder="Descrição" data-val="true" required
                                                   maxlength="255" pattern=".{1,255}" title="1 a 255 caracteres"
                                                   autocomplete="off"
                                                   onkeyup="validaAlfaNumerico(this)" />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Tipo de O.S.<span class="text-danger">*</span> </label>
                                        <div class="col-sm-8">
                                            @Html.DropDownList("cmbTiposOS", null, "-- Selecione --", new { @class = "form-control " })
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Objeto<span class="text-danger">*</span> </label>
                                        <div class="col-sm-8">
                                            <table style="width:100%">
                                                <tr>
                                                    <td style="width:100%">
                                                        <input id="txtobj_codigo_Novo2" name="txtobj_codigo_Novo2" class="form-control"
                                                               placeholder="Objeto" disabled
                                                               autocomplete="off" />
                                                    </td>
                                                    <td>
                                                        <button id="btnAbrirLocalizarObjetos" disabled style="display:inline; width:40px; height:25px; margin-left:5px; display:inline" onclick="return abrirLocalizarObjetos();">...</button>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Status</label>
                                        <div class="col-sm-8">
                                            @Html.DropDownList("cmbStatusOS", null, "-- Selecione --", new { @class = "form-control " })
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Aberta Por</label>
                                        <div class="col-sm-8">
                                            <input id="txtord_aberta_por" name="txtord_aberta_por"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Responsável DER</label></nobr>
                                        <div class="col-sm-8">
                                            @*@Html.DropDownList("cmbResponsavelDER", null, "-- Selecione --", new { @class = "form-control " })*@
                                            <input id="txtord_responsavel_der" name="txtord_responsavel_der"
                                                   class="form-control" />

                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Responsável Fiscalização</label></nobr>
                                        <div class="col-sm-8">
                                            @*@Html.DropDownList("cmbResponsavelDER", null, "-- Selecione --", new { @class = "form-control " })*@
                                            <input id="txtord_responsavel_fiscalizacao" name="txtord_responsavel_fiscalizacao"
                                                   class="form-control" />

                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr> <label class="control-label col-sm-4">Responsável Execução</label></nobr>
                                        <div class="col-sm-8">
                                            @*@Html.DropDownList("cmbResponsavelDER", null, "-- Selecione --", new { @class = "form-control " })*@
                                            <input id="txtord_responsavel_execucao" name="txtord_responsavel_execucao"
                                                   class="form-control" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Início Programada<span class="text-danger">*</span></label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_inicio_programada" name="txtord_data_inicio_programada" placeholder="Data Início Programada"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Início Execução</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_inicio_execucao" name="txtord_data_inicio_execucao" placeholder="Data Início Execução"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Suspensão</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_suspensao" name="txtord_data_suspensao" placeholder="Data Suspensão"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Cancelamento</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_cancelamento" name="txtord_data_cancelamento" placeholder="Data Cancelamento"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Reinício</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_reinicio" name="txtord_data_reinicio" placeholder="Data Reinício"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Criticidade (Nota OAE)</label>
                                        <div class="col-sm-8">
                                            <input id="txtord_criticidade" name="txtord_criticidade" class="form-control" placeholder="Criticidade" />

                                            @*@Html.DropDownList("cmbCriticidade", null, "-- Selecione --", new { @class = "form-control " })*@
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">OS de Orçamento</label>
                                        <div class="col-sm-8">
                                            <input id="txtord_OSOrcamento" name="txtord_OSOrcamento" class="form-control" placeholder="OS de Orçamento" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Quantidade Estimada</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_quantidade_estimada" name="txtord_quantidade_estimada" class="form-control" placeholder="Quantidade Estimada" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Custo Estimado</label>
                                        <div class="col-sm-8">
                                            <input id="txtord_custo_estimado" name="txtord_custo_estimado" class="form-control" placeholder="Custo Estimado" />
                                        </div>
                                    </div>

                                    <div class="form-group" style="display:none">
                                        <label class="control-label col-sm-4">Valor TPU??</label>
                                        <div class="col-sm-8">
                                            <input id="txttpu_codigo_der" name="txttpu_codigo_der" class="form-control" placeholder="Valor TPU" />
                                        </div>
                                    </div>

                                    <div class="form-group" style="display:none">
                                        <label class="control-label col-sm-4">Descrição TPU??</label>
                                        <div class="col-sm-8">
                                            <input id="txttpu_descricao" name="txttpu_descricao" class="form-control" placeholder="Descrição TPU" />
                                            <button id="bntBuscarTPU" name="bntBuscarTPU">Buscar TPU</button>
                                        </div>
                                    </div>

                                    <div class="form-group" style="display:none">
                                        <label class="control-label col-sm-4">Data Base TPU</label>
                                        <div class="col-sm-8">
                                            <input id="txttpu_data_base_der" name="txttpu_data_base_der" class="form-control" placeholder="Data Base TPU" />
                                        </div>
                                    </div>

                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Classe</label>
                                        <div class="col-sm-8">
                                            @Html.DropDownList("cmbClassesOS", null, "-- Selecione --", new { @class = "form-control " })
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">O.S. Principal</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_codigo_pai" name="txtord_codigo_pai" class="form-control"
                                                   placeholder="Ordem de Serviço Principal" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtDummy12" class="form-control" style="visibility:hidden" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Abertura</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_abertura" name="txtord_data_abertura" placeholder="Data Abertura"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtDummy1" class="form-control" style="visibility:hidden" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Contrato de Fiscalização</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtcon_codigofiscalizacao" name="txtcon_codigofiscalizacao" class="form-control" placeholder="Contrato de Fiscalização" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Contrato de Execução</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtcon_codigoexecucao" name="txtcon_codigoexecucao"
                                                   class="form-control" placeholder="Contrato de Execução" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Término Programada</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_termino_programada" name="txtord_data_termino_programada" placeholder="Data Término Programada"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Data Término Execução</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_data_termino_execucao" name="txtord_data_termino_execucao" placeholder="Data Término Execução"
                                                   class="form-control" readonly />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Responsável Suspensão</label> </nobr>
                                        <div class="col-sm-8">
                                            @*@Html.DropDownList("cmbResponsavelDER", null, "-- Selecione --", new { @class = "form-control " })*@
                                            <input id="txtord_responsavel_suspensao" name="txtord_responsavel_suspensao"
                                                   placeholder="Responsável Suspensão"
                                                   class="form-control" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr> <label class="control-label col-sm-4">Responsável Cancelamento</label></nobr>
                                        <div class="col-sm-8">
                                            @*@Html.DropDownList("cmbResponsavelDER", null, "-- Selecione --", new { @class = "form-control " })*@
                                            <input id="txtord_responsavel_cancelamento" name="txtord_responsavel_cancelamento"
                                                   placeholder="Responsável Cancelamento"
                                                   class="form-control" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtDummy2" class="form-control" style="visibility:hidden" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtDummy3" class="form-control" style="visibility:hidden" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <nobr></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtDummy13" class="form-control" style="visibility:hidden" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <nobr><label class="control-label col-sm-4">Quantidade Executada</label></nobr>
                                        <div class="col-sm-8">
                                            <input id="txtord_quantidade_executada" name="txtord_quantidade_executada" class="form-control"
                                                   placeholder="Quantidade Executada" />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-4">Custo Final</label>
                                        <div class="col-sm-8">
                                            <input id="txtord_custo_final" name="txtord_custo_final" class="form-control"
                                                   placeholder="Custo Final" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="tab-pane fade" id="tabFichaInspecaoCadastral" role="tabpanel" aria-labelledby="tabFichaInspecaoCadastral">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-primary" onclick="window.open('../../Reports/frmReport.aspx?relatorio=rptFichaInspecaoCadastral_1&id=' + selectedId_obj_id + '&ord_id=' + selectedId_ord_id, '_blank');">Imprimir Ficha</button>
                                </div>
                                <div class="col-sm-8">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas">FICHA BÁSICA PARA EXECUÇÃO DA INSPEÇÃO CADASTRAL</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br /><br />
                        <div id="partialFicha1">
                            @*AQUI A FICHA É COLOCADA DINAMICAMENTE*@
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tabFichaInspecao1aRotineira" role="tabpanel" aria-labelledby="tabFichaInspecao1aRotineira">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-5">
                                    <button type="button" class="btn btn-primary" onclick="window.open('../../Reports/frmReport.aspx?relatorio=rptFichaInspecaoRotineira&tos_id=1&id=' + selectedId_obj_id + '&ord_id=' + selectedId_ord_id, '_blank');">Imprimir Ficha</button>
                                    <button type="button" class="btn btn-primary" onclick="Ficha2_ExportarXLS();">Exportar para XLS</button>
                                    <button type="button" class="btn btn-primary" onclick="window.open(' ../../Reports/frmDownloadFile.aspx?filename=Modelo_Folha_A1_Insp_Rotineira.dwt', '_blank');">Modelo A1 (.dwt)</button>
                                </div>
                                <div class="col-sm-7">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas">FICHA BÁSICA PARA EXECUÇÃO DA INSPEÇÃO CADASTRAL (1ª ROTINEIRA)</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br /><br />
                        <div id="partialFicha2">
                            @*AQUI A FICHA É COLOCADA DINAMICAMENTE*@
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tabFichaInspecaoRotineira" role="tabpanel" aria-labelledby="tabFichaInspecaoRotineira">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-5">
                                    <button type="button" class="btn btn-primary" onclick="window.open('../../Reports/frmReport.aspx?relatorio=rptFichaInspecaoRotineira&tos_id=2&id=' + selectedId_obj_id + '&ord_id=' + selectedId_ord_id, '_blank');">Imprimir Ficha</button>
                                    <button type="button" class="btn btn-primary" onclick="Ficha2_ExportarXLS();">Exportar para XLS</button>
                                    <button type="button" class="btn btn-primary" onclick="window.open(' ../../Reports/frmDownloadFile.aspx?filename=Modelo_Folha_A1_Insp_Rotineira.dwt', '_blank');">Modelo A1 (.dwt)</button>
                                </div>
                                <div class="col-sm-7">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas">FICHA BÁSICA PARA EXECUÇÃO DA INSPEÇÃO ROTINEIRA EM CAMPO</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br /><br />
                        <div id="partialFicha3">
                            @*AQUI A FICHA É COLOCADA DINAMICAMENTE*@
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tabFichaInspecaoEspecial" role="tabpanel" aria-labelledby="tabFichaInspecaoEspecial2">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-primary" onclick="window.open('../../Reports/frmReport.aspx?relatorio=rptFichaInspecaoEspecial&id=' + selectedId_obj_id + '&ord_id=' + selectedId_ord_id, '_blank');">Imprimir Ficha</button>
                                </div>
                                <div class="col-sm-8">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas">Informações Básicas da OAE - Inspeção Especial</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br /><br />

                        <div id="partialFicha4">
                            @*AQUI A FICHA É COLOCADA DINAMICAMENTE*@
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tabFichaInspecaoEspecialAnomalias" role="tabpanel" aria-labelledby="tabFichaInspecaoEspecialAnomalias2">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-primary" onclick="window.open('../../Reports/frmReport.aspx?relatorio=rptFichaInspecaoEspecial_campo&id=' + selectedId_obj_id + '&ord_id=' + selectedId_ord_id, '_blank');">Imprimir Ficha</button>
                                    <button type="button" class="btn btn-primary" onclick="Ficha4_CAMPO_ExportarXLS();">Exportar para XLS</button>
                                </div>
                                <div class="col-sm-8">
                                    <h3 class="modal-title"><label id="lblModalHeader" class="titulosAbas">Ficha de Cadastramento de Anomalias - Inspeção Especial</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br /><br />

                        <div id="partialFicha5">
                            @*AQUI A FICHA É COLOCADA DINAMICAMENTE*@
                        </div>
                    </div>


                    <div class="tab-pane fade" id="tabDocumentosAssociadosOBJ" role="tabpanel" aria-labelledby="tabDocumentosAssociadosOBJ">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <h2 class="modal-title" style="text-align:center"><label id="HeaderOS_DocumentosOBJ" class="titulosAbas">Documentos associados ao Objeto</label></h2>
                                </div>
                            </div>
                        </div>

                        <br /><br />
                        <table id="tblDocumentosAssociadosOBJ">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th>Documento</th>
                                    <th>Tipo</th>
                                    <th>Descrição</th>
                                    <th>Caminho</th>
                                    <th>Opções</th>
                                </tr>
                            </thead>
                        </table>

                    </div>

                    <div class="tab-pane fade" id="tabDocumentosAssociadosOS" role="tabpanel" aria-labelledby="tabDocumentosAssociadosOS">
                        <br /><br />
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <button type="button" class="btn btn-primary" onclick="AssociarDocumento()">Associar Documento(s)</button>
                                </div>
                                <div class="col-sm-8">
                                    <h3 class="modal-title"><label id="HeaderOS_Documentos" class="titulosAbas">Documentos associados à Ordem de Serviço</label></h3>
                                </div>
                            </div>
                        </div>

                        <br /><br />
                        <table id="tblDocumentosAssociados">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th>Documento</th>
                                    <th>Tipo</th>
                                    <th>Descrição</th>
                                    <th>Caminho</th>
                                    <th>Opções</th>
                                </tr>
                            </thead>
                        </table>

                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

@***** FIM das ABAS ***********************@

<link href="~/Content/Gerais.css" rel="stylesheet" />
<link href="~/Content/font-awesome.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Content/plugins/sweetalert2.min.js"></script>

@section Scripts{
    <script>
        var permissaoLeitura = parseInt(@permissoesDesteModulo.mfl_leitura);
        var permissaoEscrita = parseInt(@permissoesDesteModulo.mfl_escrita);
        var permissaoInsercao = parseInt(@permissoesDesteModulo.mfl_inserir);
        var permissaoExclusao = parseInt(@permissoesDesteModulo.mfl_excluir);
    </script>

}
<script src="~/Scripts/Base.js"></script>

<div class="modal fade" id="modalSalvarRegistro" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="width:850px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title text-center"><b><label id="lblModalHeader">Nova Ordem de Serviço</label></b></h3>
            </div>
            <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                <br />

                <div class="modal-body form-group">

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-sm-3">Código</label>
                            <div class="col-sm-9">
                                <input id="txtord_codigo_Novo" name="txtord_codigo"
                                       class="form-control" disabled />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Tipo de O.S.<span class="text-danger">*</span> </label>
                            <div class="col-sm-9">
                                @Html.DropDownList("cmbTiposOS_Novo", null, "-- Selecione --", new { @class = "form-control", @onchange = "cmbTiposOS_Novo_onchange()" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Descrição<span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                <input id="txtord_descricao_Novo" name="txtord_descricao_Novo" class="form-control"
                                       placeholder="Descrição" data-val="true" required
                                       maxlength="255" pattern=".{1,255}" title="1 a 255 caracteres"
                                       autocomplete="off"
                                       onkeyup="$('#txtord_descricao_Novo').css('background-color', corBranca)" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Objeto<span class="text-danger">*</span> </label>
                            <div class="col-sm-9">
                                <table style="width:100%">
                                    <tr>
                                        <td style="width:100%">
                                            <input id="txtobj_codigo_Novo" name="txtobj_codigo_Novo" class="form-control"
                                                   placeholder="Objeto" readonly
                                                   autocomplete="off" />
                                        </td>
                                        <td>
                                            <button style="display:inline; width:40px; height:25px; margin-left:5px; display:inline" onclick="return abrirLocalizarObjetos();">...</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">
                            <nobr><label class="control-label col-sm-3">Data Início Planejada<span class="text-danger">*</span></label></nobr>
                            <div class="col-sm-9">
                                <input id="txtord_data_planejada_Novo" name="txtord_data_planejada_Novo" placeholder="Data Início Planejada"
                                       class="form-control" readonly style="background-color:transparent" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Aberta Por</label>
                            <div class="col-sm-9">
                                <input id="txtusu_nome_Novo" name="txtusu_nome"
                                       class="form-control" disabled value="@( @gUsuario.usu_nome)" title="@( gUsuario.usu_id)" />
                            </div>
                        </div>

                        <div class="form-group">
                            <nobr><label class="control-label col-sm-3">Data Abertura</label></nobr>
                            <div class="col-sm-9">
                                <input id="txtord_data_abertura_Novo" name="txtord_data_abertura_Novo" placeholder="Data Abertura"
                                       class="form-control" disabled value="@( DateTime.Now.ToShortDateString() )">
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <div class="col-md-3 col-md-offset-4">
                        <button id="bntSalvar" name="bntSalvar_Novo" onclick="return bntSalvar_Novo_onclick();" class="btn btn-primary btn-block btn-flat">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="modal fade" id="modalAssociarDocumento" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="margin-left:150px; width:650px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title text-center"><b><label id="lblModalHeader">Associar Documento(s) a esta O.S.</label></b></h3>
            </div>
            <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                <br />
                <div class="modal-body form-group">

                    <div class="form-group" style="text-align:center;">
                        <input id="txt_codigo" name="txt_codigo" class="txtdoc_codigoHeader" readonly style="text-align:center; width:95%" />
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3" style="padding-top:5px !important">Documento</label>
                        <div class="col-sm-6" style="padding-left:0px !important">
                            <input id="txtLocalizarDocumento" name="txtLocalizarDocumento" class="form-control col-sm-6"
                                   placeholder="Digite o Código do Documento"
                                   autocomplete="off"
                                   onkeyup="if ((event.keyCode == 13)) { event.preventDefault(); if (!document.getElementById('btnLocalizarDocumentos').disabled) LocalizarDocumentos(); return false;} " />
                        </div>
                        <div class="col-sm-3">
                            <button id="btnLocalizarDocumentos" onclick="return LocalizarDocumentos();" class="btn btn-primary btn-block btn-flat col-sm-3" style="width:100px">Localizar</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-3" style="text-align:right">
                            <label class="control-label" style="text-align:right" id="lblTotalLocalizados">Localizados</label>
                        </div>
                        <div class="col-sm-9"
                             style="width:72%; height:100px; overflow-y:auto; border:solid 1px lightgray; border-radius:4px !important;"
                             id="divDocumentosLocalizados">
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <div class="col-md-3 col-md-offset-4">
                        <button id="bntAssociarDocumento" name="bntAssociarDocumento" onclick="return OrdemServico_AssociarDocumento_Salvar();" class="btn btn-primary btn-block btn-flat">Associar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>



<div class="modal fade" id="modalLocalizarObjeto" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="margin-left:150px; width:750px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title text-center"><b><label id="lblModalHeader">Localizar Objeto</label></b></h3>
            </div>
            <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                <br />
                <div class="modal-body form-group">

                    <div class="form-group">
                        <label class="control-label col-sm-3" style="padding-top:0px !important">Localizar Objeto</label>
                        <div class="col-sm-9" style="padding-left:0px !important">

                            <input id="txtLocalizarObjeto" name="txtLocalizarObjeto" class="form-control"
                                   placeholder="Digite o Código/Iniciais do Objeto"
                                   autocomplete="off"
                                   onkeyup="if ((event.keyCode == 13) || (this.value.length > 1) ) { event.preventDefault(); LocalizarObjetos(); return false;} " />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Localizados</label>
                        <div class="col-sm-9"
                             style="width:72%; height:100px; padding: 0px !important; border:solid 1px lightgray; border-radius:4px !important;"
                             id="divObjetosLocalizados">

                            <select multiple="multiple" size="5" id="lstObjetosLocalizados" style="margin-right:5px; width:100%; border:none;" onchange="OrdemServico_Objeto_Salvar();"></select>

                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <div class="col-md-3 col-md-offset-4">
                        <button id="bntOrdemServico_Objeto" name="bntOrdemServico_Objeto" onclick="return OrdemServico_Objeto_Salvar();" class="btn btn-primary btn-block btn-flat">Selecionar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="~/Scripts/jquery-ui.js"></script>
<link href="~/Scripts/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/moment.min.js"></script>
<script src="~/Scripts/datetime-moment.js"></script>
<script src="~/Scripts/OrdemServico/OrdemServico.js"></script>
@*<script src="~/Scripts/Shared/_fichaInspecaoCadastral.js"></script>*@

<script>

    moment.locale('pt-br');         // pt-br
    $.fn.dataTable.moment('DD/MM/YYYY HH:mm:ss');

    jQuery(function ($) {
        $.datepicker.regional['pt-BR'] = datepicker_regional;
        $.datepicker.setDefaults($.datepicker.regional['pt-BR']);
    });

    $('#txtord_data_planejada_Novo').datepicker({
        minDate: 0,
        dateFormat: 'dd/mm/yy',
        onSelect: function () {
            $('#txtord_data_planejada_Novo').css('background-color', corBranca);
        }
    });


    $('#txtord_data_inicio_programada').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_inicio_execucao').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_suspensao').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_cancelamento').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_reinicio').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_termino_programada').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtord_data_termino_execucao').datepicker({ dateFormat: 'dd/mm/yy' });

    $('#filtroord_data_De').datepicker({
        dateFormat: 'dd/mm/yy',
        onSelect: function () {
            var dt2 = $('#filtroord_data_Ate');

            // seta a data inicial do txtdataExecucaoAte
            var startDate = $(this).datepicker('getDate');
            startDate.setDate(startDate.getDate() + 1);
            var minDate = $(this).datepicker('getDate');
            var dt2Date = dt2.datepicker('getDate');

            dt2.datepicker("setDate", startDate);
            dt2.datepicker('option', 'minDate', startDate);
        }
    });

    $('#filtroord_data_Ate').datepicker({ dateFormat: 'dd/mm/yy' });

    // datepickers das fichas, aba DADOS GERAIS
    $('#txt_atr_id_103').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txt_atr_id_104').datepicker({ dateFormat: 'dd/mm/yy' });

    $('#txt_atr_id_1103').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txt_atr_id_1104').datepicker({ dateFormat: 'dd/mm/yy' });



    ////$('#txt_historico_data_1').datepicker({ dateFormat: 'dd/mm/yy' });
    ////$('#txt_historico_data_2').datepicker({ dateFormat: 'dd/mm/yy' });
    ////$('#txt_historico_data_3').datepicker({ dateFormat: 'dd/mm/yy' });


    moduloCorrente = 'OrdemServico';



    function UploadEsquema() {

        //campo "DE" vazio
        if ($('#txtdoc_caminho9').val().trim() == "") {
            swal({
                type: 'error',
                title: 'Aviso',
                text: "Selecione o arquivo para upload"
            });
            return false;
        }

        var file = $('#esquemaBrowse').get(0).files;

        var porcentagem = 0;
        let timerInterval
        Swal.fire({
            title: 'Enviando arquivo para o servidor',
            html: '<b></b>%',
            timer: 200000,
            timerProgressBar: false,
            allowOutsideClick: false,
            onBeforeOpen: () => {
                Swal.showLoading()
                timerInterval = setInterval(() => {
                    const content = Swal.getContent()
                    if (content) {
                        const b = content.querySelector('b')
                        if (b) {
                            b.textContent = porcentagem;
                        }
                    }
                }, 100)
            },
            onClose: () => {
                clearInterval(timerInterval)
                return;
            }
        }).then((result) => {
            Swal.close();
            return;
        })

        var data = new FormData;
        data.append("EsquemaEstrutural", file[0]);
        data.append("obj_id", selectedId_obj_id);
        data.append("atr_id", 159);


        $.ajax({
            xhr: function () {
                var xhr = new window.XMLHttpRequest();
                xhr.upload.addEventListener("progress", function (evt) {
                    if (evt.lengthComputable) {
                        var percentComplete = evt.loaded / evt.total;
                        percentComplete = parseInt(percentComplete * 100);

                        porcentagem = percentComplete;
                        if (percentComplete === 100) {
                            Swal.close();
                        }

                    }
                }, false);
                return xhr;
            },

            type: "Post",
            url: "/Objeto/EsquemaEstrutural_Upload",
            data: data,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response == "") {
                    //alert("ok");

                    swal({
                        type: 'success',
                        title: 'Sucesso',
                        text: 'Arquivo salvo com sucesso'
                    });

                    document.getElementById("img_atr_id_159").setAttribute('src', src);

                    return false;
                }
                else {
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: response
                    });
                    return false;
                }
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        })

        return false;
    }

</script>

