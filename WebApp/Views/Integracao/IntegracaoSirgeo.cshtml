
@model List<WebApp.Models.Usuario>
@using WebApp.Models
@{

    //Verifica se o usuário esta logado
    if (Session["Usuario"] == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 830 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }

    Usuario gUsuario = (Usuario)Session["Usuario"];
    List<UsuarioPermissoes> lstPermissoes = gUsuario.lstUsuarioPermissoes;
    UsuarioPermissoes permissoesDesteModulo = lstPermissoes.Find(x => x.mod_id.Equals(830)); // 810 = id DO MODULO "IntegracaoSIRGeo"
    if (permissoesDesteModulo == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 830 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }

    UsuarioPermissoes permissoesConfiguracaoAtributos = lstPermissoes.Find(x => x.mod_id.Equals(830)); // acha permissoes para Configuracao
    if (permissoesConfiguracaoAtributos == null)
    {
        permissoesConfiguracaoAtributos = new UsuarioPermissoes();
        permissoesConfiguracaoAtributos.mfl_leitura= 0;
        permissoesConfiguracaoAtributos.mfl_escrita= 0;
        permissoesConfiguracaoAtributos.mfl_inserir= 0;
        permissoesConfiguracaoAtributos.mfl_excluir = 0;
    }

}

<h2></h2>

<form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
    @{
        ViewBag.Title = "::.. Integração SIRGeo - Rodovias ..::";
    }
</form>


<div style="width:100%;" id="divRodovias">
    <div class="box box-primary">
        <div class="box-body">
            <div class="form-group">
                <div class="col-sm-3">
                    <label class="control-label">Rodovia</label>
                    <input type="text" class="form-control" id="txtCodRodovia" maxlength="50" onkeydown="if (event.keyCode == 13) { ExecutarRodovia(); }">
                </div>
                <div>
                    <div class="btn-box-tool pull-right" style="margin-top:10px">
                        <button type="reset" class="btn btn-info" onclick="LimparFiltro();"><i class="fa fa-eraser margin-r-5"></i> Limpar</button>
                        <button type="submit" class="btn btn-primary" onclick="ExecutarFiltro();" style="margin-right: 10px !important;"><i class="fa fa-search margin-r-5"></i> Pesquisar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="content" style="min-height: 50px;">
    <div class="row">
            <div class="box box-primary">
                <div class="box-body">

                    <table id="tblRodovias">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Código</th>
                                <th>Descrição</th>
                                <th>Km Inicial</th>
                                <th>Km Final</th>
                                <th>Extensão</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        @*</div>*@
    </div>
</section>


<style>
    .Centralizado {
        text-align: center;
    }
</style>

<link href="~/Content/Gerais.css" rel="stylesheet" />
<link href="~/Content/font-awesome.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Content/plugins/sweetalert2.min.js"></script>

@section Scripts{
    <script>
        var permissaoLeitura = parseInt(@permissoesDesteModulo.mfl_leitura);
        var permissaoEscrita = parseInt(@permissoesDesteModulo.mfl_escrita);
        var permissaoInsercao = parseInt(@permissoesDesteModulo.mfl_inserir);
        var permissaoExclusao = parseInt(@permissoesDesteModulo.mfl_excluir);
    </script>


}

<script src="~/Scripts/Base.js"></script>


<script>
    function LimparFiltro() {

        $('#txtCodRodovia').val('');
        $('#tblRodovias').DataTable().ajax.reload();  //false = sem reload na pagina.
        return false;
    }

    function ExecutarFiltro() {
        $('#tblRodovias').DataTable().ajax.reload();  //false = sem reload na pagina.
        return false;
    }


    // montagem do gridview
    $(document).ready(function () {
 
        $('#tblRodovias').DataTable({
            "ajax": {
                "url": "/Integracao/Integracao_Rodovias_ListAll",
                "type": "GET",
                "datatype": "json",
                "data": function (d) {
                    d.rod_Codigo = $('#txtCodRodovia').val().trim();
                }
            }
            , "columns": [
                { data: "rod_id", "className": "Centralizado", "searchable": false },
                { data: "rod_codigo", "width": "200px", "searchable": false },
                { data: "rod_descricao",  "autoWidth": true, "searchable": false },
                { data: "rod_km_inicial", "className": "Centralizado", "width": "80px", "searchable": false },
                { data: "rod_km_final", "className": "Centralizado","width": "80px", "searchable": false },
                { data: "rod_km_extensao", "className": "Centralizado", "width": "80px", "searchable": false }
            ]
            , "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]]
            , select: {
                style: 'single'
            }
            , searching: false
            , "oLanguage": idioma
            , "pagingType": "input"
            , "sDom": '<"top">rt<"bottom"pfli><"clear">'

            , "createdRow": function (row, data, dataIndex) {
                if (parseInt(data.rod_codigo) == -1) {
                    swal({
                        type: 'error',
                        title: 'Erro',
                        text: data.rod_descricao
                    }).then(
                        function () {
                            return false;
                        });

                }
            }

        });


    });


</script>

