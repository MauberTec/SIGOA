@{
    ViewBag.Title = "::.. Orçamento ..::";
}

@model List<WebApp.Models.Usuario>
@using WebApp.Models
@{
    //Verifica se o usuário esta logado
    if (Session["Usuario"] == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 1210 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }

    Usuario gUsuario = (Usuario)Session["Usuario"];
    List<UsuarioPermissoes> lstPermissoes = gUsuario.lstUsuarioPermissoes;
    UsuarioPermissoes permissoesDesteModulo = lstPermissoes.Find(x => x.mod_id.Equals(1210)); // id DO MODULO "cadastro de orcamento"
    if (permissoesDesteModulo == null)
    {
        Html.Action("LogSistema_Salvar", "LogSistema", new { mod_id = 1210 });
        Response.Redirect("~/AcessoNegado/AcessoNegado");
    }
}

<h2></h2>
<style>
    .Centralizado {
        text-align: center;
    }

    .codigoHeader {
        color: red !important;
        font-weight: bold;
        font-size: 18pt !important;
        margin: 0px;
        background-color: white !important;
        border: none !important;
        box-shadow: none !important;
    }

    .maxwidthDescricao {
        max-width: 400px !important;
    }

    .dropbtn {
        background-color: #3c8dbc;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }

    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        width: 98%;
    }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

            .dropdown-content a:hover {
                background-color: #f1f1f1;
            }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .dropdown:hover .dropbtn {
        background-color: #3c8dbc;
    }

    .visibilityHidden {
        visibility: hidden !important;
    }

    .scroll {
        width: auto;
        overflow-x: auto;
        white-space: nowrap;
    }

    button:focus {
        border: none !important;
        outline: 0px !important;
    }

    .rotate {
        -webkit-transform: rotate(-90deg);
        -ms-transform: rotate(-90deg);
        -o-transform: rotate(-90deg);
        transform: rotate(-90deg);
    }

    .borderBottom {
        border-bottom: solid 1px black;
    }

    .borderTop {
        border-top: solid 1px black;
    }

    .borderLeft {
        border-left: solid 1px black;
    }

    .borderRight {
        border-right: solid 1px black;
    }

    .lblsNormal {
        font-weight: normal;
        height: 25px;
        margin: 5px !important;
        padding: 5px !important;
        border: none;
    }

    input.txts, .txts {
        border: solid 1px lightgray;
        width: 75%;
        height: 95%;
        margin: 0 !important;
        margin-left: 3px !important;
        margin-top: 5px !important;
        display: inline-block;
        color: blue;
        font-weight: normal;
        resize: none;
    }

    .lblTitulos {
        height: 25px;
        color: #FFFFFF;
        background-color: gray;
        font-weight: bold;
        /*border: solid 1px black;*/
        padding-left: 5px;
        border-left: solid 1px white !important;
        border-right: solid 1px white !important;
        border-bottom: solid 1px black !important;
    }

    .btnHeader1 {
        width: 100%;
        height: 35px;
        background-color: transparent;
        border: none;
        padding: 5px;
        margin: 0;
        text-align: left;
        font-size: 12pt;
    }


    .altura50 {
        height: 50px;
    }

    #divTudo input:disabled,
    #divTudo textarea:disabled,
    #divTudo select:disabled {
        background-color: transparent;
        border: none !important;
        margin: 3px !important;
        box-shadow: none !important;
        -webkit-appearance: none;
        -moz-appearance: none;
        text-indent: 1px;
        text-overflow: '';
    }

    #divTudo input:enabled,
    #divTudo textarea:enabled,
    #divTudo select:enabled {
        background-color: white;
        border: solid 1px lightgray;
        margin: 3px !important;
        -webkit-appearance: default-button;
        -moz-appearance: button-arrow-down;
        text-indent: 1px;
        text-overflow: '';
    }

    .contornoBranco {
        text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;
    }

    .altura30 {
        height: 30px;
    }

    .backgrdTransparent {
        background-color: transparent !important;
    }

    .chklst {
        font-family: 'Lucida Console';
        font-size: 14px;
        padding-top: 0px;
        margin-bottom: 0px;
        font-weight: normal;
    }

    .dataTables_filter {
        display: none
    }

    .fonte14 {
        font-size: 12.5pt;
        font-weight: bold;
    }

    input[type="checkbox"][readonly] {
        pointer-events: none;
    }

    .borderBottom {
        border-bottom: solid 1px black;
    }

    .borderTop {
        border-top: solid 1px black;
    }

    .borderLeft {
        border-left: solid 1px black;
    }

    .borderRight {
        border-right: solid 1px black;
    }

    .lblsBold {
        font-weight: bold;
        height: 25px;
        margin: 0 !important;
        margin-left: 5px !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-top: 0 !important;
        text-align: left;
    }

    .lblsNormal {
        font-weight: normal;
        height: 25px;
        margin: 5px !important;
        padding: 5px !important;
        border: none;
    }

    input.txts, .txts {
        border: solid 1px lightgray !important;
        width: 75%;
        height: 95%;
        margin: 0 !important;
        margin-left: 3px !important;
        margin-top: 5px !important;
        display: inline-block;
        color: blue;
        font-weight: normal;
        resize: none;
    }

    .lblTitulos {
        height: 25px;
        color: #FFFFFF;
        background-color: gray;
        font-weight: bold;
        /*border: solid 1px black;*/
        padding-left: 5px;
        border-left: solid 1px black;
        border-right: solid 1px black;
        border-bottom: solid 1px black;
    }

    .btnHeader1 {
        width: 100%;
        height: 35px;
        background-color: transparent;
        border: none;
        padding: 5px;
        margin: 0;
        text-align: left;
        font-size: 12pt;
    }


    .altura50 {
        height: 50px;
    }
</style>


<div style="width:100%;" id="divFiltros">
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Localizar</h3>
        </div>
        <div class="box-body">
            <div class="form-group">
                <div class="col-sm-4">
                    <label class="control-label">Rodovia</label>
                    <input type="text" class="form-control" id="txtFiltroRodovia" maxlength="150" onkeydown="if (event.keyCode == 13) { ExecutarFiltroOrcamento(); }">
                </div>

                <div class="col-sm-4">
                    <label class="control-label">Objetos</label>
                    <input type="text" class="form-control" id="txtFiltroObjetos" maxlength="255" onkeydown="if (event.keyCode == 13) { ExecutarFiltroOrcamento(); }">
                </div>

                <div class="col-sm-4 ">
                    <label class="control-label">Status</label>
                    @Html.DropDownList("cmbFiltroStatusOrcamento", null, "-- Selecione --", new { @class = "form-control " })
                </div>

                <div>
                    <div class="btn-box-tool pull-right" style="margin-top:10px">
                        <button type="reset" class="btn btn-info" onclick="LimparFiltroOrcamento();"><i class="fa fa-eraser margin-r-5"></i> Limpar</button>
                        <button type="submit" class="btn btn-primary" onclick="ExecutarFiltroOrcamento();" style="margin-right: 10px !important;"><i class="fa fa-search margin-r-5"></i> Pesquisar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="content" style="min-height: 50px;">
    <div class="row">
        <div class="box box-primary">
            <div class="box-body">
                <table id="tblOrcamento">
                    <thead>
                        <tr>
                            <th><label id="lblSelecionados" style="margin-bottom: 0; margin-left:7px;"></label></th>
                            <th>orc_id</th>
                            <th>ocs_id</th>
                            <th style="width: 90px;">Orçamento</th>
                            <th style="width: 46px;">Versão</th>
                            <th style="width: 60px;">Data Criação</th>
                            <th style="width: 60px;">Data Validade</th>
                            <th>Status</th>
                            <th>Valor Total</th>
                            <th>OSs Associadas</th>
                            <th>Objetos Associados</th>
                            <th>Opções</th>
                        </tr>
                    </thead>
                </table>

                @{
                    if ((permissoesDesteModulo != null) && (permissoesDesteModulo.mfl_inserir > 0))
                    {
                        <button type="button" class="btn btn-primary  botaoInserir" id="btnNovoOrcamento" onclick="btnNovoOrcamento_onclick()">Novo Orçamento</button>
                    }
                }

                <button type="button" class="btn btn-primary  botaoInserir" id="btnLimparSelecao" onclick="btnLimparSelecao_onclick();">Limpar Seleção</button>

                <input type="checkbox" id="chkMostrarInativos" style="margin-left: 20px; vertical-align:sub;" value="2" onchange="btnMostrarInativos_onclick(this.checked);">
                <label for="chkMostrarInativos" style="padding-left: 4px;vertical-align:sub;">Mostrar Inativos</label>
                <br>
            </div>
        </div>
    </div>


    <div class="row" id="divTudo">
        <div class="box box-primary">
            <div class="box-body">
                <div id="div_FICHA_ORCAMENTO_DETALHES_1" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_1" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_1"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_1"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_1"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_1"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_1"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_1"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_1"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_1" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_2" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_2" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_2"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_2"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_2"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_2"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_2"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_2"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_2"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_2" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_3" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_3" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_3"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_3"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_3"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_3"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_3"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_3"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_3"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_3" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_4" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_4" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_4"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_4"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_4"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_4"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_4"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_4"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_4"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_4" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_5" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_5" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_5"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_5"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_5"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_5"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_5"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_5"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_5"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_5" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_6" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_6" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_6"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_6"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_6"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_6"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_6"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_6"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_6"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_6" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_7" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_7" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_7"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_7"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_7"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_7"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_7"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_7"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_7"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_7" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_8" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_8" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_8"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_8"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_8"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_8"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_8"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_8"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_8"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_8" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_9" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_9" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_9"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_9"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_9"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_9"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_9"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_9"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_9"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_9" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="div_FICHA_ORCAMENTO_DETALHES_10" style="display:none">
                    <table id="tbl_ORCAMENTO_DETALHES_10" cellpadding="0" cellspacing="1" style="width: 100%;">
                        <tr>
                            <td class="lblTitulos " style="margin:0; padding:0;">
                                <table style="width:100%">
                                    <tr>
                                        <td>
                                            <button id="btn_Toggle_ORCAMENTO_DETALHES_10"
                                                    type="button" data-toggle="collapse" data-target="#div_ORCAMENTO_DETALHES_10"
                                                    onclick="ORCAMENTO_DETALHES_header_click(this.id)" aria-expanded="false"
                                                    class="btnHeader1"></button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Salvar_ORCAMENTO_DETALHES_10"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Salvar(this.id)"
                                                    title="Salvar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-ok text-success contornoBranco"></span>
                                            </button>
                                        </td>

                                        <td style="width:25px !important; ">
                                            <button id="btn_Cancelar_ORCAMENTO_DETALHES_10"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Cancelar(this.id)"
                                                    title="Cancelar Edição"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-remove text-danger contornoBranco"></span>
                                            </button>

                                            <button id="btn_Editar_ORCAMENTO_DETALHES_10"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Editar(this.id)"
                                                    title="Editar"
                                                    style="display:none;  border:none; box-shadow:none; background-color:transparent; ">
                                                <span class="glyphicon glyphicon-pencil"></span>
                                            </button>
                                        </td>
                                        <td style="width:25px !important; ">
                                            <button id="btn_Clonar_ORCAMENTO_DETALHES_10"
                                                    type="button"
                                                    onclick="return ORCAMENTO_DETALHES_Clonar(this.id)"
                                                    title="Clonar"
                                                    style="display:none; border:none; box-shadow:none; background-color:transparent; ">
                                                <span><i class="fa fa-files-o fa-lg"></i></span>
                                            </button>
                                        </td>
                                        <td style="width:20px !important; padding-right:5px !important; text-align:right !important">
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left" id="iconAngle_ORCAMENTO_DETALHES_10"></i>
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div id="div_ORCAMENTO_DETALHES_10" class="collapse">

                                    @Html.Partial("~/Views/Shared/_OrcamentoDetalhes.cshtml")

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>


</section>


<br />
<br />
<br />
<link href="~/Content/Gerais.css" rel="stylesheet" />
<link href="~/Content/font-awesome.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Content/plugins/sweetalert2.min.js"></script>

@section Scripts{
    <script>
                var permissaoLeitura = parseInt(@permissoesDesteModulo.mfl_leitura);
                var permissaoEscrita = parseInt(@permissoesDesteModulo.mfl_escrita);
                var permissaoInsercao = parseInt(@permissoesDesteModulo.mfl_inserir);
                var permissaoExclusao = parseInt(@permissoesDesteModulo.mfl_excluir);
    </script>

}
<script src="~/Scripts/Base.js"></script>

<link href="~/Content/bootstrap-multiselect.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-multiselect.js"></script>

<script src="~/Content/plugins/jquery.mask.min.js"></script>
<script src="~/Content/plugins/jquery.mask.js"></script>

<script src="~/Scripts/jquery-ui.js"></script>
<link href="~/Scripts/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/moment.min.js"></script>
<script src="~/Scripts/datetime-moment.js"></script>

<script>
    var selectedId_orc_id = -1;
    var filtroRodovia = '';
    var filtroObjetos = '';
    var filtroStatus = -1;

    var ehNovoOrcamento_orc_id = -1;

    var orc_ids_selecionados = [];
    var orc_ord_ids_associados = '';
    var pri_ids_associados = '';

    function chkSelecao_onchange(quem) {

        if (quem.checked) {
            if (orc_ids_selecionados.length >= 10) {
                this.checked = false;
                swal({
                    type: 'error',
                    title: 'Aviso',
                    text: 'O número máximo de seleções é 10.'
                }).then(
                    function () {
                        return false;
                    });
                return false;
            }
            else {
                // prenche as abas
                orc_ids_selecionados.push(quem.value);
                var numAba = orc_ids_selecionados.length;

                carregaGridOrcamentoDetalhes(numAba, quem.value, 1);
            }
        }
        else {
            // checked = false entao limpar
            var qualAba = 0;
            for (var index = 0; index < orc_ids_selecionados.length; index++) {
                if (orc_ids_selecionados[index] === quem.value) {
                    //qualAba = index + 1;

                    // limpa a ultima aba porque removeu 1 e deslocou 1
                    var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + (orc_ids_selecionados.length));
                    if (div_FICHA_ORCAMENTO_DETALHES)
                        div_FICHA_ORCAMENTO_DETALHES.style.display = 'none';


                    // remove do array
                    orc_ids_selecionados.splice(index, 1);

                    // recarrega os itens que foram deslocados
                    for (var aux = index; aux < orc_ids_selecionados.length; aux++) {
                        carregaGridOrcamentoDetalhes(aux+1, orc_ids_selecionados[aux], 1);
                    }


                    break;
                }
            }
        }
        if (orc_ids_selecionados.length > 0)
            $("#lblSelecionados").html("( " + orc_ids_selecionados.length + " )");
        else
            $("#lblSelecionados").html("");


        return false;
    }

    function btnLimparSelecao_onclick() {
        // limpa os arrays
        orc_ids_selecionados = [];
        selectedId_orc_id = -1;

        $("#lblSelecionados").html("");

        // limpa o GridOrcamento
        var table = $('#tblOrcamento').DataTable();
        table.$('input[type="checkbox"]').each(function () {
            if (this.checked)
                this.checked = false;
        });

        // oculta as abas
        for (var aba = 1; aba <= 10; aba++) {
            var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + aba);
            if (div_FICHA_ORCAMENTO_DETALHES)
                div_FICHA_ORCAMENTO_DETALHES.style.display = 'none';
        }

        return false;
    }

    function btnMostrarInativos_onclick(estado) {
        // alert(estado);
        btnLimparSelecao_onclick()

        carregaGridOrcamento();
    }


    function EditarOrcamento(orc_id) {
        ehNovoOrcamento_orc_id = orc_id;

        document.getElementById("lblModalHeader").innerText = "Editar Orçamento";

        var corBranca = "rgb(255, 255, 255)";
        $('#txtorc_codigo_Novo').css("background-color", corBranca);
        $('#txtorc_versao').css("background-color", corBranca);
        $('#txtorc_descricao_Novo').css("background-color", corBranca);
        $('#txtobj_codigo_Novo').css("background-color", corBranca);
        $('#txtorc_data_Validade_Novo').css("background-color", corBranca);
        $('#cmbStatusOrcamento').css("background-color", corBranca);

        $.ajax({
            url: "/Orcamento/Orcamento_GetbyID",
            type: "GET",
            "data": {
                "ID": orc_id,
            },
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (result) {
                $('#txtorc_codigo_Novo').val(result.orc_cod_orcamento);
                $('#txtorc_versao').val(result.orc_versao.trim());
                $('#txtorc_descricao_Novo').val(result.orc_descricao);
                $('#txtobj_codigo_Novo').val(result.orc_objetos_associados);
                $('#txtorc_data_Validade_Novo').val(result.orc_data_validade);
                $('#cmbStatusOrcamento').val(result.ocs_id);
                $('#chkorc_ativo').prop('checked', (result.orc_ativo == '1' ? true : false));

                pri_ids_associados = result.pri_ids_associados.replaceAll(" ", "");
                pri_ids_selecionados = result.pri_ids_associados.replaceAll(" ", "");


                return false;
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                return false;
            }
        });

        $("#modalSalvarRegistro").modal('show');
        return false;
    }
    function btnNovoOrcamento_onclick() {
        // limpa o background
        var corBranca = "rgb(255, 255, 255)";
        $('#txtorc_codigo_Novo').css("background-color", corBranca);
        $('#txtorc_versao').css("background-color", corBranca);
        $('#txtorc_descricao_Novo').css("background-color", corBranca);
        $('#txtobj_codigo_Novo').css("background-color", corBranca);
        $('#txtorc_data_Validade_Novo').css("background-color", corBranca);
        $('#cmbStatusOrcamento').css("background-color", corBranca);

        // limpa os valores
        $('#txtorc_codigo_Novo').val("");
        $('#txtorc_versao').val("");
        $('#txtorc_descricao_Novo').val("");
        $('#txtobj_codigo_Novo').val("");
        $('#txtorc_data_Validade_Novo').val("");
        $('#cmbStatusOrcamento').val(null);
        $('#chkorc_ativo').prop('checked', true);

        ehNovoOrcamento_orc_id = -1;

        document.getElementById("lblModalHeader").innerText = "Novo Orçamento";
        $("#modalSalvarRegistro").modal('show');
    }

    function bntSalvar_NovoOrcamento_onclick() {

        var txtorc_codigo_Novo = document.getElementById('txtorc_codigo_Novo');
        var txtorc_versao = document.getElementById('txtorc_versao');
        var txtorc_descricao_Novo = document.getElementById('txtorc_descricao_Novo');
        var txtobj_codigo_Novo = document.getElementById('txtobj_codigo_Novo');
        var txtorc_data_Validade_Novo = document.getElementById('txtorc_data_Validade_Novo');
        var cmbStatusOrcamento = document.getElementById('cmbStatusOrcamento');

        // salva
        ORCAMENTO_Salvar(ehNovoOrcamento_orc_id,
                        txtorc_codigo_Novo,
                        txtorc_versao,
                        txtorc_descricao_Novo,
                        cmbStatusOrcamento,
                        txtobj_codigo_Novo,
                        txtorc_data_Validade_Novo,
                        $('#chkorc_ativo')[0],
                        pri_ids_selecionados
                    );

        return false;
    }

    function AtivarDesativarOrcamento(orc_id, ativar) {

        if (orc_id >= 0) {
            var form = this;
            swal({
                title: (ativar == 1 ? "Ativar" : "Desativar") + ". Tem certeza?",
                icon: "warning",
                buttons: [
                    'Não',
                    'Sim'
                ],
                dangerMode: true,
                focusCancel: true
            }).then(function (isConfirm) {
                if (isConfirm) {
                    var url = "/Orcamento/Orcamento_AtivarDesativar";
                    var response = POST(url, JSON.stringify({ id: orc_id }))
                    if (response.erroId == 1) {
                        swal({
                            type: 'success',
                            title: 'Sucesso',
                            text: ativar == 1 ? msgAtivacaoOK : msgDesativacaoOK
                        });

                        // limpar selecionados e abas
                        btnLimparSelecao_onclick();
                        $('#tblOrcamento').DataTable().ajax.reload();
                    }
                    else {
                        swal({
                            type: 'error',
                            title: 'Aviso',
                            text: ativar == 1 ? msgAtivacaoErro : msgDesativacaoErro
                        });
                    }
                    return true;
                } else {
                    return false;
                }
            })
        }

        return false;
    }
    function DeletarOrcamento(orc_id) {
        var form = this;
        swal({
            title: "Excluir. Tem certeza?",
            icon: "warning",
            buttons: [
                'Não',
                'Sim'
            ],
            dangerMode: true,
            focusCancel: true
        }).then(function (isConfirm) {
            if (isConfirm) {
                var response = POST("/Orcamento/Orcamento_Excluir", JSON.stringify({ id: orc_id }))
                if (response.erroId >= 1) {
                    swal({
                        type: 'success',
                        title: 'Sucesso',
                        text: 'Registro excluído com sucesso'
                    });

                    // limpar selecionados e abas
                    btnLimparSelecao_onclick();
                    $('#tblOrcamento').DataTable().ajax.reload();
                    //document.getElementById('subGrids').style.visibility = "hidden";
                }
                else {
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: 'Erro ao excluir registro'
                    });
                }
                return true;
            } else {
                return false;
            }
        })

        return false;
    }

    function txtcodigo_onkeyup() {
        $('#txtcodigo').css("background-color", corBranca);
    }
    function txtdescricao_onkeyup() {
        $('#txtdescricao').css("background-color", corBranca);
    }

    function LimparFiltroOrcamento() {

        filtroRodovia = '';
        filtroObjetos = '';
        filtroStatus = -1;

        $("#txtFiltroRodovia").val("");
        $("#txtFiltroObjetos").val("");
        $("#cmbFiltroStatusOrcamento").val(null);


        carregaGridOrcamento();

        return false;
    }
    function ExecutarFiltroOrcamento() {

        filtroRodovia = $("#txtFiltroRodovia").val();
        filtroObjetos = $("#txtFiltroObjetos").val();
        filtroStatus = $("#cmbFiltroStatusOrcamento").val();

        carregaGridOrcamento();
        return false;
    }

    function cmbStatusOrcamento_onchange() {
        $('#cmbStatusOrcamento').css("background-color", corBranca);

    }

    function posicionaLinha(tabela, id_linha, coluna_do_id) {
        var dttable = $('#' + tabela).DataTable();

        var coluna_do_id = 0; // indice da coluna que contem o id

        // vai para a pagina
        var pos = dttable.column(coluna_do_id, { order: 'current' }).data().indexOf(id_linha);
        if (pos >= 0) {
            var page = Math.floor(pos / dttable.page.info().length);
            dttable.page(page).draw(false);
        }

        // remove selecao
        dttable.$('tr.selected').removeClass('selected');

        // seleciona a linha
        var row = document.getElementById(id_linha);
        if (row)
            row.className += " selected";

    }

    // ************** ABAS  *****************************************************************************************

    function ORCAMENTO_DETALHES_setaReadWrite(aba, ehRead) {

        $('#txtorc_data_Validade_Detalhes').datepicker({ dateFormat: 'dd/mm/yy' });

        var Orcamento_controlesReadOnly = ["txtorc_valor_total"];

        var tabela = document.getElementById('tbl_ORCAMENTO_DETALHES_' + aba);

        // btnAbrirPriorizacao
        var botoes = tabela.getElementsByTagName('button');
        for (var i = 0; i < botoes.length; i++) {
            if (botoes[i].id == "btnAbrirPriorizacao") {
                botoes[i].style.visibility = ehRead ? 'hidden' : 'visible';
                break;
            }
        }


        // habilita ou desabilita todos os controles editaveis
        var lstTxtBoxes = tabela.getElementsByTagName('input');
        for (var i = 0; i < lstTxtBoxes.length; i++)
            if (!Orcamento_controlesReadOnly.includes(lstTxtBoxes[i].id))
                if (lstTxtBoxes[i].id == "chkorc_ativoDetalhes")
                    lstTxtBoxes[i].readOnly = ehRead;
                else
                    lstTxtBoxes[i].disabled = ehRead;

        // combo
        var combos = tabela.getElementsByTagName('select');
        for (var i = 0; i < combos.length; i++) {
            combos[i].disabled = ehRead;
        }



        // =============== ALTERNA OS BOTOES SALVAR/CANCELAR/EDITAR =============================================================
        // alterna para os botoes de salvar/cancelar
        var display1 = 'block';
        var display2 = 'none';

        if (!ehRead) {
            display1 = 'none';
            display2 = 'block';
        }

        document.getElementById("btn_Editar_ORCAMENTO_DETALHES_" + aba).style.display = 'none';
        document.getElementById("btn_Clonar_ORCAMENTO_DETALHES_" + aba).style.display = 'none';

        document.getElementById("btn_Salvar_ORCAMENTO_DETALHES_" + aba).style.display = 'none';
        document.getElementById("btn_Cancelar_ORCAMENTO_DETALHES_" + aba).style.display = 'none';

        var quem = document.getElementById("btn_Toggle_ORCAMENTO_DETALHES_" + aba);
        if (quem.getAttribute('aria-expanded') == "true") {
            document.getElementById("btn_Editar_ORCAMENTO_DETALHES_" + aba).style.display = display1;
            document.getElementById("btn_Clonar_ORCAMENTO_DETALHES_" + aba).style.display = display1;

            document.getElementById("btn_Salvar_ORCAMENTO_DETALHES_" + aba).style.display = display2;
            document.getElementById("btn_Cancelar_ORCAMENTO_DETALHES_" + aba).style.display = display2;
        }


    }

    function ORCAMENTO_DETALHES_Clonar(senderID) {
        var aba = senderID.replaceAll("btn_Clonar_ORCAMENTO_DETALHES_", "");
        var orc_id = orc_ids_selecionados[parseInt(aba) - 1];

        swal({
            title: "Clonar Orçamento. Tem certeza?",
            icon: "warning",
            buttons: [
                'Não',
                'Sim'
            ],
            dangerMode: true,
            focusCancel: true
        }).then(function (isConfirm) {

            if (isConfirm) {
                var url = "/Orcamento/Orcamento_Clonar";
                var response = POST(url, JSON.stringify({ orc_id: orc_id }))
                if (response.erroId == 1) {

                    if (parseInt(result) > 0) {
                        // limpar selecionados e abas
                        // btnLimparSelecao_onclick();
                        // limpa os arrays
                        orc_ids_selecionados = [];
                        $("#lblSelecionados").html("");

                        // oculta as abas
                        for (var aba = 1; aba <= 10; aba++) {
                            var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + aba);
                            if (div_FICHA_ORCAMENTO_DETALHES)
                                div_FICHA_ORCAMENTO_DETALHES.style.display = 'none';
                        }

                        $('#tblOrcamento').DataTable().ajax.reload(null, false);  //false = sem reload na pagina.

                        // espera 1 segundo para dar tempo do reload, nao funcionou colocando no "Null" do reload
                        setTimeout(function () { posicionaLinha('tblOrcamento', result, 0); }, 1500);
                    }

                    selectedId_orc_id = result;
                    return false;
                }
                else {
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: errormessage.responseText
                    }).then(
                        function () {
                            return false;
                        });
                }
                return false;
            } else {
                return false;
            }

        });
    }

    function ORCAMENTO_DETALHES_Editar(senderID) {
        var aba = senderID.replaceAll("btn_Editar_ORCAMENTO_DETALHES_", "");

        // procura o indice no array
        var index = -1;
        var qualAba = -1;
        for (index = 0; index < orc_ids_selecionados.length; index++) {
            qualAba = index +1;
            if (qualAba === parseInt(aba)) {
                // recarrega os dados
                carregaGridOrcamentoDetalhes(aba, orc_ids_selecionados[index], 2);

                // seta para Escrita
                ORCAMENTO_DETALHES_setaReadWrite(aba, false);
                break;
            }
        }

        return false;
    }

    function ORCAMENTO_DETALHES_Cancelar(senderID) {
        var aba = senderID.replaceAll("btn_Cancelar_ORCAMENTO_DETALHES_", "");
        pri_ids_removidos = [];
        pri_ids_selecionados = '';
        pri_ids_associados = '';


        // procura o indice no array
        var index = -1; var qualAba = 0;
        for (index = 0; index < orc_ids_selecionados.length; index++) {
            qualAba = index + 1;
            if (qualAba === parseInt(aba)) {
                // recarrega os dados
                carregaGridOrcamentoDetalhes(qualAba, orc_ids_selecionados[index], 1);

                // seta para Leitura
                ORCAMENTO_DETALHES_setaReadWrite(qualAba, true);

                break;
            }
        }
    }

    function limpaFundo(quem)
    {
        quem.style.backgroundColor =  "rgb(255, 255, 255)";

    }

    function ORCAMENTO_Salvar(ehNovoOrcamento_orc_id,
                                            txtorc_codigo,
                                            txtorc_versao,
                                            txtorc_descricao,
                                            cmbStatusOrcamento,
                                            txtobj_codigo,
                                            txtorc_data_Validade,
                                            chkorc_ativo,
                                            pri_ids_selecionados
                                        )
    {


        if (txtorc_codigo.value.trim() == "") {
            txtorc_codigo.style.backgroundColor = corVermelho;
            swal({
                type: 'error',
                title: 'Aviso',
                text: 'O Código é obrigatório'
            }).then(
                function () {
                    return false;
                });
            return false;
        }
        else
            if (txtorc_versao.value.trim() == "") {
                txtorc_versao.style.backgroundColor = corVermelho;
                swal({
                    type: 'error',
                    title: 'Aviso',
                    text: 'A Versão é obrigatória'
                }).then(
                    function () {
                        return false;
                    });
                return false;
            }
            else
                if (txtorc_descricao.value.trim() == "") {
                    txtorc_descricao.style.backgroundColor = corVermelho;
                    swal({
                        type: 'error',
                        title: 'Aviso',
                        text: 'A Descrição é obrigatória'
                    }).then(
                        function () {
                            return false;
                        });
                    return false;
                }
                else
                    if (cmbStatusOrcamento.selectedIndex <= 0) {
                        cmbStatusOrcamento.style.backgroundColor = corVermelho;
                        swal({
                            type: 'error',
                            title: 'Aviso',
                            text: 'O Status é obrigatório'
                        }).then(
                            function () {
                                return false;
                            });
                        return false;
                    }
                    else

                        if (txtobj_codigo.value.trim() == "") {
                            txtobj_codigo.style.backgroundColor = corVermelho;
                            swal({
                                type: 'error',
                                title: 'Aviso',
                                text: 'O Objeto é obrigatório'
                            }).then(
                                function () {
                                    return false;
                                });
                            return false;
                        }
                        else
                            if (txtorc_data_Validade.value.trim() == "") {
                                txtorc_data_Validade.style.backgroundColor = corVermelho;
                                swal({
                                    type: 'error',
                                    title: 'Aviso',
                                    text: 'A Data Validade obrigatória'
                                }).then(
                                    function () {
                                        return false;
                                    });
                                return false;
                            }

        var param = {
            orc_id: ehNovoOrcamento_orc_id,
            orc_cod_orcamento: $(txtorc_codigo).val(),
            orc_versao: $(txtorc_versao).val(),
            orc_descricao: $(txtorc_descricao).val(),
            orc_data_validade: $(txtorc_data_Validade).val(),
            orc_id_pai: -1,
            orc_ativo: $(chkorc_ativo).prop('checked') ? 1 : 0,
            ocs_id: $(cmbStatusOrcamento).val(),
            pri_ids_selecionados: pri_ids_selecionados
        };

        $.ajax({
            url: "/Orcamento/Orcamento_Salvar",
            data: JSON.stringify(param),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                if (parseInt(result) > 0) {
                    // limpar selecionados e abas
                    btnLimparSelecao_onclick();

                    $('#tblOrcamento').DataTable().ajax.reload(null, false);  //false = sem reload na pagina.

                    // espera 1 segundo para dar tempo do reload, nao funcionou colocando no "Null" do reload
                    //setTimeout(function () { posicionaLinha('tblOrcamento', result, 0); }, 1500);
                }

                // reseta a variavel ehNovoOrcamento_orc_id
                ehNovoOrcamento_orc_id = -1;
                pri_ids_removidos = [];
                pri_ids_selecionados = '';
                pri_ids_associados = '';

                selectedId_orc_id = result;
                $("#modalSalvarRegistro").modal('hide');

                return false;
            },
            error: function (errormessage) {
                swal({
                    type: 'error',
                    title: 'Aviso',
                    text: errormessage.responseText
                }).then(
                    function () {
                        return false;
                    });

                return false;
                $("#modalSalvarRegistro").modal('show');
            }
        });

        return false;
    }

    function ORCAMENTO_DETALHES_Salvar(senderID) {
        var aba = senderID.replaceAll("btn_Salvar_ORCAMENTO_DETALHES_", "");
        var prefixo = '#div_FICHA_ORCAMENTO_DETALHES_' + aba + ' ';

        var orc_idd = -1;
        // procura o indice no array abas para achar a correspondente ORC_ID
        var index = -1; var qualAba = 0;
        for (index = 0; index < abas_selecionadas.length; index++) {
            qualAba = index + 1;
            if (qualAba=== parseInt(aba)) {
                orc_idd = orc_ids_selecionados[index];
                break;
            }
        }
                
        ORCAMENTO_DETALHES_setaReadWrite(parseInt(aba), true);

        // salva
     return   ORCAMENTO_Salvar(orc_idd,
            $(prefixo + "#txtorc_codigo_Detalhes")[0],
            $(prefixo + "#txtorc_versaoDetalhes")[0],
            $(prefixo + "#txtorc_descricao_Detalhes")[0],
            $(prefixo + '#cmbStatusOrcamentoDetalhes')[0],
            $(prefixo + "#txtobj_codigoDetalhes")[0],
            $(prefixo + "#txtorc_data_Validade_Detalhes")[0],
            $(prefixo + "#chkorc_ativoDetalhes")[0],
            pri_ids_selecionados.trim() == "" ? pri_ids_associados : pri_ids_selecionados
                        );

    }

    function ORCAMENTO_DETALHES_header_click(senderID, expandir) {
        if (expandir == null)
            expandir = 0;

        var sufixo = senderID.replaceAll("btn_Toggle_ORCAMENTO_DETALHES_", "");
        var quem = document.getElementById(senderID);

        // alterna os campos para leitura
        //   setaReadWrite_FichaInspecaoCadastral(tblFicha_ENCONTROS, true);

        // mostra o botao editar
        if ((quem.getAttribute('aria-expanded') == "false") || (expandir == 1)) {
            document.getElementById("btn_Salvar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';
            document.getElementById("btn_Cancelar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';
            document.getElementById("btn_Editar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'block';
            document.getElementById("btn_Clonar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'block';

            document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + sufixo).style.display = 'block';
        }
        else {
            //  document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';

            document.getElementById("btn_Editar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';
            document.getElementById("btn_Clonar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';

            if (quem.getAttribute('aria-expanded') == "true") {
                document.getElementById("btn_Salvar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';
                document.getElementById("btn_Cancelar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'none';
            }
            else {
                document.getElementById("btn_Salvar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'block';
                document.getElementById("btn_Cancelar_ORCAMENTO_DETALHES_" + sufixo).style.display = 'block';
            }
        }

        // roda o icone 90graus
        document.getElementById("iconAngle_ORCAMENTO_DETALHES_" + sufixo).classList.toggle('rotate');

        return false;
    }

    var orc_valor_total = 0;

    function carregaGridOrcamentoDetalhes(aba, orc_id, ore_ativo) {
        var prefixo = '#div_FICHA_ORCAMENTO_DETALHES_' + aba + ' ';
        var tabela = prefixo + ' #tblOrcamentoDetalhes';

        var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + aba);
        if (div_FICHA_ORCAMENTO_DETALHES) {
            if (orc_id > 0)
                div_FICHA_ORCAMENTO_DETALHES.style.display = 'block';
            else
                div_FICHA_ORCAMENTO_DETALHES.style.display = 'none';
        }

        // limpa os backgrounds
        var corBranca = "rgb(255, 255, 255)";
        $(prefixo + '#txtorc_codigo_Novo').css("background-color", corBranca);
        $(prefixo + '#txtorc_versao').css("background-color", corBranca);
        $(prefixo + '#txtorc_descricao_Novo').css("background-color", corBranca);
        $(prefixo + '#txtobj_codigo_Novo').css("background-color", corBranca);
        $(prefixo + '#txtorc_data_Validade_Novo').css("background-color", corBranca);
        $(prefixo + '#cmbStatusOrcamentoDetalhes').css("background-color", corBranca);


        // limpa os campos antes de preencher
        $(prefixo + "#txtorc_codigo_Detalhes").val("");
        $(prefixo + "#txtorc_versaoDetalhes").val("");
        $(prefixo + "#txtorc_descricao_Detalhes").val("");
        $(prefixo + "#txtobj_codigoDetalhes").val("");
        $(prefixo + "#txtorc_data_Validade_Detalhes").val("");
        $(prefixo + "#txtorc_valor_total").val("");
        $(prefixo + '#cmbStatusOrcamentoDetalhes').val("");


        $("#btn_Toggle_ORCAMENTO_DETALHES_" + aba).html("");


        $(tabela).DataTable().destroy();
        $(tabela).DataTable({
            "ajax": {
                "url": "/Orcamento/OrcamentoDetalhes_ListAll",
                "type": "GET",
                "datatype": "json",
                "data": function (d) {
                    d.orc_id = orc_id;
                    d.ore_ativo = ore_ativo;
                }
            }
            , "columns": [
                { data: "ian_ordem_apresentacao", "className": "hide_column" },
                { data: "ore_id", "className": "hide_column" },
                { data: "orc_id", "className": "hide_column" },
                { data: "orc_cod_orcamento", "className": "hide_column" },
                { data: "orc_descricao", "className": "hide_column" },
                { data: "orc_versao", "className": "hide_column" },
                { data: "ocs_id", "className": "hide_column" },
                { data: "ocs_codigo", "className": "hide_column" },
                { data: "ocs_descricao", "className": "hide_column" },
                { data: "orc_data_validade", "className": "hide_column" },
                { data: "orc_valor_total", "className": "hide_column" },
                { data: "orc_id_pai", "className": "hide_column" },

                { data: "obj_codigoOAE", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "obj_codigoElemento", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "ian_numero", "className": "Centralizado", "autoWidth": true, "searchable": false },

                { data: "atp_codigo", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "leg_codigo", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "ale_codigo", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "aca_codigo", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "ian_quantidade", "className": "Centralizado", "autoWidth": true, "searchable": false },

                { data: "rpt_id_sugerido_codigo", "className": "borderLeft Centralizado", "autoWidth": true, "searchable": false },
                { data: "ian_quantidade_sugerida", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rpt_id_sugerido_unidade", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rtu_preco_unitario_sugerido", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rtu_valor_total_sugerido", "className": "Centralizado", "autoWidth": true, "searchable": false },

                { data: "rpt_id_adotado_codigo", "className": "borderLeft Centralizado", "autoWidth": true, "searchable": false },
                { data: "ian_quantidade_adotada", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rpt_id_adotado_unidade", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rtu_preco_unitario_adotado", "className": "Centralizado", "autoWidth": true, "searchable": false },
                { data: "rtu_valor_total_adotado", "className": "Centralizado borderRight", "autoWidth": true, "searchable": false },

                { data: "orc_objetos_associados", "className": "hide_column" },
                { data: "pri_ids_associados", "className": "hide_column" },
                { data: "orc_ativo", "className": "hide_column" },

                {
                    data: "ore_id",
                    "searchable": false,
                    "className": "Centralizado",
                    "sortable": false,
                    "render": function (data, type, row) {
                        var retorno = "";
                        if (permissaoEscrita > 0) {
                            if (row.ore_ativo == 1)
                                retorno += '<a href="#" onclick="return OrcamentoDetalhes_AtivarDesativar(' + aba + ',' + data + ', 0)" title="Ativo" ><span class="glyphicon glyphicon-ok text-success"></span></a>' + '  ';
                            else
                                retorno += '<a href="#" onclick="return OrcamentoDetalhes_AtivarDesativar(' + aba + ',' + data + ', 1)" title="Desativado" ><span class="glyphicon glyphicon-remove text-danger"></span></a>' + '  ';
                        }
                        return retorno;
                    }
                }
            ]
            , "createdRow": function (row, data, dataIndex) {

                if ((data["obj_codigoOAE"] != "") && (dataIndex > 1)) {
                    for (var i = 12; i <= 33; i++)
                        $(row.childNodes[i]).addClass("borderTop");
                }

                if ((data["obj_codigoOAE"] != "") && (dataIndex == 0)) {
                    $(prefixo + "#txtorc_codigo_Detalhes").val((row.childNodes[3].innerText));
                    $(prefixo + "#txtorc_versaoDetalhes").val((row.childNodes[5].innerText.trim()));
                    $(prefixo + "#txtorc_descricao_Detalhes").val((row.childNodes[4].innerText));
                    $(prefixo + "#txtobj_codigoDetalhes").val((row.childNodes[30].innerText));
                    $(prefixo + "#txtorc_data_Validade_Detalhes").val((row.childNodes[9].innerText));
                    $(prefixo + '#cmbStatusOrcamentoDetalhes').val((row.childNodes[6].innerText));
                    $(prefixo + '#chkorc_ativoDetalhes').prop('checked', (row.childNodes[32].innerText == '1' ? true : false));
                    pri_ids_associados = (row.childNodes[31].innerText);

                }

                if (parseInt(data["ore_ativo"]) == 1)
                    orc_valor_total = orc_valor_total + parseFloat(data["rtu_valor_total_adotado"]);

                $(prefixo + "#txtorc_valor_total").val(orc_valor_total);

                $("#btn_Toggle_ORCAMENTO_DETALHES_" + aba).html("Orçamento " + $(prefixo + "#txtorc_codigo_Detalhes").val() + " Versão " + $(prefixo + "#txtorc_versaoDetalhes").val());

            }
            , "order": [2, "asc"]
            , "ordering": false
            , 'columnDefs': [
                {
                    targets: [12] // tooltip obj_codigoOAE
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["obj_descricaoOAE"]);

                    }
                }
                , {
                    targets: [13] // tooltip obj_codigoElemento
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["obj_descricaoElemento"]);
                    }
                }
                , {
                    targets: [15] // tooltip atp_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["atp_descricao"]);
                    }
                }
                , {
                    targets: [16] // tooltip ian_sigla = leg_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["leg_descricao"]);
                    }
                }
                , {
                    targets: [17] // tooltip ale_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["ale_descricao"]);
                    }
                }
                , {
                    targets: [18] // tooltip aca_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["aca_descricao"]);
                    }
                }
                , {
                    targets: [20] // tooltip rpt_id_sugerido_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["rpt_id_sugerido_descricao"]);
                    }
                }

                , {
                    targets: [25] // tooltip rpt_id_adotado_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["rpt_id_adotado_descricao"]);
                    }
                }

            ]
            , "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]]
            , select: {
                style: 'single'
            }
            , searching: false
            , "oLanguage": idioma
            , "pagingType": "input"
            , "sDom": '<"top">rt<"bottom"pfli><"clear">'
        });

        return false;
    }


    function OrcamentoDetalhes_AtivarDesativar(aba, ore_id, ativar) {
        var prefixo = '#div_FICHA_ORCAMENTO_DETALHES_' + aba + ' ';
        var tabela = prefixo + ' #tblOrcamentoDetalhes';

        if (ore_id >= 0) {
            var form = this;
            swal({
                title: (ativar == 1 ? "Ativar" : "Desativar") + ". Tem certeza?",
                icon: "warning",
                buttons: [
                    'Não',
                    'Sim'
                ],
                dangerMode: true,
                focusCancel: true
            }).then(function (isConfirm) {
                if (isConfirm) {
                    var url = "/Orcamento/OrcamentoDetalhes_AtivarDesativar";
                    var response = POST(url, JSON.stringify({ ore_id: ore_id }))
                    if (response.erroId == 1) {
                        swal({
                            type: 'success',
                            title: 'Sucesso',
                            text: ativar == 1 ? msgAtivacaoOK : msgDesativacaoOK
                        });

                        $(tabela).DataTable().ajax.reload();
                    }
                    else {
                        swal({
                            type: 'error',
                            title: 'Aviso',
                            text: ativar == 1 ? msgAtivacaoErro : msgDesativacaoErro
                        });
                    }
                    return true;
                } else {
                    return false;
                }
            })
        }

        return false;
    }


    // ******************************************************************************************************************

    function carregaGridOrcamento() {

        // limpar selecionados e abas
        btnLimparSelecao_onclick();

        $('#tblOrcamento').DataTable().destroy();
        $('#tblOrcamento').DataTable({
            "ajax": {
                "url": "/Orcamento/Orcamento_ListAll",
                "type": "GET",
                "datatype": "json",
                "data": {
                    "orc_id": selectedId_orc_id,
                    "filtroRodovia": filtroRodovia,
                    "filtroObjetos": filtroObjetos,
                    "filtroStatus": filtroStatus == null ? -1 : filtroStatus,
                    "orc_ativo": $("#chkMostrarInativos").is(":checked") ? 2 : 1
                }
            }
            , "columns": [
                { data: "orc_id", "width": "30px", "searchable": false },
                { data: "orc_id", "className": "hide_column", "searchable": false },
                { data: "ocs_id", "className": "hide_column", "searchable": false },

                { data: "orc_cod_orcamento", tooltip: "orc_descricao", "width": "80px", "searchable": true },
                { data: "orc_versao", tooltip: "orc_versao", "width": "80px", "searchable": true },

                { data: "orc_data_criacao", tooltip: "orc_data_criacao", "width": "30px", "searchable": true },
                { data: "orc_data_validade", tooltip: "orc_data_validade", "width": "30px", "searchable": true },

                { data: "ocs_codigo", tooltip: "ocs_descricao", "autoWidth": true, "searchable": true },

                { data: "orc_valor_total", tooltip: "orc_valor_total", "width": "80px", "searchable": true },

                { data: "orc_os_associadas", tooltip: "orc_os_associadas", "autoWidth": true, "searchable": true },
                { data: "orc_objetos_associados", tooltip: "orc_objetos_associados", "autoWidth": true, "searchable": true }
                , {
                    data: "orc_id",
                    "searchable": false,
                    "sortable": false,
                    "render": function (data, type, row) {

                        var retorno = "";
                        if (permissaoEscrita > 0) {
                            retorno = '<a href="#" onclick="return EditarOrcamento(' + data + ')" title="Editar" ><span class="glyphicon glyphicon-pencil"></span></a>' + '  ';

                            if (row.orc_ativo == 1)
                                retorno += '<a href="#" onclick="return AtivarDesativarOrcamento(' + data + ', 0)" title="Ativo" ><span class="glyphicon glyphicon-ok text-success"></span></a>' + '  ';
                            else
                                retorno += '<a href="#" onclick="return AtivarDesativarOrcamento(' + data + ', 1)" title="Desativado" ><span class="glyphicon glyphicon-remove text-danger"></span></a>' + '  ';
                        }
                        else {
                            retorno = '<span class="glyphicon glyphicon-pencil desabilitado"  ></span>' + '  ';

                            if (row.orc_ativo == 1)
                                retorno += '<span class="glyphicon glyphicon-ok text-success desabilitado" ></span>' + '  ';
                            else
                                retorno += '<span class="glyphicon glyphicon-remove text-danger desabilitado"  ></span>' + '  ';

                        }

                        if (permissaoExclusao > 0)
                            retorno += '<a href="#" onclick="return DeletarOrcamento(' + data + ')" title="Excluir" ><span class="glyphicon glyphicon-trash"></span></a>';
                        else
                            retorno += '<span class="glyphicon glyphicon-trash desabilitado" title="Excluir" ></span>';

                        return retorno;
                    }
                }
            ]
            , 'columnDefs': [
                {
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta) {
                        return '<input type="checkbox" name="id[]" value="' + $('<div/>').text(data).html() + '" onchange= "chkSelecao_onchange(this);">';
                    }
                }
                , {
                    targets: [3] // orc_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["orc_descricao"]);
                    }
                }
            ]

            , "rowId": "orc_id"
            , "rowCallback": function (row, data) {
                if (data.orc_id == selectedId_orc_id)
                    $(row).addClass('selected');
            }
            , "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]]
            , select: {
                style: 'single'
            }
            , searching: true
            , "oLanguage": idioma
            , "pagingType": "input"
            , "sDom": '<"top">rt<"bottom"pfli><"clear">'
        });


    }

    // montagem do gridview
    $(document).ready(function () {

        carregaGridOrcamento();

        var tblOrcamento = $('#tblOrcamento').DataTable();
        $('#tblOrcamento tbody').on('click', 'tr', function () {
          /*            var orc = tblOrcamento.row(this).data();
            selectedId_orc_id = orc["orc_id"];
           
                        if ($(this).hasClass('selected')) {
                            $(this).removeClass('selected');
                        }
                        else {
                            tblOrcamento.$('tr.selected').removeClass('selected');
                            $(this).addClass('selected');
                        }


            // limpa os arrays
            orc_ids_selecionados = [];

            $("#lblSelecionados").html("");

            // limpa o GridOrcamento
            tblOrcamento.$('input[type="checkbox"]').each(function () {
                if (this.checked)
                    this.checked = false;
            });

            // oculta as abas
            for (var aba = 1; aba <= 10; aba++) {
                var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_" + aba);
                if (div_FICHA_ORCAMENTO_DETALHES)
                    div_FICHA_ORCAMENTO_DETALHES.style.display = 'none';
            }


                        // seta a 1a aba
                        orc_ids_selecionados.push(selectedId_orc_id);

                        // carrega a aba
            carregaGridOrcamentoDetalhes(1, selectedId_orc_id, 1);

            ORCAMENTO_DETALHES_header_click("btn_Toggle_ORCAMENTO_DETALHES_1", 1);

            $("#div_ORCAMENTO_DETALHES_1").attr("aria-expanded", "true");
            $("#div_ORCAMENTO_DETALHES_1").removeClass("collapse");
            $("#div_ORCAMENTO_DETALHES_1").addClass("collapse in");

            var div_FICHA_ORCAMENTO_DETALHES = document.getElementById("div_FICHA_ORCAMENTO_DETALHES_1");
            if (div_FICHA_ORCAMENTO_DETALHES)
                div_FICHA_ORCAMENTO_DETALHES.style.display = 'block';
   */
            //  document.getElementById('subGrids').style.visibility = "visible";
        });


    }); // document.ready


   // *************** popup selecionar priorizacao/objetos *********************************

    var pri_ids_removidos = [];
    var pri_ids_selecionados = '';

    var ord_ids_selecionados = '';
    var obj_codigos_selecionados = '';

    var abaSelecionada_popupPriorizacao = -1;

    function chkPriorizacao_onchange(quem) {
        var tem = -1;

        // verifica se esta na lista de removidos e remove
        for (var index = 0; index < pri_ids_removidos.length; index++) {
            if (pri_ids_removidos[index] === parseInt(quem.value)) {
                tem = index;
                break;
            }
        }

        if (quem.checked) {
            // remove do array
            if (tem > 0)
                pri_ids_removidos.splice(tem, 1);
        }
        else
            if (tem < 0) {
                // acrescenta no array
                pri_ids_removidos.push(parseInt(quem.value));
            }

    }

    function LimparFiltroPriorizacao() {

        $('#txtCodRodovia').val("");
        $('#txtCodOAE').val("");
        $("#cmbFiltroRegionais").multiselect("clearSelection");

        //carregaGridPriorizacao();

        return false;
    }
    function ExecutarFiltroPriorizacao() {

        carregaGridPriorizacao();
        return false;
    }
    function carregaGridPriorizacao() {
        var FiltroRegionais = ($("#cmbFiltroRegionais").val() + ';').replaceAll(",", ";");


        $('#tblPriorizacao').DataTable().destroy();
        $('#tblPriorizacao').DataTable({
            "ajax": {
                "url": "/Objeto/ObjPriorizacao_ListAll",
                "type": "GET",
                "datatype": "json",
                "data": function (d) {
                    d.CodRodovia = $('#txtCodRodovia').val();
                    d.Regionais = FiltroRegionais;
                    d.somenteINSP_ESPECIAIS = 1;
                }
            }
            , "columns": [
                { data: "pri_id", "searchable": false },
                { data: "pri_id", "className": "hide_column", "searchable": false },
                { data: "obj_id", "className": "hide_column", "searchable": false },
                { data: "pri_ordem", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "obj_codigo", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "pri_nota_final", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "pri_nota_estrutura", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "pri_nota_durabilidade", "className": "Centralizado", "autoWidth": true, "searchable": true },

                { data: "pri_acao", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "pri_status", "className": "Centralizado", "autoWidth": true, "searchable": true },
                { data: "ord_id", "className": "hide_column", "searchable": false }
            ]
            , "order": [3, "asc"]
            // , "ordering": false
            , 'columnDefs': [
                {
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta) {
                        return '<input type="checkbox" name="id[]"  onchange="chkPriorizacao_onchange(this);"  value="' + $('<div/>').text(data).html() + '">';
                    }
                    , "createdCell": function (td, cellData, rowData, row, col) {

                        if (pri_ids_associados.trim() != "") {
                            var res = pri_ids_associados.split(";");
                            if (res.includes(rowData["pri_id"] + '')) // converte obj_id para string a fim de comparar
                                if (col == 0) {
                                    $(td).find("input[type=checkbox]").attr("checked", true);
                                }
                        }
                    }
                }

                , {
                    targets: [4] // obj_codigo
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["obj_descricao"]);
                    }
                }
                , {
                    targets: [8] // pri_nota_acao
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["pri_acao"]);
                    }
                }
                , {
                    targets: [9] // pri_status
                    , "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).attr('title', rowData["status_descricao"]);
                    }
                }
                , {
                    "targets": [1, 3, 4, 5, 6, 7, 8, 9]
                    , "orderable": false
                }
            ]

            , "createdRow": function (row, data, dataIndex) {

                //  if (data["corFundo"] != "transparent")
                //    $(row).attr('style', 'background-color:' + data["corFundo"] + ' !important');
            }
            , "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]]
            , select: {
                style: 'single'
            }
            , searching: false
            , "oLanguage": idioma
            , "pagingType": "input"
            , "sDom": '<"top">rt<"bottom"pfli><"clear">'
        });
    }

    // transforma o combo em multipla escolha
    $(function () {
        $('#cmbFiltroRegionais').multiselect({
            includeSelectAllOption: false,
            nonSelectedText: "-- Selecione --",
            delimiterText: '; '
        });
    });

    function bntSalvarObjetos_onclick() {
        obj_codigos_selecionados = '';
        pri_ids_selecionados = '';
        ord_ids_selecionados = '';

        var table = $('#tblPriorizacao').DataTable();
        table.$('input[type="checkbox"]').each(function () {

            if (this.checked)
                if (!pri_ids_removidos.includes(parseInt(this.value))) {
                    //  alert(this.value);
                    var posicao = parseInt(this.value);
                    var linha = this.parentElement.parentElement; // acha a linha correspondente
                    var celulas = linha.childNodes; // acha as celulas irmãs
                    for (var i = 0; i < celulas.length; i++) {
                        //alert(celulas[i].innerText);
                        switch (i) {
                            case 1: pri_ids_selecionados = pri_ids_selecionados + ';' + celulas[i].innerText; break;
                            case 4: obj_codigos_selecionados = obj_codigos_selecionados + '; ' + celulas[i].innerText; break;
                            case 10: ord_ids_selecionados = ord_ids_selecionados + '; ' + celulas[i].innerText; break;
                        }
                    }
                }
        });

        // remove o 1o. ponto e virgula ";"
        pri_ids_selecionados = pri_ids_selecionados.substr(1);
        obj_codigos_selecionados = obj_codigos_selecionados.substr(2);
        ord_ids_selecionados = ord_ids_selecionados.substr(1);

        // preenche o textbox txtobj_codigo_Novo
        $("#txtobj_codigo_Novo").val(obj_codigos_selecionados);


        // preenche o textbox txtobj_codigoDetalhes da abaSelecionada_popupPriorizacao (caso o popup venha da aba)
        var prefixo = '#div_FICHA_ORCAMENTO_DETALHES_' + abaSelecionada_popupPriorizacao + ' ';
        if (prefixo) {
            $(prefixo + " #txtobj_codigoDetalhes").val(obj_codigos_selecionados);
        }
        abaSelecionada_popupPriorizacao = -1;


        $("#modalPriorizacao").modal('hide');

        return false;
    }
    function btnAbrirPriorizacao_onclick(quem) {
        if (quem != null) {
            var objeto = quem.parentElement;
            while (!objeto.id.startsWith("div_FICHA_ORCAMENTO_DETALHES_"))
                objeto = objeto.parentElement;

            abaSelecionada_popupPriorizacao = parseInt(objeto.id.replaceAll("div_FICHA_ORCAMENTO_DETALHES_", ""));
            // alert(objeto.id);
        }
        else
            abaSelecionada_popupPriorizacao = -1;

        carregaGridPriorizacao();

        $("#modalPriorizacao").modal('show');
        return false;
    }

</script>

<div class="modal fade" id="modalSalvarRegistro" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="width:850px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title text-center"><b><label id="lblModalHeader">Nova Orçamento</label></b></h3>
            </div>
            <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                <br />

                <div class="modal-body form-group">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-sm-3">Código<span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                <input id="txtorc_codigo_Novo" name="txtorc_codigo_Novo" maxlength="20"
                                       placeholder="Código"
                                       class="form-control" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Versão<span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                <input id="txtorc_versao" name="txtorc_versao" maxlength="20"
                                       placeholder="Versão"
                                       class="form-control" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Descrição<span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                <input id="txtorc_descricao_Novo" name="txtorc_descricao_Novo" class="form-control"
                                       placeholder="Descrição"
                                       maxlength="255"
                                       onkeyup="$('#txtorc_descricao_Novo').css('background-color', corBranca)" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Status<span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                @Html.DropDownList("cmbStatusOrcamento", null, "-- Selecione --", new { @class = "form-control", @onchange = "cmbStatusOrcamento_onchange()" })
                                @*<select class="form-control" id="cmbStatusOrcamento" name="cmbStatusOrcamento"
                                            onchange="cmbStatusOrcamento_onchange()">
                                    </select>*@
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Objeto(s)<span class="text-danger">*</span> </label>
                            <div class="col-sm-9">
                                <table style="width:100%">
                                    <tr>
                                        <td style="width:100%">
                                            <input id="txtobj_codigo_Novo" name="txtobj_codigo_Novo" class="form-control"
                                                   placeholder="Objeto" readonly
                                                   autocomplete="off" />
                                        </td>
                                        <td>
                                            <button style="display:inline; width:40px; height:25px; margin-left:5px; " id="btnAbrirPriorizacao" onclick="return btnAbrirPriorizacao_onclick(null)">...</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">
                            <nobr><label class="control-label col-sm-3">Data Validade<span class="text-danger">*</span></label></nobr>
                            <div class="col-sm-9">
                                <input id="txtorc_data_Validade_Novo" name="txtorc_data_Validade_Novo" placeholder="Data Validade"
                                       maxlength="20" class="form-control" readonly style="background-color:transparent" />

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3" for="chkorc_ativo">Ativo</label>
                            <div class="col-sm-9">
                                <input type="checkbox" id="chkorc_ativo" style="margin-top: 10px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-3">Aberta Por</label>
                            <div class="col-sm-9">
                                <input id="txtusu_nome_Novo" name="txtusu_nome" maxlength="100"
                                       class="form-control" disabled value="@( @gUsuario.usu_nome)" title="@( gUsuario.usu_id)" />
                            </div>
                        </div>

                        <div class="form-group">
                            <nobr><label class="control-label col-sm-3">Data Abertura</label></nobr>
                            <div class="col-sm-9">
                                <input id="txtorc_data_abertura" name="txtorc_data_abertura" placeholder="Data Abertura"
                                       maxlength="20" class="form-control" disabled value="@( DateTime.Now.ToShortDateString() )">
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <div class="col-md-3 col-md-offset-4">
                        <button id="bntSalvar_NovoOrcamento" name="bntSalvar_NovoOrcamento" onclick="return bntSalvar_NovoOrcamento_onclick();" class="btn btn-primary btn-block btn-flat">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalPriorizacao" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="width:950px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title text-center"><b><label id="lblModalHeaderPriorizacao">Priorização</label></b></h3>
            </div>
            <form class="form-horizontal" onkeydown="if (event.keyCode == 13) { event.preventDefault(); return false; }">
                <br />

                <div class="modal-body form-group">
                    <div class="col-sm-12">

                        <div style="width:100%;" id="divFiltros">
                            <div class="box box-primary">
                                <div class="box-body">
                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <label class="control-label">Rodovia</label>
                                            <input type="text" class="form-control" id="txtCodRodovia" maxlength="50" onkeydown="if (event.keyCode == 13) { ExecutarFiltroPriorizacao(); }">
                                        </div>

                                        <div class="col-sm-3">
                                            <label class="control-label">Regional</label><br />
                                            @Html.DropDownList("cmbFiltroRegionais", null, null, new { @class = "form-control", @multiple = "multiple", @style = "width:150px !important;" })
                                        </div>

                                        <div>
                                            <div class="btn-box-tool pull-right" style="margin-top:10px">
                                                <button type="reset" class="btn btn-info" onclick="LimparFiltroPriorizacao();"><i class="fa fa-eraser margin-r-5"></i> Limpar</button>
                                                <button type="submit" class="btn btn-primary" onclick="ExecutarFiltroPriorizacao();" style="margin-right: 10px !important;"><i class="fa fa-search margin-r-5"></i> Pesquisar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <table id="tblPriorizacao">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>pri_id</th>
                                    <th>obj_id</th>
                                    <th title="Prioridade">Prioridade</th>
                                    <th title="OAE">OAE</th>
                                    <th title="Nota Final">Nota Geral</th>
                                    <th title="Nota Estrutura">Nota Estrut</th>
                                    <th title="Nota Durabilidade">Nota Durab</th>

                                    <th title="Ação">Ação</th>
                                    <th title="Status">Status</th>
                                    <th>ord_id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>


                <div class="modal-footer">
                    <div class="col-md-3 col-md-offset-4">
                        <button id="bntSalvarObjetos" name="bntSalvarObjetos" onclick="return bntSalvarObjetos_onclick();" class="btn btn-primary btn-block btn-flat">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    moment.locale('pt-br');         // pt-br
    $.fn.dataTable.moment('DD/MM/YYYY HH:mm:ss');

    $('#txtorc_data_abertura').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtorc_data_Validade_Novo').datepicker({ dateFormat: 'dd/mm/yy' });
    $('#txtorc_data_Validade_Detalhes').datepicker({ dateFormat: 'dd/mm/yy' });


</script>
